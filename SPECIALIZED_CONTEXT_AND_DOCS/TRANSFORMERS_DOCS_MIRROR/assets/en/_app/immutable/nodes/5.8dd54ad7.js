import{s as Ys,n as Ss,o as qs}from"../chunks/scheduler.18a86fab.js";import{S as Fs,i as Ps,g as i,s as a,r as o,A as Ls,h as p,f as l,c as n,j as Qs,u as c,x as r,k as ye,y as Ks,a as t,v as M,d,t as m,w as u}from"../chunks/index.98837b22.js";import{C as y}from"../chunks/CodeBlock.8d0c2e8a.js";import{H as de,E as Ds}from"../chunks/getInferenceSnippets.06c2775f.js";function Os(us){let h,he,me,fe,T,we,J,ys='Make <a href="/docs/transformers/v4.56.2/en/main_classes/pipelines#transformers.Pipeline">Pipeline</a> your own by subclassing it and implementing a few methods. Share the code with the community on the <a href="https://hf.co" rel="nofollow">Hub</a> and register the pipeline with Transformers so that everyone can quickly and easily use it.',je,b,hs="This guide will walk you through the process of adding a new pipeline to Transformers.",Te,U,Je,I,fs='At a minimum, you only need to provide <a href="/docs/transformers/v4.56.2/en/main_classes/pipelines#transformers.Pipeline">Pipeline</a> with an appropriate input for a task. This is also where you should begin when designing your pipeline.',be,B,ws='Decide what input types <a href="/docs/transformers/v4.56.2/en/main_classes/pipelines#transformers.Pipeline">Pipeline</a> can accept. It can be strings, raw bytes, dictionaries, and so on. Try to keep the inputs in pure Python where possible because it’s more compatible. Next, decide on the output <a href="/docs/transformers/v4.56.2/en/main_classes/pipelines#transformers.Pipeline">Pipeline</a> should return. Again, keeping the output in Python is the simplest and best option because it’s easier to work with.',Ue,_,js='Keeping the inputs and outputs simple, and ideally JSON-serializable, makes it easier for users to run your <a href="/docs/transformers/v4.56.2/en/main_classes/pipelines#transformers.Pipeline">Pipeline</a> without needing to learn new object types. It’s also common to support many different input types for even greater ease of use. For example, making an audio file acceptable from a filename, URL, or raw bytes gives the user more flexibility in how they provide the audio data.',Ie,k,Be,g,Ts='With an input and output decided, you can start implementing <a href="/docs/transformers/v4.56.2/en/main_classes/pipelines#transformers.Pipeline">Pipeline</a>. Your pipeline should inherit from the base <a href="/docs/transformers/v4.56.2/en/main_classes/pipelines#transformers.Pipeline">Pipeline</a> class and include 4 methods.',_e,C,ke,Z,Js="<li><code>preprocess</code> takes the inputs and transforms them into the appropriate input format for the model.</li>",ge,$,Ce,f,bs="<li><code>_forward</code> shouldn’t be called directly. <code>forward</code> is the preferred method because it includes safeguards to make sure everything works correctly on the expected device. Anything linked to the model belongs in <code>_forward</code> and everything else belongs in either <code>preprocess</code> or <code>postprocess</code>.</li>",Ze,G,$e,w,Us="<li><code>postprocess</code> generates the final output from the models output in <code>_forward</code>.</li>",Ge,v,ve,j,Is='<li><code>_sanitize_parameters</code> lets users pass additional parameters to <a href="/docs/transformers/v4.56.2/en/main_classes/pipelines#transformers.Pipeline">Pipeline</a>. This could be during initialization or when <a href="/docs/transformers/v4.56.2/en/main_classes/pipelines#transformers.Pipeline">Pipeline</a> is called. <code>_sanitize_parameters</code> returns 3 dicts of additional keyword arguments that are passed directly to <code>preprocess</code>, <code>_forward</code>, and <code>postprocess</code>. Don’t add anything if a user didn’t call the pipeline with extra parameters. This keeps the default arguments in the function definition which is always more natural.</li>',Ae,A,Bs="For example, add a <code>top_k</code> parameter in <code>postprocess</code> to return the top 5 most likely classes. Then in <code>_sanitize_parameters</code>, check if the user passed in <code>top_k</code> and add it to <code>postprocess_kwargs</code>.",He,H,xe,x,_s="Now the pipeline can return the top most likely labels if a user chooses to.",Ve,V,We,W,Xe,X,ks="Register the new task your pipeline supports in the <code>PIPELINE_REGISTRY</code>. The registry defines:",Ne,N,gs="<li>The supported Pytorch model class with <code>pt_model</code></li> <li>a default model which should come from a specific revision (branch, or commit hash) where the model works as expected with <code>default</code></li> <li>the expected input with <code>type</code></li>",ze,z,Ee,E,Re,R,Cs='Share your pipeline with the community on the <a href="https://hf.co" rel="nofollow">Hub</a> or you can add it directly to Transformers.',Qe,Q,Zs='It’s faster to upload your pipeline code to the Hub because it doesn’t require a review from the Transformers team. Adding the pipeline to Transformers may be slower because it requires a review and you need to add tests to ensure your <a href="/docs/transformers/v4.56.2/en/main_classes/pipelines#transformers.Pipeline">Pipeline</a> works.',Ye,Y,Se,S,$s="Add your pipeline code to the Hub in a Python file.",qe,q,Gs="For example, a custom pipeline for sentence pair classification might look like the following code below.",Fe,F,Pe,P,vs="Save the code in a file named <code>pair_classification.py</code>, and import and register it as shown below.",Le,L,Ke,K,As='The <a href="https://github.com/huggingface/transformers/blob/9feae5fb0164e89d4998e5776897c16f7330d3df/src/transformers/pipelines/base.py#L1387" rel="nofollow">register_pipeline</a> function registers the pipeline details (task type, pipeline class, supported backends) to a models <code>config.json</code> file.',De,D,Oe,O,Hs='Call <a href="/docs/transformers/v4.56.2/en/main_classes/model#transformers.utils.PushToHubMixin.push_to_hub">push_to_hub()</a> to push the pipeline to the Hub. The Python file containing the code is copied to the Hub, and the pipelines model and tokenizer are also saved and pushed to the Hub. Your pipeline should now be available on the Hub under your namespace.',es,ee,ss,se,xs="To use the pipeline, add <code>trust_remote_code=True</code> when loading the pipeline.",ls,le,ts,te,as,ae,Vs="Adding a custom pipeline to Transformers requires adding tests to make sure everything works as expected, and requesting a review from the Transformers team.",ns,ne,Ws='Add your pipeline code as a new module to the <a href="https://github.com/huggingface/transformers/tree/main/src/transformers/pipelines" rel="nofollow">pipelines</a> submodule, and add it to the list of tasks defined in <a href="https://github.com/huggingface/transformers/blob/main/src/transformers/pipelines/__init__.py" rel="nofollow">pipelines/<strong>init</strong>.py</a>.',is,ie,Xs='Next, add a new test for the pipeline in <a href="https://github.com/huggingface/transformers/tree/main/tests/pipelines" rel="nofollow">transformers/tests/pipelines</a>. You can look at the other tests for examples of how to test your pipeline.',ps,pe,Ns='The <a href="https://github.com/huggingface/transformers/blob/db70426854fe7850f2c5834d633aff637f14772e/tests/pipelines/test_pipelines_text_classification.py#L186" rel="nofollow">run_pipeline_test</a> function should be very generic and run on the models defined in <a href="https://github.com/huggingface/transformers/blob/db70426854fe7850f2c5834d633aff637f14772e/tests/pipelines/test_pipelines_text_classification.py#L48" rel="nofollow">model_mapping</a>. This is important for testing future compatibility with new models.',rs,re,zs='You’ll also notice <code>ANY</code> is used throughout the <a href="https://github.com/huggingface/transformers/blob/db70426854fe7850f2c5834d633aff637f14772e/tests/pipelines/test_pipelines_text_classification.py#L186" rel="nofollow">run_pipeline_test</a> function. The models are random, so you can’t check the actual values. Using <code>ANY</code> allows the test to match the output of the pipeline type instead.',os,oe,Es="Finally, you should also implement the following 4 tests.",cs,ce,Rs='<li><a href="https://github.com/huggingface/transformers/blob/db70426854fe7850f2c5834d633aff637f14772e/tests/pipelines/test_pipelines_text_classification.py#L59" rel="nofollow">test_small_model_pt</a>, use a small model for these pipelines to make sure they return the correct outputs. The results don’t have to make sense. Each pipeline should return the same result.</li> <li><a href="https://github.com/huggingface/transformers/blob/db70426854fe7850f2c5834d633aff637f14772e/tests/pipelines/test_pipelines_zero_shot_image_classification.py#L187" rel="nofollow">test_large_model_pt</a>, use a realistic model for these pipelines to make sure they return meaningful results. These tests are slow and should be marked as slow.</li>',Ms,Me,ds,ue,ms;return T=new de({props:{title:"Adding a new pipeline",local:"adding-a-new-pipeline",headingTag:"h1"}}),U=new de({props:{title:"Design choices",local:"design-choices",headingTag:"h2"}}),k=new de({props:{title:"Create a pipeline",local:"create-a-pipeline",headingTag:"h2"}}),C=new y({props:{code:"ZnJvbSUyMHRyYW5zZm9ybWVycyUyMGltcG9ydCUyMFBpcGVsaW5lJTBBJTBBY2xhc3MlMjBNeVBpcGVsaW5lKFBpcGVsaW5lKSUzQSUwQSUyMCUyMCUyMCUyMGRlZiUyMF9zYW5pdGl6ZV9wYXJhbWV0ZXJzKHNlbGYlMkMlMjAqKmt3YXJncyklM0ElMEElMEElMjAlMjAlMjAlMjBkZWYlMjBwcmVwcm9jZXNzKHNlbGYlMkMlMjBpbnB1dHMlMkMlMjBhcmdzJTNEMiklM0ElMEElMEElMjAlMjAlMjAlMjBkZWYlMjBfZm9yd2FyZChzZWxmJTJDJTIwbW9kZWxfaW5wdXRzKSUzQSUwQSUwQSUyMCUyMCUyMCUyMGRlZiUyMHBvc3Rwcm9jZXNzKHNlbGYlMkMlMjBtb2RlbF9vdXRwdXRzKSUzQQ==",highlighted:`<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> Pipeline

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyPipeline</span>(<span class="hljs-title class_ inherited__">Pipeline</span>):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_sanitize_parameters</span>(<span class="hljs-params">self, **kwargs</span>):

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">preprocess</span>(<span class="hljs-params">self, inputs, args=<span class="hljs-number">2</span></span>):

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_forward</span>(<span class="hljs-params">self, model_inputs</span>):

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">postprocess</span>(<span class="hljs-params">self, model_outputs</span>):`,wrap:!1}}),$=new y({props:{code:"ZGVmJTIwcHJlcHJvY2VzcyhzZWxmJTJDJTIwaW5wdXRzJTJDJTIwbWF5YmVfYXJnJTNEMiklM0ElMEElMjAlMjAlMjAlMjBtb2RlbF9pbnB1dCUyMCUzRCUyMFRlbnNvcihpbnB1dHMlNUIlMjJpbnB1dF9pZHMlMjIlNUQpJTBBJTIwJTIwJTIwJTIwcmV0dXJuJTIwJTdCJTIybW9kZWxfaW5wdXQlMjIlM0ElMjBtb2RlbF9pbnB1dCU3RA==",highlighted:`<span class="hljs-keyword">def</span> <span class="hljs-title function_">preprocess</span>(<span class="hljs-params">self, inputs, maybe_arg=<span class="hljs-number">2</span></span>):
    model_input = Tensor(inputs[<span class="hljs-string">&quot;input_ids&quot;</span>])
    <span class="hljs-keyword">return</span> {<span class="hljs-string">&quot;model_input&quot;</span>: model_input}`,wrap:!1}}),G=new y({props:{code:"ZGVmJTIwX2ZvcndhcmQoc2VsZiUyQyUyMG1vZGVsX2lucHV0cyklM0ElMEElMjAlMjAlMjAlMjBvdXRwdXRzJTIwJTNEJTIwc2VsZi5tb2RlbCgqKm1vZGVsX2lucHV0cyklMEElMjAlMjAlMjAlMjByZXR1cm4lMjBvdXRwdXRz",highlighted:`<span class="hljs-keyword">def</span> <span class="hljs-title function_">_forward</span>(<span class="hljs-params">self, model_inputs</span>):
    outputs = self.model(**model_inputs)
    <span class="hljs-keyword">return</span> outputs`,wrap:!1}}),v=new y({props:{code:"ZGVmJTIwcG9zdHByb2Nlc3Moc2VsZiUyQyUyMG1vZGVsX291dHB1dHMlMkMlMjB0b3BfayUzRDUpJTNBJTBBJTIwJTIwJTIwJTIwYmVzdF9jbGFzcyUyMCUzRCUyMG1vZGVsX291dHB1dHMlNUIlMjJsb2dpdHMlMjIlNUQuc29mdG1heCgtMSklMEElMjAlMjAlMjAlMjByZXR1cm4lMjBiZXN0X2NsYXNz",highlighted:`<span class="hljs-keyword">def</span> <span class="hljs-title function_">postprocess</span>(<span class="hljs-params">self, model_outputs, top_k=<span class="hljs-number">5</span></span>):
    best_class = model_outputs[<span class="hljs-string">&quot;logits&quot;</span>].softmax(-<span class="hljs-number">1</span>)
    <span class="hljs-keyword">return</span> best_class`,wrap:!1}}),H=new y({props:{code:"ZGVmJTIwX3Nhbml0aXplX3BhcmFtZXRlcnMoc2VsZiUyQyUyMCoqa3dhcmdzKSUzQSUwQSUyMCUyMCUyMCUyMHByZXByb2Nlc3Nfa3dhcmdzJTIwJTNEJTIwJTdCJTdEJTBBJTIwJTIwJTIwJTIwaWYlMjAlMjJtYXliZV9hcmclMjIlMjBpbiUyMGt3YXJncyUzQSUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMHByZXByb2Nlc3Nfa3dhcmdzJTVCJTIybWF5YmVfYXJnJTIyJTVEJTIwJTNEJTIwa3dhcmdzJTVCJTIybWF5YmVfYXJnJTIyJTVEJTBBJTBBJTIwJTIwJTIwJTIwcG9zdHByb2Nlc3Nfa3dhcmdzJTIwJTNEJTIwJTdCJTdEJTBBJTIwJTIwJTIwJTIwaWYlMjAlMjJ0b3BfayUyMiUyMGluJTIwa3dhcmdzJTNBJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwcG9zdHByb2Nlc3Nfa3dhcmdzJTVCJTIydG9wX2slMjIlNUQlMjAlM0QlMjBrd2FyZ3MlNUIlMjJ0b3BfayUyMiU1RCUwQSUyMCUyMCUyMCUyMHJldHVybiUyMHByZXByb2Nlc3Nfa3dhcmdzJTJDJTIwJTdCJTdEJTJDJTIwcG9zdHByb2Nlc3Nfa3dhcmdz",highlighted:`<span class="hljs-keyword">def</span> <span class="hljs-title function_">_sanitize_parameters</span>(<span class="hljs-params">self, **kwargs</span>):
    preprocess_kwargs = {}
    <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;maybe_arg&quot;</span> <span class="hljs-keyword">in</span> kwargs:
        preprocess_kwargs[<span class="hljs-string">&quot;maybe_arg&quot;</span>] = kwargs[<span class="hljs-string">&quot;maybe_arg&quot;</span>]

    postprocess_kwargs = {}
    <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;top_k&quot;</span> <span class="hljs-keyword">in</span> kwargs:
        postprocess_kwargs[<span class="hljs-string">&quot;top_k&quot;</span>] = kwargs[<span class="hljs-string">&quot;top_k&quot;</span>]
    <span class="hljs-keyword">return</span> preprocess_kwargs, {}, postprocess_kwargs`,wrap:!1}}),V=new y({props:{code:"ZnJvbSUyMHRyYW5zZm9ybWVycyUyMGltcG9ydCUyMHBpcGVsaW5lJTBBJTBBcGlwZWxpbmUlMjAlM0QlMjBwaXBlbGluZSglMjJteS10YXNrJTIyKSUwQSUyMyUyMHJldHVybnMlMjAzJTIwbW9zdCUyMGxpa2VseSUyMGxhYmVscyUwQXBpcGVsaW5lKCUyMlRoaXMlMjBpcyUyMHRoZSUyMGJlc3QlMjBtZWFsJTIwSSd2ZSUyMGV2ZXIlMjBoYWQlMjIlMkMlMjB0b3BfayUzRDMpJTBBJTIzJTIwcmV0dXJucyUyMDUlMjBtb3N0JTIwbGlrZWx5JTIwbGFiZWxzJTIwYnklMjBkZWZhdWx0JTBBcGlwZWxpbmUoJTIyVGhpcyUyMGlzJTIwdGhlJTIwYmVzdCUyMG1lYWwlMjBJJ3ZlJTIwZXZlciUyMGhhZCUyMik=",highlighted:`<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> pipeline

pipeline = pipeline(<span class="hljs-string">&quot;my-task&quot;</span>)
<span class="hljs-comment"># returns 3 most likely labels</span>
pipeline(<span class="hljs-string">&quot;This is the best meal I&#x27;ve ever had&quot;</span>, top_k=<span class="hljs-number">3</span>)
<span class="hljs-comment"># returns 5 most likely labels by default</span>
pipeline(<span class="hljs-string">&quot;This is the best meal I&#x27;ve ever had&quot;</span>)`,wrap:!1}}),W=new de({props:{title:"Register a pipeline",local:"register-a-pipeline",headingTag:"h2"}}),z=new y({props:{code:"ZnJvbSUyMHRyYW5zZm9ybWVycy5waXBlbGluZXMlMjBpbXBvcnQlMjBQSVBFTElORV9SRUdJU1RSWSUwQWZyb20lMjB0cmFuc2Zvcm1lcnMlMjBpbXBvcnQlMjBBdXRvTW9kZWxGb3JTZXF1ZW5jZUNsYXNzaWZpY2F0aW9uJTBBJTBBUElQRUxJTkVfUkVHSVNUUlkucmVnaXN0ZXJfcGlwZWxpbmUoJTBBJTIwJTIwJTIwJTIwJTIybmV3LXRhc2slMjIlMkMlMEElMjAlMjAlMjAlMjBwaXBlbGluZV9jbGFzcyUzRE15UGlwZWxpbmUlMkMlMEElMjAlMjAlMjAlMjBwdF9tb2RlbCUzREF1dG9Nb2RlbEZvclNlcXVlbmNlQ2xhc3NpZmljYXRpb24lMkMlMEElMjAlMjAlMjAlMjBkZWZhdWx0JTNEJTdCJTIycHQlMjIlM0ElMjAoJTIydXNlciUyRmF3ZXNvbWUtbW9kZWwlMjIlMkMlMjAlMjJicmFuY2gtbmFtZSUyMiklN0QlMkMlMEElMjAlMjAlMjAlMjB0eXBlJTNEJTIydGV4dCUyMiUyQyUwQSk=",highlighted:`<span class="hljs-keyword">from</span> transformers.pipelines <span class="hljs-keyword">import</span> PIPELINE_REGISTRY
<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoModelForSequenceClassification

PIPELINE_REGISTRY.register_pipeline(
    <span class="hljs-string">&quot;new-task&quot;</span>,
    pipeline_class=MyPipeline,
    pt_model=AutoModelForSequenceClassification,
    default={<span class="hljs-string">&quot;pt&quot;</span>: (<span class="hljs-string">&quot;user/awesome-model&quot;</span>, <span class="hljs-string">&quot;branch-name&quot;</span>)},
    <span class="hljs-built_in">type</span>=<span class="hljs-string">&quot;text&quot;</span>,
)`,wrap:!1}}),E=new de({props:{title:"Share your pipeline",local:"share-your-pipeline",headingTag:"h2"}}),Y=new de({props:{title:"Upload to the Hub",local:"upload-to-the-hub",headingTag:"h3"}}),F=new y({props:{code:"aW1wb3J0JTIwbnVtcHklMjBhcyUyMG5wJTBBZnJvbSUyMHRyYW5zZm9ybWVycyUyMGltcG9ydCUyMFBpcGVsaW5lJTBBJTBBZGVmJTIwc29mdG1heChvdXRwdXRzKSUzQSUwQSUyMCUyMCUyMCUyMG1heGVzJTIwJTNEJTIwbnAubWF4KG91dHB1dHMlMkMlMjBheGlzJTNELTElMkMlMjBrZWVwZGltcyUzRFRydWUpJTBBJTIwJTIwJTIwJTIwc2hpZnRlZF9leHAlMjAlM0QlMjBucC5leHAob3V0cHV0cyUyMC0lMjBtYXhlcyklMEElMjAlMjAlMjAlMjByZXR1cm4lMjBzaGlmdGVkX2V4cCUyMCUyRiUyMHNoaWZ0ZWRfZXhwLnN1bShheGlzJTNELTElMkMlMjBrZWVwZGltcyUzRFRydWUpJTBBJTBBY2xhc3MlMjBQYWlyQ2xhc3NpZmljYXRpb25QaXBlbGluZShQaXBlbGluZSklM0ElMEElMjAlMjAlMjAlMjBkZWYlMjBfc2FuaXRpemVfcGFyYW1ldGVycyhzZWxmJTJDJTIwKiprd2FyZ3MpJTNBJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwcHJlcHJvY2Vzc19rd2FyZ3MlMjAlM0QlMjAlN0IlN0QlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjBpZiUyMCUyMnNlY29uZF90ZXh0JTIyJTIwaW4lMjBrd2FyZ3MlM0ElMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjBwcmVwcm9jZXNzX2t3YXJncyU1QiUyMnNlY29uZF90ZXh0JTIyJTVEJTIwJTNEJTIwa3dhcmdzJTVCJTIyc2Vjb25kX3RleHQlMjIlNUQlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjByZXR1cm4lMjBwcmVwcm9jZXNzX2t3YXJncyUyQyUyMCU3QiU3RCUyQyUyMCU3QiU3RCUwQSUwQSUyMCUyMCUyMCUyMGRlZiUyMHByZXByb2Nlc3Moc2VsZiUyQyUyMHRleHQlMkMlMjBzZWNvbmRfdGV4dCUzRE5vbmUpJTNBJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwcmV0dXJuJTIwc2VsZi50b2tlbml6ZXIodGV4dCUyQyUyMHRleHRfcGFpciUzRHNlY29uZF90ZXh0JTJDJTIwcmV0dXJuX3RlbnNvcnMlM0RzZWxmLmZyYW1ld29yayklMEElMEElMjAlMjAlMjAlMjBkZWYlMjBfZm9yd2FyZChzZWxmJTJDJTIwbW9kZWxfaW5wdXRzKSUzQSUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMHJldHVybiUyMHNlbGYubW9kZWwoKiptb2RlbF9pbnB1dHMpJTBBJTBBJTIwJTIwJTIwJTIwZGVmJTIwcG9zdHByb2Nlc3Moc2VsZiUyQyUyMG1vZGVsX291dHB1dHMpJTNBJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwbG9naXRzJTIwJTNEJTIwbW9kZWxfb3V0cHV0cy5sb2dpdHMlNUIwJTVELm51bXB5KCklMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjBwcm9iYWJpbGl0aWVzJTIwJTNEJTIwc29mdG1heChsb2dpdHMpJTBBJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwYmVzdF9jbGFzcyUyMCUzRCUyMG5wLmFyZ21heChwcm9iYWJpbGl0aWVzKSUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMGxhYmVsJTIwJTNEJTIwc2VsZi5tb2RlbC5jb25maWcuaWQybGFiZWwlNUJiZXN0X2NsYXNzJTVEJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwc2NvcmUlMjAlM0QlMjBwcm9iYWJpbGl0aWVzJTVCYmVzdF9jbGFzcyU1RC5pdGVtKCklMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjBsb2dpdHMlMjAlM0QlMjBsb2dpdHMudG9saXN0KCklMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjByZXR1cm4lMjAlN0IlMjJsYWJlbCUyMiUzQSUyMGxhYmVsJTJDJTIwJTIyc2NvcmUlMjIlM0ElMjBzY29yZSUyQyUyMCUyMmxvZ2l0cyUyMiUzQSUyMGxvZ2l0cyU3RA==",highlighted:`<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> Pipeline

<span class="hljs-keyword">def</span> <span class="hljs-title function_">softmax</span>(<span class="hljs-params">outputs</span>):
    maxes = np.<span class="hljs-built_in">max</span>(outputs, axis=-<span class="hljs-number">1</span>, keepdims=<span class="hljs-literal">True</span>)
    shifted_exp = np.exp(outputs - maxes)
    <span class="hljs-keyword">return</span> shifted_exp / shifted_exp.<span class="hljs-built_in">sum</span>(axis=-<span class="hljs-number">1</span>, keepdims=<span class="hljs-literal">True</span>)

<span class="hljs-keyword">class</span> <span class="hljs-title class_">PairClassificationPipeline</span>(<span class="hljs-title class_ inherited__">Pipeline</span>):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_sanitize_parameters</span>(<span class="hljs-params">self, **kwargs</span>):
        preprocess_kwargs = {}
        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;second_text&quot;</span> <span class="hljs-keyword">in</span> kwargs:
            preprocess_kwargs[<span class="hljs-string">&quot;second_text&quot;</span>] = kwargs[<span class="hljs-string">&quot;second_text&quot;</span>]
        <span class="hljs-keyword">return</span> preprocess_kwargs, {}, {}

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">preprocess</span>(<span class="hljs-params">self, text, second_text=<span class="hljs-literal">None</span></span>):
        <span class="hljs-keyword">return</span> self.tokenizer(text, text_pair=second_text, return_tensors=self.framework)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_forward</span>(<span class="hljs-params">self, model_inputs</span>):
        <span class="hljs-keyword">return</span> self.model(**model_inputs)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">postprocess</span>(<span class="hljs-params">self, model_outputs</span>):
        logits = model_outputs.logits[<span class="hljs-number">0</span>].numpy()
        probabilities = softmax(logits)

        best_class = np.argmax(probabilities)
        label = self.model.config.id2label[best_class]
        score = probabilities[best_class].item()
        logits = logits.tolist()
        <span class="hljs-keyword">return</span> {<span class="hljs-string">&quot;label&quot;</span>: label, <span class="hljs-string">&quot;score&quot;</span>: score, <span class="hljs-string">&quot;logits&quot;</span>: logits}`,wrap:!1}}),L=new y({props:{code:"ZnJvbSUyMHBhaXJfY2xhc3NpZmljYXRpb24lMjBpbXBvcnQlMjBQYWlyQ2xhc3NpZmljYXRpb25QaXBlbGluZSUwQWZyb20lMjB0cmFuc2Zvcm1lcnMucGlwZWxpbmVzJTIwaW1wb3J0JTIwUElQRUxJTkVfUkVHSVNUUlklMEFmcm9tJTIwdHJhbnNmb3JtZXJzJTIwaW1wb3J0JTIwQXV0b01vZGVsRm9yU2VxdWVuY2VDbGFzc2lmaWNhdGlvbiUwQSUwQVBJUEVMSU5FX1JFR0lTVFJZLnJlZ2lzdGVyX3BpcGVsaW5lKCUwQSUyMCUyMCUyMCUyMCUyMnBhaXItY2xhc3NpZmljYXRpb24lMjIlMkMlMEElMjAlMjAlMjAlMjBwaXBlbGluZV9jbGFzcyUzRFBhaXJDbGFzc2lmaWNhdGlvblBpcGVsaW5lJTJDJTBBJTIwJTIwJTIwJTIwcHRfbW9kZWwlM0RBdXRvTW9kZWxGb3JTZXF1ZW5jZUNsYXNzaWZpY2F0aW9uJTJDJTBBKQ==",highlighted:`<span class="hljs-keyword">from</span> pair_classification <span class="hljs-keyword">import</span> PairClassificationPipeline
<span class="hljs-keyword">from</span> transformers.pipelines <span class="hljs-keyword">import</span> PIPELINE_REGISTRY
<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoModelForSequenceClassification

PIPELINE_REGISTRY.register_pipeline(
    <span class="hljs-string">&quot;pair-classification&quot;</span>,
    pipeline_class=PairClassificationPipeline,
    pt_model=AutoModelForSequenceClassification,
)`,wrap:!1}}),D=new y({props:{code:"JTIwJTIwJTIyY3VzdG9tX3BpcGVsaW5lcyUyMiUzQSUyMCU3QiUwQSUyMCUyMCUyMCUyMCUyMnBhaXItY2xhc3NpZmljYXRpb24lMjIlM0ElMjAlN0IlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjJpbXBsJTIyJTNBJTIwJTIycGFpcl9jbGFzc2lmaWNhdGlvbi5QYWlyQ2xhc3NpZmljYXRpb25QaXBlbGluZSUyMiUyQyUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMnB0JTIyJTNBJTIwJTVCJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIyQXV0b01vZGVsRm9yU2VxdWVuY2VDbGFzc2lmaWNhdGlvbiUyMiUwQSUyMCUyMCUyMCUyMCUyMCUyMCU1RCUyQyUwQSUyMCUyMCUyMCUyMCU3RCUwQSUyMCUyMCU3RCUyQw==",highlighted:`  <span class="hljs-attr">&quot;custom_pipelines&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">&quot;pair-classification&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">&quot;impl&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;pair_classification.PairClassificationPipeline&quot;</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">&quot;pt&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-string">&quot;AutoModelForSequenceClassification&quot;</span>
      <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>`,wrap:!1}}),ee=new y({props:{code:"ZnJvbSUyMHRyYW5zZm9ybWVycyUyMGltcG9ydCUyMHBpcGVsaW5lJTBBJTBBcGlwZWxpbmUlMjAlM0QlMjBwaXBlbGluZSh0YXNrJTNEJTIycGFpci1jbGFzc2lmaWNhdGlvbiUyMiUyQyUyMG1vZGVsJTNEJTIyc2d1Z2dlciUyRmZpbmV0dW5lZC1iZXJ0LW1ycGMlMjIpJTBBcGlwZWxpbmUucHVzaF90b19odWIoJTIycGFpci1jbGFzc2lmaWNhdGlvbi1waXBlbGluZSUyMik=",highlighted:`<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> pipeline

pipeline = pipeline(task=<span class="hljs-string">&quot;pair-classification&quot;</span>, model=<span class="hljs-string">&quot;sgugger/finetuned-bert-mrpc&quot;</span>)
pipeline.push_to_hub(<span class="hljs-string">&quot;pair-classification-pipeline&quot;</span>)`,wrap:!1}}),le=new y({props:{code:"ZnJvbSUyMHRyYW5zZm9ybWVycyUyMGltcG9ydCUyMHBpcGVsaW5lJTBBJTBBcGlwZWxpbmUlMjAlM0QlMjBwaXBlbGluZSh0YXNrJTNEJTIycGFpci1jbGFzc2lmaWNhdGlvbiUyMiUyQyUyMHRydXN0X3JlbW90ZV9jb2RlJTNEVHJ1ZSk=",highlighted:`<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> pipeline

pipeline = pipeline(task=<span class="hljs-string">&quot;pair-classification&quot;</span>, trust_remote_code=<span class="hljs-literal">True</span>)`,wrap:!1}}),te=new de({props:{title:"Add to Transformers",local:"add-to-transformers",headingTag:"h3"}}),Me=new Ds({props:{source:"https://github.com/huggingface/transformers/blob/main/docs/source/en/add_new_pipeline.md"}}),{c(){h=i("meta"),he=a(),me=i("p"),fe=a(),o(T.$$.fragment),we=a(),J=i("p"),J.innerHTML=ys,je=a(),b=i("p"),b.textContent=hs,Te=a(),o(U.$$.fragment),Je=a(),I=i("p"),I.innerHTML=fs,be=a(),B=i("p"),B.innerHTML=ws,Ue=a(),_=i("p"),_.innerHTML=js,Ie=a(),o(k.$$.fragment),Be=a(),g=i("p"),g.innerHTML=Ts,_e=a(),o(C.$$.fragment),ke=a(),Z=i("ol"),Z.innerHTML=Js,ge=a(),o($.$$.fragment),Ce=a(),f=i("ol"),f.innerHTML=bs,Ze=a(),o(G.$$.fragment),$e=a(),w=i("ol"),w.innerHTML=Us,Ge=a(),o(v.$$.fragment),ve=a(),j=i("ol"),j.innerHTML=Is,Ae=a(),A=i("p"),A.innerHTML=Bs,He=a(),o(H.$$.fragment),xe=a(),x=i("p"),x.textContent=_s,Ve=a(),o(V.$$.fragment),We=a(),o(W.$$.fragment),Xe=a(),X=i("p"),X.innerHTML=ks,Ne=a(),N=i("ul"),N.innerHTML=gs,ze=a(),o(z.$$.fragment),Ee=a(),o(E.$$.fragment),Re=a(),R=i("p"),R.innerHTML=Cs,Qe=a(),Q=i("p"),Q.innerHTML=Zs,Ye=a(),o(Y.$$.fragment),Se=a(),S=i("p"),S.textContent=$s,qe=a(),q=i("p"),q.textContent=Gs,Fe=a(),o(F.$$.fragment),Pe=a(),P=i("p"),P.innerHTML=vs,Le=a(),o(L.$$.fragment),Ke=a(),K=i("p"),K.innerHTML=As,De=a(),o(D.$$.fragment),Oe=a(),O=i("p"),O.innerHTML=Hs,es=a(),o(ee.$$.fragment),ss=a(),se=i("p"),se.innerHTML=xs,ls=a(),o(le.$$.fragment),ts=a(),o(te.$$.fragment),as=a(),ae=i("p"),ae.textContent=Vs,ns=a(),ne=i("p"),ne.innerHTML=Ws,is=a(),ie=i("p"),ie.innerHTML=Xs,ps=a(),pe=i("p"),pe.innerHTML=Ns,rs=a(),re=i("p"),re.innerHTML=zs,os=a(),oe=i("p"),oe.textContent=Es,cs=a(),ce=i("ol"),ce.innerHTML=Rs,Ms=a(),o(Me.$$.fragment),ds=a(),ue=i("p"),this.h()},l(e){const s=Ls("svelte-u9bgzb",document.head);h=p(s,"META",{name:!0,content:!0}),s.forEach(l),he=n(e),me=p(e,"P",{}),Qs(me).forEach(l),fe=n(e),c(T.$$.fragment,e),we=n(e),J=p(e,"P",{"data-svelte-h":!0}),r(J)!=="svelte-1uhshlj"&&(J.innerHTML=ys),je=n(e),b=p(e,"P",{"data-svelte-h":!0}),r(b)!=="svelte-1qih3n5"&&(b.textContent=hs),Te=n(e),c(U.$$.fragment,e),Je=n(e),I=p(e,"P",{"data-svelte-h":!0}),r(I)!=="svelte-67iu06"&&(I.innerHTML=fs),be=n(e),B=p(e,"P",{"data-svelte-h":!0}),r(B)!=="svelte-1fsjnrn"&&(B.innerHTML=ws),Ue=n(e),_=p(e,"P",{"data-svelte-h":!0}),r(_)!=="svelte-1ovbz0b"&&(_.innerHTML=js),Ie=n(e),c(k.$$.fragment,e),Be=n(e),g=p(e,"P",{"data-svelte-h":!0}),r(g)!=="svelte-1i1hspd"&&(g.innerHTML=Ts),_e=n(e),c(C.$$.fragment,e),ke=n(e),Z=p(e,"OL",{"data-svelte-h":!0}),r(Z)!=="svelte-ls3j8c"&&(Z.innerHTML=Js),ge=n(e),c($.$$.fragment,e),Ce=n(e),f=p(e,"OL",{start:!0,"data-svelte-h":!0}),r(f)!=="svelte-13h6esa"&&(f.innerHTML=bs),Ze=n(e),c(G.$$.fragment,e),$e=n(e),w=p(e,"OL",{start:!0,"data-svelte-h":!0}),r(w)!=="svelte-mkxo99"&&(w.innerHTML=Us),Ge=n(e),c(v.$$.fragment,e),ve=n(e),j=p(e,"OL",{start:!0,"data-svelte-h":!0}),r(j)!=="svelte-rbjxjp"&&(j.innerHTML=Is),Ae=n(e),A=p(e,"P",{"data-svelte-h":!0}),r(A)!=="svelte-v5ycok"&&(A.innerHTML=Bs),He=n(e),c(H.$$.fragment,e),xe=n(e),x=p(e,"P",{"data-svelte-h":!0}),r(x)!=="svelte-14yp2qx"&&(x.textContent=_s),Ve=n(e),c(V.$$.fragment,e),We=n(e),c(W.$$.fragment,e),Xe=n(e),X=p(e,"P",{"data-svelte-h":!0}),r(X)!=="svelte-r2irul"&&(X.innerHTML=ks),Ne=n(e),N=p(e,"UL",{"data-svelte-h":!0}),r(N)!=="svelte-y800ze"&&(N.innerHTML=gs),ze=n(e),c(z.$$.fragment,e),Ee=n(e),c(E.$$.fragment,e),Re=n(e),R=p(e,"P",{"data-svelte-h":!0}),r(R)!=="svelte-dw693k"&&(R.innerHTML=Cs),Qe=n(e),Q=p(e,"P",{"data-svelte-h":!0}),r(Q)!=="svelte-14jfw4s"&&(Q.innerHTML=Zs),Ye=n(e),c(Y.$$.fragment,e),Se=n(e),S=p(e,"P",{"data-svelte-h":!0}),r(S)!=="svelte-18lz264"&&(S.textContent=$s),qe=n(e),q=p(e,"P",{"data-svelte-h":!0}),r(q)!=="svelte-5tv2km"&&(q.textContent=Gs),Fe=n(e),c(F.$$.fragment,e),Pe=n(e),P=p(e,"P",{"data-svelte-h":!0}),r(P)!=="svelte-95yu2g"&&(P.innerHTML=vs),Le=n(e),c(L.$$.fragment,e),Ke=n(e),K=p(e,"P",{"data-svelte-h":!0}),r(K)!=="svelte-14qyyu6"&&(K.innerHTML=As),De=n(e),c(D.$$.fragment,e),Oe=n(e),O=p(e,"P",{"data-svelte-h":!0}),r(O)!=="svelte-a41vc2"&&(O.innerHTML=Hs),es=n(e),c(ee.$$.fragment,e),ss=n(e),se=p(e,"P",{"data-svelte-h":!0}),r(se)!=="svelte-18tixm2"&&(se.innerHTML=xs),ls=n(e),c(le.$$.fragment,e),ts=n(e),c(te.$$.fragment,e),as=n(e),ae=p(e,"P",{"data-svelte-h":!0}),r(ae)!=="svelte-z2ovgw"&&(ae.textContent=Vs),ns=n(e),ne=p(e,"P",{"data-svelte-h":!0}),r(ne)!=="svelte-101anii"&&(ne.innerHTML=Ws),is=n(e),ie=p(e,"P",{"data-svelte-h":!0}),r(ie)!=="svelte-1lm54uv"&&(ie.innerHTML=Xs),ps=n(e),pe=p(e,"P",{"data-svelte-h":!0}),r(pe)!=="svelte-lg6182"&&(pe.innerHTML=Ns),rs=n(e),re=p(e,"P",{"data-svelte-h":!0}),r(re)!=="svelte-1cmkq36"&&(re.innerHTML=zs),os=n(e),oe=p(e,"P",{"data-svelte-h":!0}),r(oe)!=="svelte-93pg6i"&&(oe.textContent=Es),cs=n(e),ce=p(e,"OL",{"data-svelte-h":!0}),r(ce)!=="svelte-new3tb"&&(ce.innerHTML=Rs),Ms=n(e),c(Me.$$.fragment,e),ds=n(e),ue=p(e,"P",{}),Qs(ue).forEach(l),this.h()},h(){ye(h,"name","hf:doc:metadata"),ye(h,"content",el),ye(f,"start","2"),ye(w,"start","3"),ye(j,"start","4")},m(e,s){Ks(document.head,h),t(e,he,s),t(e,me,s),t(e,fe,s),M(T,e,s),t(e,we,s),t(e,J,s),t(e,je,s),t(e,b,s),t(e,Te,s),M(U,e,s),t(e,Je,s),t(e,I,s),t(e,be,s),t(e,B,s),t(e,Ue,s),t(e,_,s),t(e,Ie,s),M(k,e,s),t(e,Be,s),t(e,g,s),t(e,_e,s),M(C,e,s),t(e,ke,s),t(e,Z,s),t(e,ge,s),M($,e,s),t(e,Ce,s),t(e,f,s),t(e,Ze,s),M(G,e,s),t(e,$e,s),t(e,w,s),t(e,Ge,s),M(v,e,s),t(e,ve,s),t(e,j,s),t(e,Ae,s),t(e,A,s),t(e,He,s),M(H,e,s),t(e,xe,s),t(e,x,s),t(e,Ve,s),M(V,e,s),t(e,We,s),M(W,e,s),t(e,Xe,s),t(e,X,s),t(e,Ne,s),t(e,N,s),t(e,ze,s),M(z,e,s),t(e,Ee,s),M(E,e,s),t(e,Re,s),t(e,R,s),t(e,Qe,s),t(e,Q,s),t(e,Ye,s),M(Y,e,s),t(e,Se,s),t(e,S,s),t(e,qe,s),t(e,q,s),t(e,Fe,s),M(F,e,s),t(e,Pe,s),t(e,P,s),t(e,Le,s),M(L,e,s),t(e,Ke,s),t(e,K,s),t(e,De,s),M(D,e,s),t(e,Oe,s),t(e,O,s),t(e,es,s),M(ee,e,s),t(e,ss,s),t(e,se,s),t(e,ls,s),M(le,e,s),t(e,ts,s),M(te,e,s),t(e,as,s),t(e,ae,s),t(e,ns,s),t(e,ne,s),t(e,is,s),t(e,ie,s),t(e,ps,s),t(e,pe,s),t(e,rs,s),t(e,re,s),t(e,os,s),t(e,oe,s),t(e,cs,s),t(e,ce,s),t(e,Ms,s),M(Me,e,s),t(e,ds,s),t(e,ue,s),ms=!0},p:Ss,i(e){ms||(d(T.$$.fragment,e),d(U.$$.fragment,e),d(k.$$.fragment,e),d(C.$$.fragment,e),d($.$$.fragment,e),d(G.$$.fragment,e),d(v.$$.fragment,e),d(H.$$.fragment,e),d(V.$$.fragment,e),d(W.$$.fragment,e),d(z.$$.fragment,e),d(E.$$.fragment,e),d(Y.$$.fragment,e),d(F.$$.fragment,e),d(L.$$.fragment,e),d(D.$$.fragment,e),d(ee.$$.fragment,e),d(le.$$.fragment,e),d(te.$$.fragment,e),d(Me.$$.fragment,e),ms=!0)},o(e){m(T.$$.fragment,e),m(U.$$.fragment,e),m(k.$$.fragment,e),m(C.$$.fragment,e),m($.$$.fragment,e),m(G.$$.fragment,e),m(v.$$.fragment,e),m(H.$$.fragment,e),m(V.$$.fragment,e),m(W.$$.fragment,e),m(z.$$.fragment,e),m(E.$$.fragment,e),m(Y.$$.fragment,e),m(F.$$.fragment,e),m(L.$$.fragment,e),m(D.$$.fragment,e),m(ee.$$.fragment,e),m(le.$$.fragment,e),m(te.$$.fragment,e),m(Me.$$.fragment,e),ms=!1},d(e){e&&(l(he),l(me),l(fe),l(we),l(J),l(je),l(b),l(Te),l(Je),l(I),l(be),l(B),l(Ue),l(_),l(Ie),l(Be),l(g),l(_e),l(ke),l(Z),l(ge),l(Ce),l(f),l(Ze),l($e),l(w),l(Ge),l(ve),l(j),l(Ae),l(A),l(He),l(xe),l(x),l(Ve),l(We),l(Xe),l(X),l(Ne),l(N),l(ze),l(Ee),l(Re),l(R),l(Qe),l(Q),l(Ye),l(Se),l(S),l(qe),l(q),l(Fe),l(Pe),l(P),l(Le),l(Ke),l(K),l(De),l(Oe),l(O),l(es),l(ss),l(se),l(ls),l(ts),l(as),l(ae),l(ns),l(ne),l(is),l(ie),l(ps),l(pe),l(rs),l(re),l(os),l(oe),l(cs),l(ce),l(Ms),l(ds),l(ue)),l(h),u(T,e),u(U,e),u(k,e),u(C,e),u($,e),u(G,e),u(v,e),u(H,e),u(V,e),u(W,e),u(z,e),u(E,e),u(Y,e),u(F,e),u(L,e),u(D,e),u(ee,e),u(le,e),u(te,e),u(Me,e)}}}const el='{"title":"Adding a new pipeline","local":"adding-a-new-pipeline","sections":[{"title":"Design choices","local":"design-choices","sections":[],"depth":2},{"title":"Create a pipeline","local":"create-a-pipeline","sections":[],"depth":2},{"title":"Register a pipeline","local":"register-a-pipeline","sections":[],"depth":2},{"title":"Share your pipeline","local":"share-your-pipeline","sections":[{"title":"Upload to the Hub","local":"upload-to-the-hub","sections":[],"depth":3},{"title":"Add to Transformers","local":"add-to-transformers","sections":[],"depth":3}],"depth":2}],"depth":1}';function sl(us){return qs(()=>{new URLSearchParams(window.location.search).get("fw")}),[]}class il extends Fs{constructor(h){super(),Ps(this,h,sl,Os,Ys,{})}}export{il as component};
