import{s as fe,o as ie,n as O}from"../chunks/scheduler.18a86fab.js";import{S as pe,i as ce,g as w,s as u,r as y,A as $e,h as b,f as a,c as d,j as K,u as v,x as L,k as ae,y as N,a as f,v as M,d as T,t as C,w as V}from"../chunks/index.98837b22.js";import{T as me}from"../chunks/Tip.77304350.js";import{C as X}from"../chunks/CodeBlock.8d0c2e8a.js";import{H as re,E as ue}from"../chunks/getInferenceSnippets.06c2775f.js";import{H as se,a as q}from"../chunks/HfOption.6641485e.js";function de(x){let r,$="Use the <code>--nproc_per_node</code> to select how many accelerators to use.",o,p,n;return p=new X({props:{code:"dG9yY2hydW4lMjAtLW5wcm9jX3Blcl9ub2RlJTNEMiUyMCUyMHRyYWluZXItcHJvZ3JhbS5weSUyMC4uLg==",highlighted:"torchrun --nproc_per_node=2  trainer-program.py ...",wrap:!1}}),{c(){r=w("p"),r.innerHTML=$,o=u(),y(p.$$.fragment)},l(t){r=b(t,"P",{"data-svelte-h":!0}),L(r)!=="svelte-122e78m"&&(r.innerHTML=$),o=d(t),v(p.$$.fragment,t)},m(t,l){f(t,r,l),f(t,o,l),M(p,t,l),n=!0},p:O,i(t){n||(T(p.$$.fragment,t),n=!0)},o(t){C(p.$$.fragment,t),n=!1},d(t){t&&(a(r),a(o)),V(p,t)}}}function he(x){let r,$="Use <code>--num_processes</code> to select how many accelerators to use.",o,p,n;return p=new X({props:{code:"YWNjZWxlcmF0ZSUyMGxhdW5jaCUyMC0tbnVtX3Byb2Nlc3NlcyUyMDIlMjB0cmFpbmVyLXByb2dyYW0ucHklMjAuLi4=",highlighted:"accelerate launch --num_processes 2 trainer-program.py ...",wrap:!1}}),{c(){r=w("p"),r.innerHTML=$,o=u(),y(p.$$.fragment)},l(t){r=b(t,"P",{"data-svelte-h":!0}),L(r)!=="svelte-v32a1a"&&(r.innerHTML=$),o=d(t),v(p.$$.fragment,t)},m(t,l){f(t,r,l),f(t,o,l),M(p,t,l),n=!0},p:O,i(t){n||(T(p.$$.fragment,t),n=!0)},o(t){C(p.$$.fragment,t),n=!1},d(t){t&&(a(r),a(o)),V(p,t)}}}function _e(x){let r,$="Use <code>--num_gpus</code> to select how many GPUs to use.",o,p,n;return p=new X({props:{code:"ZGVlcHNwZWVkJTIwLS1udW1fZ3B1cyUyMDIlMjB0cmFpbmVyLXByb2dyYW0ucHklMjAuLi4=",highlighted:"deepspeed --num_gpus 2 trainer-program.py ...",wrap:!1}}),{c(){r=w("p"),r.innerHTML=$,o=u(),y(p.$$.fragment)},l(t){r=b(t,"P",{"data-svelte-h":!0}),L(r)!=="svelte-14evfjd"&&(r.innerHTML=$),o=d(t),v(p.$$.fragment,t)},m(t,l){f(t,r,l),f(t,o,l),M(p,t,l),n=!0},p:O,i(t){n||(T(p.$$.fragment,t),n=!0)},o(t){C(p.$$.fragment,t),n=!1},d(t){t&&(a(r),a(o)),V(p,t)}}}function ge(x){let r,$,o,p,n,t;return r=new q({props:{id:"select-accelerator",option:"torchrun",$$slots:{default:[de]},$$scope:{ctx:x}}}),o=new q({props:{id:"select-accelerator",option:"Accelerate",$$slots:{default:[he]},$$scope:{ctx:x}}}),n=new q({props:{id:"select-accelerator",option:"DeepSpeed",$$slots:{default:[_e]},$$scope:{ctx:x}}}),{c(){y(r.$$.fragment),$=u(),y(o.$$.fragment),p=u(),y(n.$$.fragment)},l(l){v(r.$$.fragment,l),$=d(l),v(o.$$.fragment,l),p=d(l),v(n.$$.fragment,l)},m(l,m){M(r,l,m),f(l,$,m),M(o,l,m),f(l,p,m),M(n,l,m),t=!0},p(l,m){const H={};m&2&&(H.$$scope={dirty:m,ctx:l}),r.$set(H);const U={};m&2&&(U.$$scope={dirty:m,ctx:l}),o.$set(U);const E={};m&2&&(E.$$scope={dirty:m,ctx:l}),n.$set(E)},i(l){t||(T(r.$$.fragment,l),T(o.$$.fragment,l),T(n.$$.fragment,l),t=!0)},o(l){C(r.$$.fragment,l),C(o.$$.fragment,l),C(n.$$.fragment,l),t=!1},d(l){l&&(a($),a(p)),V(r,l),V(o,l),V(n,l)}}}function we(x){let r,$,o,p=`Only GPUs 0 and 2 are “visible” to PyTorch and are mapped to <code>cuda:0</code> and <code>cuda:1</code> respectively.<br/>
To reverse the order (use GPU 2 as <code>cuda:0</code> and GPU 0 as <code>cuda:1</code>):`,n,t,l,m,H="To run without any GPUs:",U,E,D,g,j="You can also control the order of CUDA devices using <code>CUDA_DEVICE_ORDER</code>:",I,i,_,P,Y="Order by PCIe bus ID (matches <code>nvidia-smi</code>):",S,R,F,B,Q,W="Order by compute capability (fastest first):",G,k,J;return r=new X({props:{code:"Q1VEQV9WSVNJQkxFX0RFVklDRVMlM0QwJTJDMiUyMHRvcmNocnVuJTIwdHJhaW5lci1wcm9ncmFtLnB5JTIwLi4u",highlighted:"CUDA_VISIBLE_DEVICES=0,2 torchrun trainer-program.py ...",wrap:!1}}),t=new X({props:{code:"Q1VEQV9WSVNJQkxFX0RFVklDRVMlM0QyJTJDMCUyMHRvcmNocnVuJTIwdHJhaW5lci1wcm9ncmFtLnB5JTIwLi4u",highlighted:"CUDA_VISIBLE_DEVICES=2,0 torchrun trainer-program.py ...",wrap:!1}}),E=new X({props:{code:"Q1VEQV9WSVNJQkxFX0RFVklDRVMlM0QlMjBweXRob24lMjB0cmFpbmVyLXByb2dyYW0ucHklMjAuLi4=",highlighted:"CUDA_VISIBLE_DEVICES= python trainer-program.py ...",wrap:!1}}),R=new X({props:{code:"ZXhwb3J0JTIwQ1VEQV9ERVZJQ0VfT1JERVIlM0RQQ0lfQlVTX0lE",highlighted:'<span class="hljs-built_in">export</span> CUDA_DEVICE_ORDER=PCI_BUS_ID',wrap:!1}}),k=new X({props:{code:"ZXhwb3J0JTIwQ1VEQV9ERVZJQ0VfT1JERVIlM0RGQVNURVNUX0ZJUlNU",highlighted:'<span class="hljs-built_in">export</span> CUDA_DEVICE_ORDER=FASTEST_FIRST',wrap:!1}}),{c(){y(r.$$.fragment),$=u(),o=w("p"),o.innerHTML=p,n=u(),y(t.$$.fragment),l=u(),m=w("p"),m.textContent=H,U=u(),y(E.$$.fragment),D=u(),g=w("p"),g.innerHTML=j,I=u(),i=w("ul"),_=w("li"),P=w("p"),P.innerHTML=Y,S=u(),y(R.$$.fragment),F=u(),B=w("li"),Q=w("p"),Q.textContent=W,G=u(),y(k.$$.fragment)},l(s){v(r.$$.fragment,s),$=d(s),o=b(s,"P",{"data-svelte-h":!0}),L(o)!=="svelte-18s2t1n"&&(o.innerHTML=p),n=d(s),v(t.$$.fragment,s),l=d(s),m=b(s,"P",{"data-svelte-h":!0}),L(m)!=="svelte-49jd1f"&&(m.textContent=H),U=d(s),v(E.$$.fragment,s),D=d(s),g=b(s,"P",{"data-svelte-h":!0}),L(g)!=="svelte-mgpeox"&&(g.innerHTML=j),I=d(s),i=b(s,"UL",{});var h=K(i);_=b(h,"LI",{});var Z=K(_);P=b(Z,"P",{"data-svelte-h":!0}),L(P)!=="svelte-t0t69l"&&(P.innerHTML=Y),S=d(Z),v(R.$$.fragment,Z),Z.forEach(a),F=d(h),B=b(h,"LI",{});var A=K(B);Q=b(A,"P",{"data-svelte-h":!0}),L(Q)!=="svelte-1s5093"&&(Q.textContent=W),G=d(A),v(k.$$.fragment,A),A.forEach(a),h.forEach(a)},m(s,h){M(r,s,h),f(s,$,h),f(s,o,h),f(s,n,h),M(t,s,h),f(s,l,h),f(s,m,h),f(s,U,h),M(E,s,h),f(s,D,h),f(s,g,h),f(s,I,h),f(s,i,h),N(i,_),N(_,P),N(_,S),M(R,_,null),N(i,F),N(i,B),N(B,Q),N(B,G),M(k,B,null),J=!0},p:O,i(s){J||(T(r.$$.fragment,s),T(t.$$.fragment,s),T(E.$$.fragment,s),T(R.$$.fragment,s),T(k.$$.fragment,s),J=!0)},o(s){C(r.$$.fragment,s),C(t.$$.fragment,s),C(E.$$.fragment,s),C(R.$$.fragment,s),C(k.$$.fragment,s),J=!1},d(s){s&&(a($),a(o),a(n),a(l),a(m),a(U),a(D),a(g),a(I),a(i)),V(r,s),V(t,s),V(E,s),V(R),V(k)}}}function be(x){let r,$,o,p=`Only XPUs 0 and 2 are “visible” to PyTorch and are mapped to <code>xpu:0</code> and <code>xpu:1</code> respectively.<br/>
To reverse the order (use XPU 2 as <code>xpu:0</code> and XPU 0 as <code>xpu:1</code>):`,n,t,l,m,H="You can also control the order of Intel XPUs with:",U,E,D,g,j='For more information about device enumeration and sorting on Intel XPU, please refer to the <a href="https://github.com/oneapi-src/level-zero/blob/master/README.md?plain=1#L87" rel="nofollow">Level Zero</a> documentation.',I;return r=new X({props:{code:"WkVfQUZGSU5JVFlfTUFTSyUzRDAlMkMyJTIwdG9yY2hydW4lMjB0cmFpbmVyLXByb2dyYW0ucHklMjAuLi4=",highlighted:"ZE_AFFINITY_MASK=0,2 torchrun trainer-program.py ...",wrap:!1}}),t=new X({props:{code:"WkVfQUZGSU5JVFlfTUFTSyUzRDIlMkMwJTIwdG9yY2hydW4lMjB0cmFpbmVyLXByb2dyYW0ucHklMjAuLi4=",highlighted:"ZE_AFFINITY_MASK=2,0 torchrun trainer-program.py ...",wrap:!1}}),E=new X({props:{code:"ZXhwb3J0JTIwWkVfRU5BQkxFX1BDSV9JRF9ERVZJQ0VfT1JERVIlM0Qx",highlighted:'<span class="hljs-built_in">export</span> ZE_ENABLE_PCI_ID_DEVICE_ORDER=1',wrap:!1}}),{c(){y(r.$$.fragment),$=u(),o=w("p"),o.innerHTML=p,n=u(),y(t.$$.fragment),l=u(),m=w("p"),m.textContent=H,U=u(),y(E.$$.fragment),D=u(),g=w("p"),g.innerHTML=j},l(i){v(r.$$.fragment,i),$=d(i),o=b(i,"P",{"data-svelte-h":!0}),L(o)!=="svelte-7wyj8o"&&(o.innerHTML=p),n=d(i),v(t.$$.fragment,i),l=d(i),m=b(i,"P",{"data-svelte-h":!0}),L(m)!=="svelte-19d1b89"&&(m.textContent=H),U=d(i),v(E.$$.fragment,i),D=d(i),g=b(i,"P",{"data-svelte-h":!0}),L(g)!=="svelte-snvz55"&&(g.innerHTML=j)},m(i,_){M(r,i,_),f(i,$,_),f(i,o,_),f(i,n,_),M(t,i,_),f(i,l,_),f(i,m,_),f(i,U,_),M(E,i,_),f(i,D,_),f(i,g,_),I=!0},p:O,i(i){I||(T(r.$$.fragment,i),T(t.$$.fragment,i),T(E.$$.fragment,i),I=!0)},o(i){C(r.$$.fragment,i),C(t.$$.fragment,i),C(E.$$.fragment,i),I=!1},d(i){i&&(a($),a(o),a(n),a(l),a(m),a(U),a(D),a(g)),V(r,i),V(t,i),V(E,i)}}}function ye(x){let r,$,o,p;return r=new q({props:{id:"accelerator-type",option:"CUDA",$$slots:{default:[we]},$$scope:{ctx:x}}}),o=new q({props:{id:"accelerator-type",option:"Intel XPU",$$slots:{default:[be]},$$scope:{ctx:x}}}),{c(){y(r.$$.fragment),$=u(),y(o.$$.fragment)},l(n){v(r.$$.fragment,n),$=d(n),v(o.$$.fragment,n)},m(n,t){M(r,n,t),f(n,$,t),M(o,n,t),p=!0},p(n,t){const l={};t&2&&(l.$$scope={dirty:t,ctx:n}),r.$set(l);const m={};t&2&&(m.$$scope={dirty:t,ctx:n}),o.$set(m)},i(n){p||(T(r.$$.fragment,n),T(o.$$.fragment,n),p=!0)},o(n){C(r.$$.fragment,n),C(o.$$.fragment,n),p=!1},d(n){n&&a($),V(r,n),V(o,n)}}}function ve(x){let r,$="Environment variables can be exported instead of being added to the command line. This is not recommended because it can be confusing if you forget how the environment variable was set up and you end up using the wrong accelerators. Instead, it is common practice to set the environment variable for a specific training run on the same command line.";return{c(){r=w("p"),r.textContent=$},l(o){r=b(o,"P",{"data-svelte-h":!0}),L(r)!=="svelte-x4bfvm"&&(r.textContent=$)},m(o,p){f(o,r,p)},p:O,d(o){o&&a(r)}}}function Me(x){let r,$,o,p,n,t,l,m='During distributed training, you can specify the number and order of accelerators (CUDA, XPU, MPS, HPU, etc.) to use. This can be useful when you have accelerators with different computing power and you want to use the faster accelerator first. Or you could only use a subset of the available accelerators. The selection process works for both <a href="https://pytorch.org/docs/stable/generated/torch.nn.parallel.DistributedDataParallel.html" rel="nofollow">DistributedDataParallel</a> and <a href="https://pytorch.org/docs/stable/generated/torch.nn.DataParallel.html" rel="nofollow">DataParallel</a>. You don’t need Accelerate or <a href="./main_classes/deepspeed">DeepSpeed integration</a>.',H,U,E="This guide will show you how to select the number of accelerators to use and the order to use them in.",D,g,j,I,i="For example, if there are 4 accelerators and you only want to use the first 2, run the command below.",_,P,Y,S,R,F,B="To select specific accelerators to use and their order, use the environment variable appropriate for your hardware. This is often set on the command line for each run, but can also be added to your <code>~/.bashrc</code> or other startup config file.",Q,W,G="For example, if there are 4 accelerators (0, 1, 2, 3) and you only want to run accelerators 0 and 2:",k,J,s,h,Z,A,ee,z,te;return n=new re({props:{title:"Accelerator selection",local:"accelerator-selection",headingTag:"h1"}}),g=new re({props:{title:"Number of accelerators",local:"number-of-accelerators",headingTag:"h2"}}),P=new se({props:{id:"select-accelerator",options:["torchrun","Accelerate","DeepSpeed"],$$slots:{default:[ge]},$$scope:{ctx:x}}}),S=new re({props:{title:"Order of accelerators",local:"order-of-accelerators",headingTag:"h2"}}),J=new se({props:{id:"accelerator-type",options:["CUDA","Intel XPU"],$$slots:{default:[ye]},$$scope:{ctx:x}}}),h=new me({props:{warning:!0,$$slots:{default:[ve]},$$scope:{ctx:x}}}),A=new ue({props:{source:"https://github.com/huggingface/transformers/blob/main/docs/source/en/accelerator_selection.md"}}),{c(){r=w("meta"),$=u(),o=w("p"),p=u(),y(n.$$.fragment),t=u(),l=w("p"),l.innerHTML=m,H=u(),U=w("p"),U.textContent=E,D=u(),y(g.$$.fragment),j=u(),I=w("p"),I.textContent=i,_=u(),y(P.$$.fragment),Y=u(),y(S.$$.fragment),R=u(),F=w("p"),F.innerHTML=B,Q=u(),W=w("p"),W.textContent=G,k=u(),y(J.$$.fragment),s=u(),y(h.$$.fragment),Z=u(),y(A.$$.fragment),ee=u(),z=w("p"),this.h()},l(e){const c=$e("svelte-u9bgzb",document.head);r=b(c,"META",{name:!0,content:!0}),c.forEach(a),$=d(e),o=b(e,"P",{}),K(o).forEach(a),p=d(e),v(n.$$.fragment,e),t=d(e),l=b(e,"P",{"data-svelte-h":!0}),L(l)!=="svelte-1yb8ck7"&&(l.innerHTML=m),H=d(e),U=b(e,"P",{"data-svelte-h":!0}),L(U)!=="svelte-1vjt2if"&&(U.textContent=E),D=d(e),v(g.$$.fragment,e),j=d(e),I=b(e,"P",{"data-svelte-h":!0}),L(I)!=="svelte-flxrj1"&&(I.textContent=i),_=d(e),v(P.$$.fragment,e),Y=d(e),v(S.$$.fragment,e),R=d(e),F=b(e,"P",{"data-svelte-h":!0}),L(F)!=="svelte-w0dx5i"&&(F.innerHTML=B),Q=d(e),W=b(e,"P",{"data-svelte-h":!0}),L(W)!=="svelte-1aj07lm"&&(W.textContent=G),k=d(e),v(J.$$.fragment,e),s=d(e),v(h.$$.fragment,e),Z=d(e),v(A.$$.fragment,e),ee=d(e),z=b(e,"P",{}),K(z).forEach(a),this.h()},h(){ae(r,"name","hf:doc:metadata"),ae(r,"content",Te)},m(e,c){N(document.head,r),f(e,$,c),f(e,o,c),f(e,p,c),M(n,e,c),f(e,t,c),f(e,l,c),f(e,H,c),f(e,U,c),f(e,D,c),M(g,e,c),f(e,j,c),f(e,I,c),f(e,_,c),M(P,e,c),f(e,Y,c),M(S,e,c),f(e,R,c),f(e,F,c),f(e,Q,c),f(e,W,c),f(e,k,c),M(J,e,c),f(e,s,c),M(h,e,c),f(e,Z,c),M(A,e,c),f(e,ee,c),f(e,z,c),te=!0},p(e,[c]){const ne={};c&2&&(ne.$$scope={dirty:c,ctx:e}),P.$set(ne);const le={};c&2&&(le.$$scope={dirty:c,ctx:e}),J.$set(le);const oe={};c&2&&(oe.$$scope={dirty:c,ctx:e}),h.$set(oe)},i(e){te||(T(n.$$.fragment,e),T(g.$$.fragment,e),T(P.$$.fragment,e),T(S.$$.fragment,e),T(J.$$.fragment,e),T(h.$$.fragment,e),T(A.$$.fragment,e),te=!0)},o(e){C(n.$$.fragment,e),C(g.$$.fragment,e),C(P.$$.fragment,e),C(S.$$.fragment,e),C(J.$$.fragment,e),C(h.$$.fragment,e),C(A.$$.fragment,e),te=!1},d(e){e&&(a($),a(o),a(p),a(t),a(l),a(H),a(U),a(D),a(j),a(I),a(_),a(Y),a(R),a(F),a(Q),a(W),a(k),a(s),a(Z),a(ee),a(z)),a(r),V(n,e),V(g,e),V(P,e),V(S,e),V(J,e),V(h,e),V(A,e)}}}const Te='{"title":"Accelerator selection","local":"accelerator-selection","sections":[{"title":"Number of accelerators","local":"number-of-accelerators","sections":[],"depth":2},{"title":"Order of accelerators","local":"order-of-accelerators","sections":[],"depth":2}],"depth":1}';function Ce(x){return ie(()=>{new URLSearchParams(window.location.search).get("fw")}),[]}class Pe extends pe{constructor(r){super(),ce(this,r,Ce,Me,fe,{})}}export{Pe as component};
