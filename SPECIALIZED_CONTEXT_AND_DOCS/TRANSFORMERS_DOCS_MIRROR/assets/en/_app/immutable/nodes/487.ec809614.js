import{s as ln,o as an,n as V}from"../chunks/scheduler.18a86fab.js";import{S as sn,i as on,g as d,s as p,r as y,A as rn,h as u,f as t,c as m,j as nn,u as $,x as b,k as Be,y as pn,a as n,v as w,d as T,t as g,w as v}from"../chunks/index.98837b22.js";import{T as mn}from"../chunks/Tip.77304350.js";import{C}from"../chunks/CodeBlock.8d0c2e8a.js";import{H as xe,E as fn}from"../chunks/getInferenceSnippets.06c2775f.js";import{H as Jt,a as Y}from"../chunks/HfOption.6641485e.js";function dn(_){let a,f='For text generation with 8-bit quantization, you should use <a href="/docs/transformers/v4.56.2/en/main_classes/text_generation#transformers.GenerationMixin.generate">generate()</a> instead of the high-level <a href="/docs/transformers/v4.56.2/en/main_classes/pipelines#transformers.Pipeline">Pipeline</a> API. The <a href="/docs/transformers/v4.56.2/en/main_classes/pipelines#transformers.Pipeline">Pipeline</a> returns slower performance because it isn‚Äôt optimized for 8-bit models, and some sampling strategies (nucleus sampling) also aren‚Äôt supported.',o,r,s='Set up a <a href="/docs/transformers/v4.56.2/en/main_classes/quantization#transformers.BitsAndBytesConfig">BitsAndBytesConfig</a> and set <code>load_in_8bit=True</code> to load a model in 8-bit precision. The <a href="/docs/transformers/v4.56.2/en/main_classes/quantization#transformers.BitsAndBytesConfig">BitsAndBytesConfig</a> is passed to the <code>quantization_config</code> parameter in <a href="/docs/transformers/v4.56.2/en/main_classes/model#transformers.PreTrainedModel.from_pretrained">from_pretrained()</a>.',i,c,j='Allow Accelerate to automatically distribute the model across your available hardware by setting <a href="https://hf.co/docs/accelerate/concept_guides/big_model_inference#designing-a-device-map" rel="nofollow">device_map=‚Äúauto‚Äù</a>.',x,W,R="Place all inputs on the same device as the model.",G,k,B,U,H="For distributed setups, use the <code>max_memory</code> parameter to create a mapping of the amount of memory to allocate to each GPU. The example below distributes 16GB of memory to the first GPU and 16GB of memory to the second GPU.",M,J,A,X,L='Learn in more detail the concepts underlying 8-bit quantization in the <a href="https://hf.co/blog/hf-bitsandbytes-integration" rel="nofollow">Gentle Introduction to 8-bit Matrix Multiplication for transformers at scale using Hugging Face Transformers, Accelerate and bitsandbytes</a> blog post.',I;return k=new C({props:{code:"ZnJvbSUyMHRyYW5zZm9ybWVycyUyMGltcG9ydCUyMEJpdHNBbmRCeXRlc0NvbmZpZyUyQyUyMEF1dG9Ub2tlbml6ZXIlMkMlMjBBdXRvTW9kZWxGb3JDYXVzYWxMTSUwQSUwQXF1YW50aXphdGlvbl9jb25maWclMjAlM0QlMjBCaXRzQW5kQnl0ZXNDb25maWcobG9hZF9pbl84Yml0JTNEVHJ1ZSklMEF0b2tlbml6ZXIlMjAlM0QlMjBBdXRvVG9rZW5pemVyLmZyb21fcHJldHJhaW5lZCglMjJtZXRhLWxsYW1hJTJGTGxhbWEtMy4xLThCJTIyKSUwQW1vZGVsJTIwJTNEJTIwQXV0b01vZGVsRm9yQ2F1c2FsTE0uZnJvbV9wcmV0cmFpbmVkKCUyMm1ldGEtbGxhbWElMkZMbGFtYS0zLjEtOEIlMjIlMkMlMjBkZXZpY2VfbWFwJTNEJTIyYXV0byUyMiUyQyUyMHF1YW50aXphdGlvbl9jb25maWclM0RxdWFudGl6YXRpb25fY29uZmlnKSUwQSUwQXByb21wdCUyMCUzRCUyMCUyMkhlbGxvJTJDJTIwbXklMjBsbGFtYSUyMGlzJTIwY3V0ZSUyMiUwQWlucHV0cyUyMCUzRCUyMHRva2VuaXplcihwcm9tcHQlMkMlMjByZXR1cm5fdGVuc29ycyUzRCUyMnB0JTIyKS50byhtb2RlbC5kZXZpY2UpJTBBZ2VuZXJhdGVkX2lkcyUyMCUzRCUyMG1vZGVsLmdlbmVyYXRlKCoqaW5wdXRzKSUwQW91dHB1dHMlMjAlM0QlMjB0b2tlbml6ZXIuYmF0Y2hfZGVjb2RlKGdlbmVyYXRlZF9pZHMlMkMlMjBza2lwX3NwZWNpYWxfdG9rZW5zJTNEVHJ1ZSk=",highlighted:`<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> BitsAndBytesConfig, AutoTokenizer, AutoModelForCausalLM

quantization_config = BitsAndBytesConfig(load_in_8bit=<span class="hljs-literal">True</span>)
tokenizer = AutoTokenizer.from_pretrained(<span class="hljs-string">&quot;meta-llama/Llama-3.1-8B&quot;</span>)
model = AutoModelForCausalLM.from_pretrained(<span class="hljs-string">&quot;meta-llama/Llama-3.1-8B&quot;</span>, device_map=<span class="hljs-string">&quot;auto&quot;</span>, quantization_config=quantization_config)

prompt = <span class="hljs-string">&quot;Hello, my llama is cute&quot;</span>
inputs = tokenizer(prompt, return_tensors=<span class="hljs-string">&quot;pt&quot;</span>).to(model.device)
generated_ids = model.generate(**inputs)
outputs = tokenizer.batch_decode(generated_ids, skip_special_tokens=<span class="hljs-literal">True</span>)`,wrap:!1}}),J=new C({props:{code:"bWF4X21lbW9yeV9tYXBwaW5nJTIwJTNEJTIwJTdCMCUzQSUyMCUyMjE2R0IlMjIlMkMlMjAxJTNBJTIwJTIyMTZHQiUyMiU3RCUwQW1vZGVsXzhiaXQlMjAlM0QlMjBBdXRvTW9kZWxGb3JDYXVzYWxMTS5mcm9tX3ByZXRyYWluZWQoJTBBJTIwJTIwJTIwJTIwJTIybWV0YS1sbGFtYSUyRkxsYW1hLTMuMS04QiUyMiUyQyUyMGRldmljZV9tYXAlM0QlMjJhdXRvJTIyJTJDJTIwcXVhbnRpemF0aW9uX2NvbmZpZyUzRHF1YW50aXphdGlvbl9jb25maWclMkMlMjBtYXhfbWVtb3J5JTNEbWF4X21lbW9yeV9tYXBwaW5nJTBBKQ==",highlighted:`max_memory_mapping = {<span class="hljs-number">0</span>: <span class="hljs-string">&quot;16GB&quot;</span>, <span class="hljs-number">1</span>: <span class="hljs-string">&quot;16GB&quot;</span>}
model_8bit = AutoModelForCausalLM.from_pretrained(
    <span class="hljs-string">&quot;meta-llama/Llama-3.1-8B&quot;</span>, device_map=<span class="hljs-string">&quot;auto&quot;</span>, quantization_config=quantization_config, max_memory=max_memory_mapping
)`,wrap:!1}}),{c(){a=d("p"),a.innerHTML=f,o=p(),r=d("p"),r.innerHTML=s,i=p(),c=d("p"),c.innerHTML=j,x=p(),W=d("p"),W.textContent=R,G=p(),y(k.$$.fragment),B=p(),U=d("p"),U.innerHTML=H,M=p(),y(J.$$.fragment),A=p(),X=d("p"),X.innerHTML=L},l(h){a=u(h,"P",{"data-svelte-h":!0}),b(a)!=="svelte-1ueogd2"&&(a.innerHTML=f),o=m(h),r=u(h,"P",{"data-svelte-h":!0}),b(r)!=="svelte-1u7pse9"&&(r.innerHTML=s),i=m(h),c=u(h,"P",{"data-svelte-h":!0}),b(c)!=="svelte-189jfcc"&&(c.innerHTML=j),x=m(h),W=u(h,"P",{"data-svelte-h":!0}),b(W)!=="svelte-6y3wld"&&(W.textContent=R),G=m(h),$(k.$$.fragment,h),B=m(h),U=u(h,"P",{"data-svelte-h":!0}),b(U)!=="svelte-m5ityn"&&(U.innerHTML=H),M=m(h),$(J.$$.fragment,h),A=m(h),X=u(h,"P",{"data-svelte-h":!0}),b(X)!=="svelte-1xjsovs"&&(X.innerHTML=L)},m(h,Z){n(h,a,Z),n(h,o,Z),n(h,r,Z),n(h,i,Z),n(h,c,Z),n(h,x,Z),n(h,W,Z),n(h,G,Z),w(k,h,Z),n(h,B,Z),n(h,U,Z),n(h,M,Z),w(J,h,Z),n(h,A,Z),n(h,X,Z),I=!0},p:V,i(h){I||(T(k.$$.fragment,h),T(J.$$.fragment,h),I=!0)},o(h){g(k.$$.fragment,h),g(J.$$.fragment,h),I=!1},d(h){h&&(t(a),t(o),t(r),t(i),t(c),t(x),t(W),t(G),t(B),t(U),t(M),t(A),t(X)),v(k,h),v(J,h)}}}function un(_){let a,f='Set up a <a href="/docs/transformers/v4.56.2/en/main_classes/quantization#transformers.BitsAndBytesConfig">BitsAndBytesConfig</a> and set <code>load_in_4bit=True</code> to load a model in 4-bit precision. The <a href="/docs/transformers/v4.56.2/en/main_classes/quantization#transformers.BitsAndBytesConfig">BitsAndBytesConfig</a> is passed to the <code>quantization_config</code> parameter in <a href="/docs/transformers/v4.56.2/en/main_classes/model#transformers.PreTrainedModel.from_pretrained">from_pretrained()</a>.',o,r,s="Allow Accelerate to automatically distribute the model across your available hardware by setting <code>device_map=‚Äúauto‚Äù</code>.",i,c,j="Place all inputs on the same device as the model.",x,W,R,G,k="For distributed setups, use the <code>max_memory</code> parameter to create a mapping of the amount of memory to allocate to each GPU. The example below distributes 16GB of memory to the first GPU and 16GB of memory to the second GPU.",B,U,H;return W=new C({props:{code:"ZnJvbSUyMHRyYW5zZm9ybWVycyUyMGltcG9ydCUyMEJpdHNBbmRCeXRlc0NvbmZpZyUyQyUyMEF1dG9Ub2tlbml6ZXIlMkMlMjBBdXRvTW9kZWxGb3JDYXVzYWxMTSUwQSUwQXF1YW50aXphdGlvbl9jb25maWclMjAlM0QlMjBCaXRzQW5kQnl0ZXNDb25maWcobG9hZF9pbl80Yml0JTNEVHJ1ZSklMEF0b2tlbml6ZXIlMjAlM0QlMjBBdXRvVG9rZW5pemVyKCUyMm1ldGEtbGxhbWElMkZMbGFtYS0zLjEtOEIlMjIpJTBBbW9kZWwlMjAlM0QlMjBBdXRvTW9kZWxGb3JDYXVzYWxMTS5mcm9tX3ByZXRyYWluZWQoJTIybWV0YS1sbGFtYSUyRkxsYW1hLTMuMS04QiUyMiUyQyUyMGRldmljZV9tYXAlM0QlMjJhdXRvJTIyJTJDJTIwcXVhbnRpemF0aW9uX2NvbmZpZyUzRHF1YW50aXphdGlvbl9jb25maWcpJTBBJTBBcHJvbXB0JTIwJTNEJTIwJTIySGVsbG8lMkMlMjBteSUyMGxsYW1hJTIwaXMlMjBjdXRlJTIyJTBBaW5wdXRzJTIwJTNEJTIwdG9rZW5pemVyKHByb21wdCUyQyUyMHJldHVybl90ZW5zb3JzJTNEJTIycHQlMjIpLnRvKG1vZGVsXzhiaXQuZGV2aWNlKSUwQWdlbmVyYXRlZF9pZHMlMjAlM0QlMjBtb2RlbF84Yml0LmdlbmVyYXRlKCoqaW5wdXRzKSUwQW91dHB1dHMlMjAlM0QlMjB0b2tlbml6ZXIuYmF0Y2hfZGVjb2RlKGdlbmVyYXRlZF9pZHMlMkMlMjBza2lwX3NwZWNpYWxfdG9rZW5zJTNEVHJ1ZSk=",highlighted:`<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> BitsAndBytesConfig, AutoTokenizer, AutoModelForCausalLM

quantization_config = BitsAndBytesConfig(load_in_4bit=<span class="hljs-literal">True</span>)
tokenizer = AutoTokenizer(<span class="hljs-string">&quot;meta-llama/Llama-3.1-8B&quot;</span>)
model = AutoModelForCausalLM.from_pretrained(<span class="hljs-string">&quot;meta-llama/Llama-3.1-8B&quot;</span>, device_map=<span class="hljs-string">&quot;auto&quot;</span>, quantization_config=quantization_config)

prompt = <span class="hljs-string">&quot;Hello, my llama is cute&quot;</span>
inputs = tokenizer(prompt, return_tensors=<span class="hljs-string">&quot;pt&quot;</span>).to(model_8bit.device)
generated_ids = model_8bit.generate(**inputs)
outputs = tokenizer.batch_decode(generated_ids, skip_special_tokens=<span class="hljs-literal">True</span>)`,wrap:!1}}),U=new C({props:{code:"bWF4X21lbW9yeV9tYXBwaW5nJTIwJTNEJTIwJTdCMCUzQSUyMCUyMjE2R0IlMjIlMkMlMjAxJTNBJTIwJTIyMTZHQiUyMiU3RCUwQW1vZGVsXzRiaXQlMjAlM0QlMjBBdXRvTW9kZWxGb3JDYXVzYWxMTS5mcm9tX3ByZXRyYWluZWQoJTBBJTIwJTIwJTIwJTIwJTIybWV0YS1sbGFtYSUyRkxsYW1hLTMuMS04QiUyMiUyQyUyMGRldmljZV9tYXAlM0QlMjJhdXRvJTIyJTJDJTIwcXVhbnRpemF0aW9uX2NvbmZpZyUzRHF1YW50aXphdGlvbl9jb25maWclMkMlMjBtYXhfbWVtb3J5JTNEbWF4X21lbW9yeV9tYXBwaW5nJTBBKQ==",highlighted:`max_memory_mapping = {<span class="hljs-number">0</span>: <span class="hljs-string">&quot;16GB&quot;</span>, <span class="hljs-number">1</span>: <span class="hljs-string">&quot;16GB&quot;</span>}
model_4bit = AutoModelForCausalLM.from_pretrained(
    <span class="hljs-string">&quot;meta-llama/Llama-3.1-8B&quot;</span>, device_map=<span class="hljs-string">&quot;auto&quot;</span>, quantization_config=quantization_config, max_memory=max_memory_mapping
)`,wrap:!1}}),{c(){a=d("p"),a.innerHTML=f,o=p(),r=d("p"),r.innerHTML=s,i=p(),c=d("p"),c.textContent=j,x=p(),y(W.$$.fragment),R=p(),G=d("p"),G.innerHTML=k,B=p(),y(U.$$.fragment)},l(M){a=u(M,"P",{"data-svelte-h":!0}),b(a)!=="svelte-a940g1"&&(a.innerHTML=f),o=m(M),r=u(M,"P",{"data-svelte-h":!0}),b(r)!=="svelte-1xbfxzy"&&(r.innerHTML=s),i=m(M),c=u(M,"P",{"data-svelte-h":!0}),b(c)!=="svelte-6y3wld"&&(c.textContent=j),x=m(M),$(W.$$.fragment,M),R=m(M),G=u(M,"P",{"data-svelte-h":!0}),b(G)!=="svelte-m5ityn"&&(G.innerHTML=k),B=m(M),$(U.$$.fragment,M)},m(M,J){n(M,a,J),n(M,o,J),n(M,r,J),n(M,i,J),n(M,c,J),n(M,x,J),w(W,M,J),n(M,R,J),n(M,G,J),n(M,B,J),w(U,M,J),H=!0},p:V,i(M){H||(T(W.$$.fragment,M),T(U.$$.fragment,M),H=!0)},o(M){g(W.$$.fragment,M),g(U.$$.fragment,M),H=!1},d(M){M&&(t(a),t(o),t(r),t(i),t(c),t(x),t(R),t(G),t(B)),v(W,M),v(U,M)}}}function cn(_){let a,f,o,r;return a=new Y({props:{id:"bnb",option:"8-bit",$$slots:{default:[dn]},$$scope:{ctx:_}}}),o=new Y({props:{id:"bnb",option:"4-bit",$$slots:{default:[un]},$$scope:{ctx:_}}}),{c(){y(a.$$.fragment),f=p(),y(o.$$.fragment)},l(s){$(a.$$.fragment,s),f=m(s),$(o.$$.fragment,s)},m(s,i){w(a,s,i),n(s,f,i),w(o,s,i),r=!0},p(s,i){const c={};i&2&&(c.$$scope={dirty:i,ctx:s}),a.$set(c);const j={};i&2&&(j.$$scope={dirty:i,ctx:s}),o.$set(j)},i(s){r||(T(a.$$.fragment,s),T(o.$$.fragment,s),r=!0)},o(s){g(a.$$.fragment,s),g(o.$$.fragment,s),r=!1},d(s){s&&t(f),v(a,s),v(o,s)}}}function hn(_){let a,f='Some BetterTransformer features are being upstreamed to Transformers with default support for native <a href="https://pytorch.org/docs/stable/generated/torch.nn.functional.scaled_dot_product_attention.html" rel="nofollow">torch.nn.functional.scaled_dot_product_attention</a> (SDPA). BetterTransformer has a wider coverage than the Transformers SDPA integration, but you can expect more and more architectures to natively support SDPA in Transformers.';return{c(){a=d("p"),a.innerHTML=f},l(o){a=u(o,"P",{"data-svelte-h":!0}),b(a)!=="svelte-1kg7smu"&&(a.innerHTML=f)},m(o,r){n(o,a,r)},p:V,d(o){o&&t(a)}}}function bn(_){let a,f;return a=new C({props:{code:"cGlwJTIwaW5zdGFsbCUyMGZsYXNoLWF0dG4lMjAtLW5vLWJ1aWxkLWlzb2xhdGlvbg==",highlighted:"pip install flash-attn --no-build-isolation",wrap:!1}}),{c(){y(a.$$.fragment)},l(o){$(a.$$.fragment,o)},m(o,r){w(a,o,r),f=!0},p:V,i(o){f||(T(a.$$.fragment,o),f=!0)},o(o){g(a.$$.fragment,o),f=!1},d(o){v(a,o)}}}function Mn(_){let a,f='FlashAttention2 support is currently limited to Instinct MI210, Instinct MI250 and Instinct MI300. We strongly suggest running this <a href="https://github.com/huggingface/optimum-amd/tree/main/docker/transformers-pytorch-amd-gpu-flash/Dockerfile" rel="nofollow">Dockerfile</a> for FlashAttention2 on AMD GPUs.';return{c(){a=d("p"),a.innerHTML=f},l(o){a=u(o,"P",{"data-svelte-h":!0}),b(a)!=="svelte-4y1e8d"&&(a.innerHTML=f)},m(o,r){n(o,a,r)},p:V,d(o){o&&t(a)}}}function yn(_){let a,f,o,r;return a=new Y({props:{id:"install",option:"NVIDIA",$$slots:{default:[bn]},$$scope:{ctx:_}}}),o=new Y({props:{id:"install",option:"AMD",$$slots:{default:[Mn]},$$scope:{ctx:_}}}),{c(){y(a.$$.fragment),f=p(),y(o.$$.fragment)},l(s){$(a.$$.fragment,s),f=m(s),$(o.$$.fragment,s)},m(s,i){w(a,s,i),n(s,f,i),w(o,s,i),r=!0},p(s,i){const c={};i&2&&(c.$$scope={dirty:i,ctx:s}),a.$set(c);const j={};i&2&&(j.$$scope={dirty:i,ctx:s}),o.$set(j)},i(s){r||(T(a.$$.fragment,s),T(o.$$.fragment,s),r=!0)},o(s){g(a.$$.fragment,s),g(o.$$.fragment,s),r=!1},d(s){s&&t(f),v(a,s),v(o,s)}}}function $n(_){let a,f='With a relatively small sequence length, a single forward pass creates overhead leading to a small speed up. The graph below shows the expected speed up for a single forward pass with <a href="https://hf.co/meta-llama/Llama-7b-hf" rel="nofollow">meta-llama/Llama-7b-hf</a> with padding.',o,r,s='<img src="https://huggingface.co/datasets/ybelkada/documentation-images/resolve/main/llama-2-small-seqlen-padding.png"/>';return{c(){a=d("p"),a.innerHTML=f,o=p(),r=d("div"),r.innerHTML=s,this.h()},l(i){a=u(i,"P",{"data-svelte-h":!0}),b(a)!=="svelte-1c98iqw"&&(a.innerHTML=f),o=m(i),r=u(i,"DIV",{class:!0,"data-svelte-h":!0}),b(r)!=="svelte-yereht"&&(r.innerHTML=s),this.h()},h(){Be(r,"class","flex justify-center")},m(i,c){n(i,a,c),n(i,o,c),n(i,r,c)},p:V,d(i){i&&(t(a),t(o),t(r))}}}function wn(_){let a,f='You can train on much longer sequence lengths without running into out-of-memory issues with FlashAttention2, and potentially reduce memory usage up to 20x. The speed up benefits are even better. The graph below shows the expected speed up for a single forward pass with <a href="https://hf.co/meta-llama/Llama-7b-hf" rel="nofollow">meta-llama/Llama-7b-hf</a> with padding on a longer sequence length.',o,r,s='<img src="https://huggingface.co/datasets/ybelkada/documentation-images/resolve/main/llama-2-large-seqlen-padding.png"/>';return{c(){a=d("p"),a.innerHTML=f,o=p(),r=d("div"),r.innerHTML=s,this.h()},l(i){a=u(i,"P",{"data-svelte-h":!0}),b(a)!=="svelte-1n0ltv3"&&(a.innerHTML=f),o=m(i),r=u(i,"DIV",{class:!0,"data-svelte-h":!0}),b(r)!=="svelte-1gms3ep"&&(r.innerHTML=s),this.h()},h(){Be(r,"class","flex justify-center")},m(i,c){n(i,a,c),n(i,o,c),n(i,r,c)},p:V,d(i){i&&(t(a),t(o),t(r))}}}function Tn(_){let a,f,o,r;return a=new Y({props:{id:"padded",option:"short sequence length",$$slots:{default:[$n]},$$scope:{ctx:_}}}),o=new Y({props:{id:"padded",option:"long sequence length",$$slots:{default:[wn]},$$scope:{ctx:_}}}),{c(){y(a.$$.fragment),f=p(),y(o.$$.fragment)},l(s){$(a.$$.fragment,s),f=m(s),$(o.$$.fragment,s)},m(s,i){w(a,s,i),n(s,f,i),w(o,s,i),r=!0},p(s,i){const c={};i&2&&(c.$$scope={dirty:i,ctx:s}),a.$set(c);const j={};i&2&&(j.$$scope={dirty:i,ctx:s}),o.$set(j)},i(s){r||(T(a.$$.fragment,s),T(o.$$.fragment,s),r=!0)},o(s){g(a.$$.fragment,s),g(o.$$.fragment,s),r=!1},d(s){s&&t(f),v(a,s),v(o,s)}}}function gn(_){let a,f='The graph below shows the expected speed up for a single forward pass with <a href="https://hf.co/tiiuae/falcon-7b" rel="nofollow">tiiuae/falcon-7b</a> with a sequence length of 4096 and various batch sizes without padding tokens.',o,r,s='<img src="https://huggingface.co/datasets/ybelkada/documentation-images/resolve/main/falcon-7b-inference-large-seqlen.png"/>';return{c(){a=d("p"),a.innerHTML=f,o=p(),r=d("div"),r.innerHTML=s,this.h()},l(i){a=u(i,"P",{"data-svelte-h":!0}),b(a)!=="svelte-1dnv8z"&&(a.innerHTML=f),o=m(i),r=u(i,"DIV",{class:!0,"data-svelte-h":!0}),b(r)!=="svelte-s5vof8"&&(r.innerHTML=s),this.h()},h(){Be(r,"class","flex justify-center")},m(i,c){n(i,a,c),n(i,o,c),n(i,r,c)},p:V,d(i){i&&(t(a),t(o),t(r))}}}function vn(_){let a,f='The graph below shows the expected speed up for a single forward pass with <a href="https://hf.co/meta-llama/Llama-7b-hf" rel="nofollow">meta-llama/Llama-7b-hf</a> with a sequence length of 4096 and various batch sizes without padding tokens.',o,r,s='<img src="https://huggingface.co/datasets/ybelkada/documentation-images/resolve/main/llama-7b-inference-large-seqlen.png"/>';return{c(){a=d("p"),a.innerHTML=f,o=p(),r=d("div"),r.innerHTML=s,this.h()},l(i){a=u(i,"P",{"data-svelte-h":!0}),b(a)!=="svelte-b835g7"&&(a.innerHTML=f),o=m(i),r=u(i,"DIV",{class:!0,"data-svelte-h":!0}),b(r)!=="svelte-8cq7gw"&&(r.innerHTML=s),this.h()},h(){Be(r,"class","flex justify-center")},m(i,c){n(i,a,c),n(i,o,c),n(i,r,c)},p:V,d(i){i&&(t(a),t(o),t(r))}}}function _n(_){let a,f,o,r;return a=new Y({props:{id:"not-padded",option:"tiiuae/falcon-7b",$$slots:{default:[gn]},$$scope:{ctx:_}}}),o=new Y({props:{id:"not-padded",option:"meta-llama/Llama-7b-hf",$$slots:{default:[vn]},$$scope:{ctx:_}}}),{c(){y(a.$$.fragment),f=p(),y(o.$$.fragment)},l(s){$(a.$$.fragment,s),f=m(s),$(o.$$.fragment,s)},m(s,i){w(a,s,i),n(s,f,i),w(o,s,i),r=!0},p(s,i){const c={};i&2&&(c.$$scope={dirty:i,ctx:s}),a.$set(c);const j={};i&2&&(j.$$scope={dirty:i,ctx:s}),o.$set(j)},i(s){r||(T(a.$$.fragment,s),T(o.$$.fragment,s),r=!0)},o(s){g(a.$$.fragment,s),g(o.$$.fragment,s),r=!1},d(s){s&&t(f),v(a,s),v(o,s)}}}function Jn(_){let a,f,o,r,s,i,c,j="GPUs are the standard hardware for machine learning because they‚Äôre optimized for memory bandwidth and parallelism. With the increasing sizes of modern models, it‚Äôs more important than ever to make sure GPUs are capable of efficiently handling and delivering the best possible performance.",x,W,R="This guide will demonstrate a few ways to optimize inference on a GPU. The optimization methods shown below can be combined with each other to achieve even better performance, and they also work for distributed GPUs.",G,k,B,U,H='<a href="https://hf.co/docs/bitsandbytes/index" rel="nofollow">bitsandbytes</a> is a quantization library that supports 8-bit and 4-bit quantization. Quantization represents weights in a lower precision compared to the original full precision format. It reduces memory requirements and makes it easier to fit large model into memory.',M,J,A="Make sure bitsandbytes and Accelerate are installed first.",X,L,I,h,Z,P,Xe,N,Wt='<a href="https://hf.co/docs/optimum/en/index" rel="nofollow">Optimum</a> is a Hugging Face library focused on optimizing model performance across various hardware. It supports <a href="https://onnxruntime.ai/docs/" rel="nofollow">ONNX Runtime</a> (ORT), a model accelerator, for a wide range of hardware and frameworks including NVIDIA GPUs and AMD GPUs that use the <a href="https://www.amd.com/en/products/software/rocm.html" rel="nofollow">ROCm</a> stack.',Re,S,Ut="ORT uses optimization techniques that fuse common operations into a single node and constant folding to reduce the number of computations. ORT also places the most computationally intensive operations on the GPU and the rest on the CPU to intelligently distribute the workload between the two devices.",He,E,jt='Optimum provides the <a href="https://huggingface.co/docs/optimum/v1.27.0/en/onnxruntime/package_reference/modeling_ort#optimum.onnxruntime.ORTModel" rel="nofollow">ORTModel</a> class for loading ONNX models. Set the <code>provider</code> parameter according to the table below.',Le,D,Zt='<thead><tr><th>provider</th> <th>hardware</th></tr></thead> <tbody><tr><td><a href="https://hf.co/docs/optimum/main/en/onnxruntime/usage_guides/gpu#cudaexecutionprovider" rel="nofollow">CUDAExecutionProvider</a></td> <td>CUDA-enabled GPUs</td></tr> <tr><td><a href="https://hf.co/docs/optimum/onnxruntime/usage_guides/amdgpu" rel="nofollow">ROCMExecutionProvider</a></td> <td>AMD Instinct, Radeon Pro, Radeon GPUs</td></tr> <tr><td><a href="https://hf.co/docs/optimum/onnxruntime/usage_guides/gpu#tensorrtexecutionprovider" rel="nofollow">TensorrtExecutionProvider</a></td> <td>TensorRT</td></tr></tbody>',Ie,K,kt='For example, load the <a href="https://hf.co/optimum/roberta-base-squad2" rel="nofollow">distilbert/distilbert-base-uncased-finetuned-sst-2-english</a> checkpoint for sequence classification. This checkpoint contains a <a href="https://hf.co/distilbert/distilbert-base-uncased-finetuned-sst-2-english/blob/main/onnx/model.onnx" rel="nofollow">model.onnx</a> file. If a checkpoint doesn‚Äôt have a <code>model.onnx</code> file, set <code>export=True</code> to convert a checkpoint on the fly to the ONNX format.',Ve,O,qe,ee,Gt='Now you can use the model for inference in a <a href="/docs/transformers/v4.56.2/en/main_classes/pipelines#transformers.Pipeline">Pipeline</a>.',ze,te,Qe,ne,xt='Learn more details about using ORT with Optimum in the <a href="https://hf.co/docs/optimum/onnxruntime/usage_guides/gpu#accelerated-inference-on-nvidia-gpus" rel="nofollow">Accelerated inference on NVIDIA GPUs</a> and <a href="https://hf.co/docs/optimum/onnxruntime/usage_guides/amdgpu#accelerated-inference-on-amd-gpus" rel="nofollow">Accelerated inference on AMD GPUs</a> guides.',Fe,le,Ye,ae,Bt='<a href="https://pytorch.org/blog/a-better-transformer-for-fast-transformer-encoder-inference/" rel="nofollow">BetterTransformer</a> is a <em>fastpath</em> execution of specialized Transformers functions directly on the hardware level such as a GPU. There are two main components of the fastpath execution.',Ae,se,Ct="<li>fusing multiple operations into a single kernel for faster and more efficient execution</li> <li>skipping unnecessary computation of padding tokens with nested tensors</li>",Pe,q,Ne,oe,Xt='BetterTransformer is available through Optimum with <a href="/docs/transformers/v4.56.2/en/main_classes/model#transformers.PreTrainedModel.to_bettertransformer">to_bettertransformer()</a>.',Se,ie,Ee,re,Rt='Call <a href="/docs/transformers/v4.56.2/en/main_classes/model#transformers.PreTrainedModel.reverse_bettertransformer">reverse_bettertransformer()</a> and save it first to return the model to the original Transformers model.',De,pe,Ke,me,Ht='Refer to the benchmarks in <a href="https://pytorch.org/blog/out-of-the-box-acceleration/" rel="nofollow">Out of the box acceleration and memory savings of ü§ó decoder models with PyTorch 2.0</a> for BetterTransformer and scaled dot product attention performance. The <a href="https://medium.com/pytorch/bettertransformer-out-of-the-box-performance-for-huggingface-transformers-3fbe27d50ab2" rel="nofollow">BetterTransformer</a> blog post also discusses fastpath execution in greater detail if you‚Äôre interested in learning more.',Oe,fe,et,de,Lt='PyTorch‚Äôs <a href="https://pytorch.org/docs/stable/generated/torch.nn.functional.scaled_dot_product_attention.html" rel="nofollow">torch.nn.functional.scaled_dot_product_attention</a> (SDPA) is a native implementation of the scaled dot product attention mechanism. SDPA is a more efficient and optimized version of the attention mechanism used in transformer models.',tt,ue,It="There are three supported implementations available.",nt,ce,Vt='<li><a href="https://github.com/Dao-AILab/flash-attention" rel="nofollow">FlashAttention2</a> only supports models with the fp16 or bf16 torch type. Make sure to cast your model to the appropriate type first.</li> <li><a href="https://github.com/facebookresearch/xformers" rel="nofollow">xFormers</a> or Memory-Efficient Attention is able to support models with the fp32 torch type.</li> <li>C++ implementation of scaled dot product attention</li>',lt,he,qt='SDPA is used by default for PyTorch v2.1.1. and greater when an implementation is available. You could explicitly enable SDPA by setting <code>attn_implementation=&quot;sdpa&quot;</code> in <a href="/docs/transformers/v4.56.2/en/main_classes/model#transformers.PreTrainedModel.from_pretrained">from_pretrained()</a> though. Certain attention parameters, such as <code>head_mask</code> and <code>output_attentions=True</code>, are unsupported and returns a warning that Transformers will fall back to the (slower) eager implementation.',at,be,zt='Refer to the <a href="./attention_interface">AttentionInterface</a> guide to learn how to change the attention implementation after loading a model.',st,Me,ot,ye,Qt='SDPA selects the most performant implementation available, but you can also explicitly select an implementation with <a href="https://pytorch.org/docs/master/backends.html#torch.backends.cuda.sdp_kernel" rel="nofollow">torch.nn.attention.sdpa_kernel</a> as a context manager. The example below shows how to enable the FlashAttention2 implementation with <code>enable_flash=True</code>.',it,$e,rt,we,Ft="If you encounter the following <code>RuntimeError</code>, try installing the nightly version of PyTorch which has broader coverage for FlashAttention.",pt,Te,mt,ge,ft,ve,Yt='<a href="https://github.com/Dao-AILab/flash-attention" rel="nofollow">FlashAttention</a> is also available as a standalone package. It can significantly speed up inference by:',dt,_e,At="<li>additionally parallelizing the attention computation over sequence length</li> <li>partitioning the work between GPU threads to reduce communication and shared memory reads/writes between them</li>",ut,Je,Pt="Install FlashAttention first for the hardware you‚Äôre using.",ct,z,ht,We,Nt='Enable FlashAttention2 by setting <code>attn_implementation=&quot;flash_attention_2&quot;</code> in <a href="/docs/transformers/v4.56.2/en/main_classes/model#transformers.PreTrainedModel.from_pretrained">from_pretrained()</a> or by setting <code>model.set_attention_implementation(&quot;flash_attention_2&quot;)</code> to dynamically update the <a href="./attention_interface">attention interface</a>. FlashAttention2 is only supported for models with the fp16 or bf16 torch type. Make sure to cast your model to the appropriate data type first.',bt,Ue,Mt,je,yt,Ze,St="FlashAttention2 speeds up inference considerably especially for inputs with long sequences. However, since FlashAttention2 doesn‚Äôt support computing attention scores with padding tokens, you must manually pad and unpad the attention scores for batched inference if a sequence contains padding tokens. The downside is batched generation is slower with padding tokens.",$t,Q,wt,ke,Et="To avoid this slowdown, use FlashAttention2 without padding tokens in the sequence during training. Pack the dataset or concatenate sequences until reaching the maximum sequence length.",Tt,F,gt,Ge,vt,Ce,_t;return s=new xe({props:{title:"GPU",local:"gpu",headingTag:"h1"}}),k=new xe({props:{title:"bitsandbytes",local:"bitsandbytes",headingTag:"h2"}}),L=new C({props:{code:"cGlwJTIwaW5zdGFsbCUyMGJpdHNhbmRieXRlcyUyMGFjY2VsZXJhdGU=",highlighted:"pip install bitsandbytes accelerate",wrap:!1}}),h=new Jt({props:{id:"bnb",options:["8-bit","4-bit"],$$slots:{default:[cn]},$$scope:{ctx:_}}}),P=new xe({props:{title:"Optimum",local:"optimum",headingTag:"h2"}}),O=new C({props:{code:"ZnJvbSUyMG9wdGltdW0ub25ueHJ1bnRpbWUlMjBpbXBvcnQlMjBPUlRNb2RlbEZvclNlcXVlbmNlQ2xhc3NpZmljYXRpb24lMEElMEFvcnRfbW9kZWwlMjAlM0QlMjBPUlRNb2RlbEZvclNlcXVlbmNlQ2xhc3NpZmljYXRpb24uZnJvbV9wcmV0cmFpbmVkKCUwQSUyMCUyMCUyMmRpc3RpbGJlcnQlMkZkaXN0aWxiZXJ0LWJhc2UtdW5jYXNlZC1maW5ldHVuZWQtc3N0LTItZW5nbGlzaCUyMiUyQyUwQSUyMCUyMCUyM2V4cG9ydCUzRFRydWUlMkMlMEElMjAlMjBwcm92aWRlciUzRCUyMkNVREFFeGVjdXRpb25Qcm92aWRlciUyMiUyQyUwQSk=",highlighted:`<span class="hljs-keyword">from</span> optimum.onnxruntime <span class="hljs-keyword">import</span> ORTModelForSequenceClassification

ort_model = ORTModelForSequenceClassification.from_pretrained(
  <span class="hljs-string">&quot;distilbert/distilbert-base-uncased-finetuned-sst-2-english&quot;</span>,
  <span class="hljs-comment">#export=True,</span>
  provider=<span class="hljs-string">&quot;CUDAExecutionProvider&quot;</span>,
)`,wrap:!1}}),te=new C({props:{code:"ZnJvbSUyMG9wdGltdW0ucGlwZWxpbmVzJTIwaW1wb3J0JTIwcGlwZWxpbmUlMEFmcm9tJTIwdHJhbnNmb3JtZXJzJTIwaW1wb3J0JTIwQXV0b1Rva2VuaXplciUwQSUwQXRva2VuaXplciUyMCUzRCUyMEF1dG9Ub2tlbml6ZXIuZnJvbV9wcmV0cmFpbmVkKCUyMmRpc3RpbGJlcnQlMkZkaXN0aWxiZXJ0LWJhc2UtdW5jYXNlZC1maW5ldHVuZWQtc3N0LTItZW5nbGlzaCUyMiklMEFwaXBlbGluZSUyMCUzRCUyMHBpcGVsaW5lKHRhc2slM0QlMjJ0ZXh0LWNsYXNzaWZpY2F0aW9uJTIyJTJDJTIwbW9kZWwlM0RvcnRfbW9kZWwlMkMlMjB0b2tlbml6ZXIlM0R0b2tlbml6ZXIlMkMlMjBkZXZpY2UlM0QlMjJjdWRhJTNBMCUyMiklMEFyZXN1bHQlMjAlM0QlMjBwaXBlbGluZSglMjJCb3RoJTIwdGhlJTIwbXVzaWMlMjBhbmQlMjB2aXN1YWwlMjB3ZXJlJTIwYXN0b3VuZGluZyUyQyUyMG5vdCUyMHRvJTIwbWVudGlvbiUyMHRoZSUyMGFjdG9ycyUyMHBlcmZvcm1hbmNlLiUyMik=",highlighted:`<span class="hljs-keyword">from</span> optimum.pipelines <span class="hljs-keyword">import</span> pipeline
<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoTokenizer

tokenizer = AutoTokenizer.from_pretrained(<span class="hljs-string">&quot;distilbert/distilbert-base-uncased-finetuned-sst-2-english&quot;</span>)
pipeline = pipeline(task=<span class="hljs-string">&quot;text-classification&quot;</span>, model=ort_model, tokenizer=tokenizer, device=<span class="hljs-string">&quot;cuda:0&quot;</span>)
result = pipeline(<span class="hljs-string">&quot;Both the music and visual were astounding, not to mention the actors performance.&quot;</span>)`,wrap:!1}}),le=new xe({props:{title:"BetterTransformer",local:"bettertransformer",headingTag:"h3"}}),q=new mn({props:{warning:!0,$$slots:{default:[hn]},$$scope:{ctx:_}}}),ie=new C({props:{code:"ZnJvbSUyMHRyYW5zZm9ybWVycyUyMGltcG9ydCUyMEF1dG9Nb2RlbEZvckNhdXNhbExNJTBBJTBBbW9kZWwlMjAlM0QlMjBBdXRvTW9kZWxGb3JDYXVzYWxMTS5mcm9tX3ByZXRyYWluZWQoJTIyYmlnc2NpZW5jZSUyRmJsb29tJTIyKSUwQW1vZGVsJTIwJTNEJTIwbW9kZWwudG9fYmV0dGVydHJhbnNmb3JtZXIoKQ==",highlighted:`<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoModelForCausalLM

model = AutoModelForCausalLM.from_pretrained(<span class="hljs-string">&quot;bigscience/bloom&quot;</span>)
model = model.to_bettertransformer()`,wrap:!1}}),pe=new C({props:{code:"bW9kZWwlMjAlM0QlMjBtb2RlbC5yZXZlcnNlX2JldHRlcnRyYW5zZm9ybWVyKCklMEFtb2RlbC5zYXZlX3ByZXRyYWluZWQoJTIyc2F2ZWRfbW9kZWwlMjIp",highlighted:`model = model.reverse_bettertransformer()
model.save_pretrained(<span class="hljs-string">&quot;saved_model&quot;</span>)`,wrap:!1}}),fe=new xe({props:{title:"Scaled dot product attention (SDPA)",local:"scaled-dot-product-attention-sdpa",headingTag:"h2"}}),Me=new C({props:{code:"ZnJvbSUyMHRyYW5zZm9ybWVycyUyMGltcG9ydCUyMEF1dG9Nb2RlbEZvckNhdXNhbExNJTBBJTBBbW9kZWwlMjAlM0QlMjBBdXRvTW9kZWxGb3JDYXVzYWxMTS5mcm9tX3ByZXRyYWluZWQoJTIybWV0YS1sbGFtYSUyRkxsYW1hLTMuMS04QiUyMiUyQyUyMGRldmljZV9tYXAlM0QlMjJhdXRvJTIyJTJDJTIwYXR0bl9pbXBsZW1lbnRhdGlvbiUzRCUyMnNkcGElMjIpJTBBJTBBJTIzJTIwQ2hhbmdlJTIwdGhlJTIwbW9kZWwncyUyMGF0dGVudGlvbiUyMGR5bmFtaWNhbGx5JTIwYWZ0ZXIlMjBsb2FkaW5nJTIwaXQlMEFtb2RlbCUyMCUzRCUyMEF1dG9Nb2RlbEZvckNhdXNhbExNLmZyb21fcHJldHJhaW5lZCglMjJtZXRhLWxsYW1hJTJGTGxhbWEtMy4xLThCJTIyJTJDJTIwZGV2aWNlX21hcCUzRCUyMmF1dG8lMjIpJTBBbW9kZWwuc2V0X2F0dGVudGlvbl9pbXBsZW1lbnRhdGlvbiglMjJzZHBhJTIyKQ==",highlighted:`<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoModelForCausalLM

model = AutoModelForCausalLM.from_pretrained(<span class="hljs-string">&quot;meta-llama/Llama-3.1-8B&quot;</span>, device_map=<span class="hljs-string">&quot;auto&quot;</span>, attn_implementation=<span class="hljs-string">&quot;sdpa&quot;</span>)

<span class="hljs-comment"># Change the model&#x27;s attention dynamically after loading it</span>
model = AutoModelForCausalLM.from_pretrained(<span class="hljs-string">&quot;meta-llama/Llama-3.1-8B&quot;</span>, device_map=<span class="hljs-string">&quot;auto&quot;</span>)
model.set_attention_implementation(<span class="hljs-string">&quot;sdpa&quot;</span>)`,wrap:!1}}),$e=new C({props:{code:"aW1wb3J0JTIwdG9yY2glMEFmcm9tJTIwdG9yY2gubm4uYXR0ZW50aW9uJTIwaW1wb3J0JTIwU0RQQmFja2VuZCUyQyUyMHNkcGFfa2VybmVsJTBBZnJvbSUyMHRyYW5zZm9ybWVycyUyMGltcG9ydCUyMEF1dG9Nb2RlbEZvckNhdXNhbExNJTJDJTIwQXV0b1Rva2VuaXplciUwQSUwQXRva2VuaXplciUyMCUzRCUyMEF1dG9Ub2tlbml6ZXIuZnJvbV9wcmV0cmFpbmVkKCUyMm1ldGEtbGxhbWElMkZMbGFtYS0zLjEtOEIlMjIpJTBBbW9kZWwlMjAlM0QlMjBBdXRvTW9kZWxGb3JDYXVzYWxMTS5mcm9tX3ByZXRyYWluZWQoJTIybWV0YS1sbGFtYSUyRkxsYW1hLTMuMS04QiUyMiUyQyUyMGRldmljZV9tYXAlM0QlMjJhdXRvJTIyKSUwQSUwQWlucHV0X3RleHQlMjAlM0QlMjAlMjJIZWxsbyUyQyUyMG15JTIwbGxhbWElMjBpcyUyMGN1dGUlMjIlMEFpbnB1dHMlMjAlM0QlMjB0b2tlbml6ZXIoaW5wdXRfdGV4dCUyQyUyMHJldHVybl90ZW5zb3JzJTNEJTIycHQlMjIpLnRvKG1vZGVsLmRldmljZSklMEElMEF3aXRoJTIwc2RwYV9rZXJuZWwoU0RQQmFja2VuZC5GTEFTSF9BVFRFTlRJT04pJTNBJTBBJTIwJTIwJTIwJTIwb3V0cHV0cyUyMCUzRCUyMG1vZGVsLmdlbmVyYXRlKCoqaW5wdXRzKSUwQSUwQXByaW50KHRva2VuaXplci5kZWNvZGUob3V0cHV0cyU1QjAlNUQlMkMlMjBza2lwX3NwZWNpYWxfdG9rZW5zJTNEVHJ1ZSkp",highlighted:`<span class="hljs-keyword">import</span> torch
<span class="hljs-keyword">from</span> torch.nn.attention <span class="hljs-keyword">import</span> SDPBackend, sdpa_kernel
<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoModelForCausalLM, AutoTokenizer

tokenizer = AutoTokenizer.from_pretrained(<span class="hljs-string">&quot;meta-llama/Llama-3.1-8B&quot;</span>)
model = AutoModelForCausalLM.from_pretrained(<span class="hljs-string">&quot;meta-llama/Llama-3.1-8B&quot;</span>, device_map=<span class="hljs-string">&quot;auto&quot;</span>)

input_text = <span class="hljs-string">&quot;Hello, my llama is cute&quot;</span>
inputs = tokenizer(input_text, return_tensors=<span class="hljs-string">&quot;pt&quot;</span>).to(model.device)

<span class="hljs-keyword">with</span> sdpa_kernel(SDPBackend.FLASH_ATTENTION):
    outputs = model.generate(**inputs)

<span class="hljs-built_in">print</span>(tokenizer.decode(outputs[<span class="hljs-number">0</span>], skip_special_tokens=<span class="hljs-literal">True</span>))`,wrap:!1}}),Te=new C({props:{code:"UnVudGltZUVycm9yJTNBJTIwTm8lMjBhdmFpbGFibGUlMjBrZXJuZWwuJTIwQWJvcnRpbmclMjBleGVjdXRpb24uJTBBJTBBcGlwMyUyMGluc3RhbGwlMjAtVSUyMC0tcHJlJTIwdG9yY2glMjB0b3JjaHZpc2lvbiUyMHRvcmNoYXVkaW8lMjAtLWluZGV4LXVybCUyMGh0dHBzJTNBJTJGJTJGZG93bmxvYWQucHl0b3JjaC5vcmclMkZ3aGwlMkZuaWdodGx5JTJGY3UxMTg=",highlighted:`RuntimeError: No available kernel. Aborting execution.

pip3 install -U --pre torch torchvision torchaudio --index-url https://download.pytorch.org/whl/nightly/cu118`,wrap:!1}}),ge=new xe({props:{title:"FlashAttention",local:"flashattention",headingTag:"h2"}}),z=new Jt({props:{id:"install",options:["NVIDIA","AMD"],$$slots:{default:[yn]},$$scope:{ctx:_}}}),Ue=new C({props:{code:"ZnJvbSUyMHRyYW5zZm9ybWVycyUyMGltcG9ydCUyMEF1dG9Nb2RlbEZvckNhdXNhbExNJTBBJTBBbW9kZWwlMjAlM0QlMjBBdXRvTW9kZWxGb3JDYXVzYWxMTS5mcm9tX3ByZXRyYWluZWQoJTIybWV0YS1sbGFtYSUyRkxsYW1hLTMuMS04QiUyMiUyQyUyMGRldmljZV9tYXAlM0QlMjJhdXRvJTIyJTJDJTIwZHR5cGUlM0R0b3JjaC5iZmxvYXQxNiUyQyUyMGF0dG5faW1wbGVtZW50YXRpb24lM0QlMjJmbGFzaF9hdHRlbnRpb25fMiUyMik=",highlighted:`<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoModelForCausalLM

model = AutoModelForCausalLM.from_pretrained(<span class="hljs-string">&quot;meta-llama/Llama-3.1-8B&quot;</span>, device_map=<span class="hljs-string">&quot;auto&quot;</span>, dtype=torch.bfloat16, attn_implementation=<span class="hljs-string">&quot;flash_attention_2&quot;</span>)`,wrap:!1}}),je=new xe({props:{title:"Benchmarks",local:"benchmarks",headingTag:"h3"}}),Q=new Jt({props:{id:"padded",options:["short sequence length","long sequence length"],$$slots:{default:[Tn]},$$scope:{ctx:_}}}),F=new Jt({props:{id:"not-padded",options:["tiiuae/falcon-7b","meta-llama/Llama-7b-hf"],$$slots:{default:[_n]},$$scope:{ctx:_}}}),Ge=new fn({props:{source:"https://github.com/huggingface/transformers/blob/main/docs/source/en/perf_infer_gpu_one.md"}}),{c(){a=d("meta"),f=p(),o=d("p"),r=p(),y(s.$$.fragment),i=p(),c=d("p"),c.textContent=j,x=p(),W=d("p"),W.textContent=R,G=p(),y(k.$$.fragment),B=p(),U=d("p"),U.innerHTML=H,M=p(),J=d("p"),J.textContent=A,X=p(),y(L.$$.fragment),I=p(),y(h.$$.fragment),Z=p(),y(P.$$.fragment),Xe=p(),N=d("p"),N.innerHTML=Wt,Re=p(),S=d("p"),S.textContent=Ut,He=p(),E=d("p"),E.innerHTML=jt,Le=p(),D=d("table"),D.innerHTML=Zt,Ie=p(),K=d("p"),K.innerHTML=kt,Ve=p(),y(O.$$.fragment),qe=p(),ee=d("p"),ee.innerHTML=Gt,ze=p(),y(te.$$.fragment),Qe=p(),ne=d("p"),ne.innerHTML=xt,Fe=p(),y(le.$$.fragment),Ye=p(),ae=d("p"),ae.innerHTML=Bt,Ae=p(),se=d("ul"),se.innerHTML=Ct,Pe=p(),y(q.$$.fragment),Ne=p(),oe=d("p"),oe.innerHTML=Xt,Se=p(),y(ie.$$.fragment),Ee=p(),re=d("p"),re.innerHTML=Rt,De=p(),y(pe.$$.fragment),Ke=p(),me=d("p"),me.innerHTML=Ht,Oe=p(),y(fe.$$.fragment),et=p(),de=d("p"),de.innerHTML=Lt,tt=p(),ue=d("p"),ue.textContent=It,nt=p(),ce=d("ul"),ce.innerHTML=Vt,lt=p(),he=d("p"),he.innerHTML=qt,at=p(),be=d("p"),be.innerHTML=zt,st=p(),y(Me.$$.fragment),ot=p(),ye=d("p"),ye.innerHTML=Qt,it=p(),y($e.$$.fragment),rt=p(),we=d("p"),we.innerHTML=Ft,pt=p(),y(Te.$$.fragment),mt=p(),y(ge.$$.fragment),ft=p(),ve=d("p"),ve.innerHTML=Yt,dt=p(),_e=d("ol"),_e.innerHTML=At,ut=p(),Je=d("p"),Je.textContent=Pt,ct=p(),y(z.$$.fragment),ht=p(),We=d("p"),We.innerHTML=Nt,bt=p(),y(Ue.$$.fragment),Mt=p(),y(je.$$.fragment),yt=p(),Ze=d("p"),Ze.textContent=St,$t=p(),y(Q.$$.fragment),wt=p(),ke=d("p"),ke.textContent=Et,Tt=p(),y(F.$$.fragment),gt=p(),y(Ge.$$.fragment),vt=p(),Ce=d("p"),this.h()},l(e){const l=rn("svelte-u9bgzb",document.head);a=u(l,"META",{name:!0,content:!0}),l.forEach(t),f=m(e),o=u(e,"P",{}),nn(o).forEach(t),r=m(e),$(s.$$.fragment,e),i=m(e),c=u(e,"P",{"data-svelte-h":!0}),b(c)!=="svelte-1fwjvck"&&(c.textContent=j),x=m(e),W=u(e,"P",{"data-svelte-h":!0}),b(W)!=="svelte-1abs0sh"&&(W.textContent=R),G=m(e),$(k.$$.fragment,e),B=m(e),U=u(e,"P",{"data-svelte-h":!0}),b(U)!=="svelte-1n5togo"&&(U.innerHTML=H),M=m(e),J=u(e,"P",{"data-svelte-h":!0}),b(J)!=="svelte-1b4ixl9"&&(J.textContent=A),X=m(e),$(L.$$.fragment,e),I=m(e),$(h.$$.fragment,e),Z=m(e),$(P.$$.fragment,e),Xe=m(e),N=u(e,"P",{"data-svelte-h":!0}),b(N)!=="svelte-1p718jw"&&(N.innerHTML=Wt),Re=m(e),S=u(e,"P",{"data-svelte-h":!0}),b(S)!=="svelte-pvrbx"&&(S.textContent=Ut),He=m(e),E=u(e,"P",{"data-svelte-h":!0}),b(E)!=="svelte-bnr9pe"&&(E.innerHTML=jt),Le=m(e),D=u(e,"TABLE",{"data-svelte-h":!0}),b(D)!=="svelte-1wm1a3t"&&(D.innerHTML=Zt),Ie=m(e),K=u(e,"P",{"data-svelte-h":!0}),b(K)!=="svelte-1pvihnl"&&(K.innerHTML=kt),Ve=m(e),$(O.$$.fragment,e),qe=m(e),ee=u(e,"P",{"data-svelte-h":!0}),b(ee)!=="svelte-mmymyw"&&(ee.innerHTML=Gt),ze=m(e),$(te.$$.fragment,e),Qe=m(e),ne=u(e,"P",{"data-svelte-h":!0}),b(ne)!=="svelte-tp1950"&&(ne.innerHTML=xt),Fe=m(e),$(le.$$.fragment,e),Ye=m(e),ae=u(e,"P",{"data-svelte-h":!0}),b(ae)!=="svelte-12f67in"&&(ae.innerHTML=Bt),Ae=m(e),se=u(e,"UL",{"data-svelte-h":!0}),b(se)!=="svelte-1duvg1i"&&(se.innerHTML=Ct),Pe=m(e),$(q.$$.fragment,e),Ne=m(e),oe=u(e,"P",{"data-svelte-h":!0}),b(oe)!=="svelte-1133588"&&(oe.innerHTML=Xt),Se=m(e),$(ie.$$.fragment,e),Ee=m(e),re=u(e,"P",{"data-svelte-h":!0}),b(re)!=="svelte-1onz2qq"&&(re.innerHTML=Rt),De=m(e),$(pe.$$.fragment,e),Ke=m(e),me=u(e,"P",{"data-svelte-h":!0}),b(me)!=="svelte-agxk5z"&&(me.innerHTML=Ht),Oe=m(e),$(fe.$$.fragment,e),et=m(e),de=u(e,"P",{"data-svelte-h":!0}),b(de)!=="svelte-1vc1lf7"&&(de.innerHTML=Lt),tt=m(e),ue=u(e,"P",{"data-svelte-h":!0}),b(ue)!=="svelte-1wn2wyw"&&(ue.textContent=It),nt=m(e),ce=u(e,"UL",{"data-svelte-h":!0}),b(ce)!=="svelte-n7w2td"&&(ce.innerHTML=Vt),lt=m(e),he=u(e,"P",{"data-svelte-h":!0}),b(he)!=="svelte-fb3spy"&&(he.innerHTML=qt),at=m(e),be=u(e,"P",{"data-svelte-h":!0}),b(be)!=="svelte-xjpd78"&&(be.innerHTML=zt),st=m(e),$(Me.$$.fragment,e),ot=m(e),ye=u(e,"P",{"data-svelte-h":!0}),b(ye)!=="svelte-1kdwdpa"&&(ye.innerHTML=Qt),it=m(e),$($e.$$.fragment,e),rt=m(e),we=u(e,"P",{"data-svelte-h":!0}),b(we)!=="svelte-1r8c7l7"&&(we.innerHTML=Ft),pt=m(e),$(Te.$$.fragment,e),mt=m(e),$(ge.$$.fragment,e),ft=m(e),ve=u(e,"P",{"data-svelte-h":!0}),b(ve)!=="svelte-1a1ytd4"&&(ve.innerHTML=Yt),dt=m(e),_e=u(e,"OL",{"data-svelte-h":!0}),b(_e)!=="svelte-1t56p9w"&&(_e.innerHTML=At),ut=m(e),Je=u(e,"P",{"data-svelte-h":!0}),b(Je)!=="svelte-1b1vtgy"&&(Je.textContent=Pt),ct=m(e),$(z.$$.fragment,e),ht=m(e),We=u(e,"P",{"data-svelte-h":!0}),b(We)!=="svelte-86sj50"&&(We.innerHTML=Nt),bt=m(e),$(Ue.$$.fragment,e),Mt=m(e),$(je.$$.fragment,e),yt=m(e),Ze=u(e,"P",{"data-svelte-h":!0}),b(Ze)!=="svelte-1dcldcy"&&(Ze.textContent=St),$t=m(e),$(Q.$$.fragment,e),wt=m(e),ke=u(e,"P",{"data-svelte-h":!0}),b(ke)!=="svelte-ox9wk"&&(ke.textContent=Et),Tt=m(e),$(F.$$.fragment,e),gt=m(e),$(Ge.$$.fragment,e),vt=m(e),Ce=u(e,"P",{}),nn(Ce).forEach(t),this.h()},h(){Be(a,"name","hf:doc:metadata"),Be(a,"content",Wn)},m(e,l){pn(document.head,a),n(e,f,l),n(e,o,l),n(e,r,l),w(s,e,l),n(e,i,l),n(e,c,l),n(e,x,l),n(e,W,l),n(e,G,l),w(k,e,l),n(e,B,l),n(e,U,l),n(e,M,l),n(e,J,l),n(e,X,l),w(L,e,l),n(e,I,l),w(h,e,l),n(e,Z,l),w(P,e,l),n(e,Xe,l),n(e,N,l),n(e,Re,l),n(e,S,l),n(e,He,l),n(e,E,l),n(e,Le,l),n(e,D,l),n(e,Ie,l),n(e,K,l),n(e,Ve,l),w(O,e,l),n(e,qe,l),n(e,ee,l),n(e,ze,l),w(te,e,l),n(e,Qe,l),n(e,ne,l),n(e,Fe,l),w(le,e,l),n(e,Ye,l),n(e,ae,l),n(e,Ae,l),n(e,se,l),n(e,Pe,l),w(q,e,l),n(e,Ne,l),n(e,oe,l),n(e,Se,l),w(ie,e,l),n(e,Ee,l),n(e,re,l),n(e,De,l),w(pe,e,l),n(e,Ke,l),n(e,me,l),n(e,Oe,l),w(fe,e,l),n(e,et,l),n(e,de,l),n(e,tt,l),n(e,ue,l),n(e,nt,l),n(e,ce,l),n(e,lt,l),n(e,he,l),n(e,at,l),n(e,be,l),n(e,st,l),w(Me,e,l),n(e,ot,l),n(e,ye,l),n(e,it,l),w($e,e,l),n(e,rt,l),n(e,we,l),n(e,pt,l),w(Te,e,l),n(e,mt,l),w(ge,e,l),n(e,ft,l),n(e,ve,l),n(e,dt,l),n(e,_e,l),n(e,ut,l),n(e,Je,l),n(e,ct,l),w(z,e,l),n(e,ht,l),n(e,We,l),n(e,bt,l),w(Ue,e,l),n(e,Mt,l),w(je,e,l),n(e,yt,l),n(e,Ze,l),n(e,$t,l),w(Q,e,l),n(e,wt,l),n(e,ke,l),n(e,Tt,l),w(F,e,l),n(e,gt,l),w(Ge,e,l),n(e,vt,l),n(e,Ce,l),_t=!0},p(e,[l]){const Dt={};l&2&&(Dt.$$scope={dirty:l,ctx:e}),h.$set(Dt);const Kt={};l&2&&(Kt.$$scope={dirty:l,ctx:e}),q.$set(Kt);const Ot={};l&2&&(Ot.$$scope={dirty:l,ctx:e}),z.$set(Ot);const en={};l&2&&(en.$$scope={dirty:l,ctx:e}),Q.$set(en);const tn={};l&2&&(tn.$$scope={dirty:l,ctx:e}),F.$set(tn)},i(e){_t||(T(s.$$.fragment,e),T(k.$$.fragment,e),T(L.$$.fragment,e),T(h.$$.fragment,e),T(P.$$.fragment,e),T(O.$$.fragment,e),T(te.$$.fragment,e),T(le.$$.fragment,e),T(q.$$.fragment,e),T(ie.$$.fragment,e),T(pe.$$.fragment,e),T(fe.$$.fragment,e),T(Me.$$.fragment,e),T($e.$$.fragment,e),T(Te.$$.fragment,e),T(ge.$$.fragment,e),T(z.$$.fragment,e),T(Ue.$$.fragment,e),T(je.$$.fragment,e),T(Q.$$.fragment,e),T(F.$$.fragment,e),T(Ge.$$.fragment,e),_t=!0)},o(e){g(s.$$.fragment,e),g(k.$$.fragment,e),g(L.$$.fragment,e),g(h.$$.fragment,e),g(P.$$.fragment,e),g(O.$$.fragment,e),g(te.$$.fragment,e),g(le.$$.fragment,e),g(q.$$.fragment,e),g(ie.$$.fragment,e),g(pe.$$.fragment,e),g(fe.$$.fragment,e),g(Me.$$.fragment,e),g($e.$$.fragment,e),g(Te.$$.fragment,e),g(ge.$$.fragment,e),g(z.$$.fragment,e),g(Ue.$$.fragment,e),g(je.$$.fragment,e),g(Q.$$.fragment,e),g(F.$$.fragment,e),g(Ge.$$.fragment,e),_t=!1},d(e){e&&(t(f),t(o),t(r),t(i),t(c),t(x),t(W),t(G),t(B),t(U),t(M),t(J),t(X),t(I),t(Z),t(Xe),t(N),t(Re),t(S),t(He),t(E),t(Le),t(D),t(Ie),t(K),t(Ve),t(qe),t(ee),t(ze),t(Qe),t(ne),t(Fe),t(Ye),t(ae),t(Ae),t(se),t(Pe),t(Ne),t(oe),t(Se),t(Ee),t(re),t(De),t(Ke),t(me),t(Oe),t(et),t(de),t(tt),t(ue),t(nt),t(ce),t(lt),t(he),t(at),t(be),t(st),t(ot),t(ye),t(it),t(rt),t(we),t(pt),t(mt),t(ft),t(ve),t(dt),t(_e),t(ut),t(Je),t(ct),t(ht),t(We),t(bt),t(Mt),t(yt),t(Ze),t($t),t(wt),t(ke),t(Tt),t(gt),t(vt),t(Ce)),t(a),v(s,e),v(k,e),v(L,e),v(h,e),v(P,e),v(O,e),v(te,e),v(le,e),v(q,e),v(ie,e),v(pe,e),v(fe,e),v(Me,e),v($e,e),v(Te,e),v(ge,e),v(z,e),v(Ue,e),v(je,e),v(Q,e),v(F,e),v(Ge,e)}}}const Wn='{"title":"GPU","local":"gpu","sections":[{"title":"bitsandbytes","local":"bitsandbytes","sections":[],"depth":2},{"title":"Optimum","local":"optimum","sections":[{"title":"BetterTransformer","local":"bettertransformer","sections":[],"depth":3}],"depth":2},{"title":"Scaled dot product attention (SDPA)","local":"scaled-dot-product-attention-sdpa","sections":[],"depth":2},{"title":"FlashAttention","local":"flashattention","sections":[{"title":"Benchmarks","local":"benchmarks","sections":[],"depth":3}],"depth":2}],"depth":1}';function Un(_){return an(()=>{new URLSearchParams(window.location.search).get("fw")}),[]}class Cn extends sn{constructor(a){super(),on(this,a,Un,Jn,ln,{})}}export{Cn as component};
