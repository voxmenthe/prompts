import{s as tl,z as ll,o as sl,n as B}from"../chunks/scheduler.18a86fab.js";import{S as al,i as nl,g as h,s as p,r as T,A as ol,h as y,f as a,c,j as Ut,u as J,x as f,k as ke,y as il,a as n,v as w,d as b,t as U,w as j}from"../chunks/index.98837b22.js";import{T as K}from"../chunks/Tip.77304350.js";import{C as W}from"../chunks/CodeBlock.8d0c2e8a.js";import{H,E as rl}from"../chunks/getInferenceSnippets.06c2775f.js";import{H as jt,a as Ce}from"../chunks/HfOption.6641485e.js";function pl(g){let t,m='Try out <a href="https://hf.co/docs/text-generation-inference" rel="nofollow">Text Generation Inference (TGI)</a>, a Hugging Face library dedicated to deploying and serving highly optimized LLMs for inference.';return{c(){t=h("p"),t.innerHTML=m},l(s){t=y(s,"P",{"data-svelte-h":!0}),f(t)!=="svelte-c1q0e5"&&(t.innerHTML=m)},m(s,r){n(s,t,r)},p:B,d(s){s&&a(t)}}}function cl(g){let t,m='Follow this <a href="https://github.com/huggingface/transformers/issues/28981" rel="nofollow">issue</a> to track which models (Llama, Gemma, Mistral, etc.) support a static kv-cache and torch.compile.';return{c(){t=h("p"),t.innerHTML=m},l(s){t=y(s,"P",{"data-svelte-h":!0}),f(t)!=="svelte-58h2fm"&&(t.innerHTML=m)},m(s,r){n(s,t,r)},p:B,d(s){s&&a(t)}}}function ml(g){let t,m='Regardless of how you use the static kv-cache and torch.compile, left-pad your inputs with <a href="https://hf.co/docs/transformers/main_classes/tokenizer#transformers.PreTrainedTokenizer.__call__.pad_to_multiple_of" rel="nofollow">pad_to_multiple_of</a> to a limited set of values to avoid shape-related recompilations.';return{c(){t=h("p"),t.innerHTML=m},l(s){t=y(s,"P",{"data-svelte-h":!0}),f(t)!=="svelte-uz572w"&&(t.innerHTML=m)},m(s,r){n(s,t,r)},p:B,d(s){s&&a(t)}}}function Ml(g){let t,m='<li>Set the <a href="https://hf.co/docs/transformers/main_classes/text_generation#transformers.GenerationConfig.cache_implementation" rel="nofollow">cache_implementation</a> to <code>&quot;static&quot;</code> in a models <a href="/docs/transformers/v4.56.2/en/main_classes/text_generation#transformers.GenerationConfig">GenerationConfig</a>.</li> <li>Call <a href="./perf_torch_compile">torch.compile</a> to compile the forward pass with the static kv-cache.</li>',s,r,o,i,M='Under the hood, <a href="/docs/transformers/v4.56.2/en/main_classes/text_generation#transformers.GenerationMixin.generate">generate()</a> attempts to reuse the same cache object to avoid recompilation at each call, which is critical to get the most out of <a href="./perf_torch_compile">torch.compile</a>. Be aware of the following to avoid triggering recompilation or if generation is slower than expected.',Z,G,k="<li>If the batch size changes or the maximum output length increases between calls, the cache is reinitialized and recompiled.</li> <li>The first several calls of the compiled function are slower because it is being compiled.</li>",_;return r=new W({props:{code:"ZnJvbSUyMHRyYW5zZm9ybWVycyUyMGltcG9ydCUyMEF1dG9Ub2tlbml6ZXIlMkMlMjBBdXRvTW9kZWxGb3JDYXVzYWxMTSUwQWltcG9ydCUyMHRvcmNoJTBBaW1wb3J0JTIwb3MlMEFvcy5lbnZpcm9uJTVCJTIyVE9LRU5JWkVSU19QQVJBTExFTElTTSUyMiU1RCUyMCUzRCUyMCUyMmZhbHNlJTIyJTIwJTIwJTIzJTIwVG8lMjBwcmV2ZW50JTIwbG9uZyUyMHdhcm5pbmdzJTIwJTNBKSUwQSUwQXRva2VuaXplciUyMCUzRCUyMEF1dG9Ub2tlbml6ZXIuZnJvbV9wcmV0cmFpbmVkKCUyMmdvb2dsZSUyRmdlbW1hLTJiJTIyKSUwQW1vZGVsJTIwJTNEJTIwQXV0b01vZGVsRm9yQ2F1c2FsTE0uZnJvbV9wcmV0cmFpbmVkKCUyMmdvb2dsZSUyRmdlbW1hLTJiJTIyJTJDJTIwZHR5cGUlM0QlMjJhdXRvJTIyJTJDJTIwZGV2aWNlX21hcCUzRCUyMmF1dG8lMjIpJTBBJTBBbW9kZWwuZ2VuZXJhdGlvbl9jb25maWcuY2FjaGVfaW1wbGVtZW50YXRpb24lMjAlM0QlMjAlMjJzdGF0aWMlMjIlMEElMEFtb2RlbC5mb3J3YXJkJTIwJTNEJTIwdG9yY2guY29tcGlsZShtb2RlbC5mb3J3YXJkJTJDJTIwbW9kZSUzRCUyMnJlZHVjZS1vdmVyaGVhZCUyMiUyQyUyMGZ1bGxncmFwaCUzRFRydWUpJTBBaW5wdXRfdGV4dCUyMCUzRCUyMCUyMlRoZSUyMHRoZW9yeSUyMG9mJTIwc3BlY2lhbCUyMHJlbGF0aXZpdHklMjBzdGF0ZXMlMjAlMjIlMEFpbnB1dF9pZHMlMjAlM0QlMjB0b2tlbml6ZXIoaW5wdXRfdGV4dCUyQyUyMHJldHVybl90ZW5zb3JzJTNEJTIycHQlMjIpLnRvKG1vZGVsLmRldmljZS50eXBlKSUwQSUwQW91dHB1dHMlMjAlM0QlMjBtb2RlbC5nZW5lcmF0ZSgqKmlucHV0X2lkcyklMEFwcmludCh0b2tlbml6ZXIuYmF0Y2hfZGVjb2RlKG91dHB1dHMlMkMlMjBza2lwX3NwZWNpYWxfdG9rZW5zJTNEVHJ1ZSkpJTBBJTVCJ1RoZSUyMHRoZW9yeSUyMG9mJTIwc3BlY2lhbCUyMHJlbGF0aXZpdHklMjBzdGF0ZXMlMjAxLiUyMFRoZSUyMHNwZWVkJTIwb2YlMjBsaWdodCUyMGlzJTIwY29uc3RhbnQlMjBpbiUyMGFsbCUyMGluZXJ0aWFsJTIwcmVmZXJlbmNlJyU1RA==",highlighted:`<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoTokenizer, AutoModelForCausalLM
<span class="hljs-keyword">import</span> torch
<span class="hljs-keyword">import</span> os
os.environ[<span class="hljs-string">&quot;TOKENIZERS_PARALLELISM&quot;</span>] = <span class="hljs-string">&quot;false&quot;</span>  <span class="hljs-comment"># To prevent long warnings :)</span>

tokenizer = AutoTokenizer.from_pretrained(<span class="hljs-string">&quot;google/gemma-2b&quot;</span>)
model = AutoModelForCausalLM.from_pretrained(<span class="hljs-string">&quot;google/gemma-2b&quot;</span>, dtype=<span class="hljs-string">&quot;auto&quot;</span>, device_map=<span class="hljs-string">&quot;auto&quot;</span>)

model.generation_config.cache_implementation = <span class="hljs-string">&quot;static&quot;</span>

model.forward = torch.<span class="hljs-built_in">compile</span>(model.forward, mode=<span class="hljs-string">&quot;reduce-overhead&quot;</span>, fullgraph=<span class="hljs-literal">True</span>)
input_text = <span class="hljs-string">&quot;The theory of special relativity states &quot;</span>
input_ids = tokenizer(input_text, return_tensors=<span class="hljs-string">&quot;pt&quot;</span>).to(model.device.<span class="hljs-built_in">type</span>)

outputs = model.generate(**input_ids)
<span class="hljs-built_in">print</span>(tokenizer.batch_decode(outputs, skip_special_tokens=<span class="hljs-literal">True</span>))
[<span class="hljs-string">&#x27;The theory of special relativity states 1. The speed of light is constant in all inertial reference&#x27;</span>]`,wrap:!1}}),{c(){t=h("ol"),t.innerHTML=m,s=p(),T(r.$$.fragment),o=p(),i=h("p"),i.innerHTML=M,Z=p(),G=h("ol"),G.innerHTML=k},l(d){t=y(d,"OL",{"data-svelte-h":!0}),f(t)!=="svelte-1fzajyj"&&(t.innerHTML=m),s=c(d),J(r.$$.fragment,d),o=c(d),i=y(d,"P",{"data-svelte-h":!0}),f(i)!=="svelte-ikv95v"&&(i.innerHTML=M),Z=c(d),G=y(d,"OL",{"data-svelte-h":!0}),f(G)!=="svelte-13b9uyo"&&(G.innerHTML=k)},m(d,v){n(d,t,v),n(d,s,v),w(r,d,v),n(d,o,v),n(d,i,v),n(d,Z,v),n(d,G,v),_=!0},p:B,i(d){_||(b(r.$$.fragment,d),_=!0)},o(d){U(r.$$.fragment,d),_=!1},d(d){d&&(a(t),a(s),a(o),a(i),a(Z),a(G)),j(r,d)}}}function dl(g){let t,m='To reuse <a href="/docs/transformers/v4.56.2/en/internal/generation_utils#transformers.StaticCache">StaticCache</a> on a new prompt, use <a href="/docs/transformers/v4.56.2/en/internal/generation_utils#transformers.Cache.reset">reset()</a> to reset the cache contents between calls.';return{c(){t=h("p"),t.innerHTML=m},l(s){t=y(s,"P",{"data-svelte-h":!0}),f(t)!=="svelte-6236h9"&&(t.innerHTML=m)},m(s,r){n(s,t,r)},p:B,d(s){s&&a(t)}}}function ul(g){let t,m='Directly initialize a <a href="/docs/transformers/v4.56.2/en/internal/generation_utils#transformers.StaticCache">StaticCache</a> object and pass it to the <code>past_key_values</code> parameter in <a href="/docs/transformers/v4.56.2/en/main_classes/text_generation#transformers.GenerationMixin.generate">generate()</a>. The <a href="/docs/transformers/v4.56.2/en/internal/generation_utils#transformers.StaticCache">StaticCache</a> keeps the cache contents, so you can pass it to a new <a href="/docs/transformers/v4.56.2/en/main_classes/text_generation#transformers.GenerationMixin.generate">generate()</a> call to continue generation, similar to a dynamic cache.',s,r,o,i,M,Z,G='Another option for using <a href="/docs/transformers/v4.56.2/en/internal/generation_utils#transformers.StaticCache">StaticCache</a> is to pass it to a models forward pass using the same <code>past_key_values</code> argument. This allows you to write your own custom decoding function to decode the next token given the current token, position, and cache position of previously generated tokens.',k,_,d,v,$e='To enable static kv-cache and <a href="./perf_torch_compile">torch.compile</a> with <a href="/docs/transformers/v4.56.2/en/internal/generation_utils#transformers.StaticCache">StaticCache</a>, follow the steps below.',F,$,D='<li>Initialize <a href="/docs/transformers/v4.56.2/en/internal/generation_utils#transformers.StaticCache">StaticCache</a> before using the model for inference to configure parameters like the maximum batch size and sequence length.</li> <li>Call <a href="./perf_torch_compile">torch.compile</a> on the model to compile the forward pass with the static kv-cache.</li> <li>se SDPBackend.MATH in the <a href="https://pytorch.org/docs/stable/generated/torch.nn.attention.sdpa_kernel.html" rel="nofollow">torch.nn.attention.sdpa_kernel</a> context manager to enable the native PyTorch C++ implementation of scaled dot product attention to speed up inference even more.</li>',R,I,V;return r=new W({props:{code:"ZnJvbSUyMHRyYW5zZm9ybWVycyUyMGltcG9ydCUyMEF1dG9Ub2tlbml6ZXIlMkMlMjBBdXRvTW9kZWxGb3JDYXVzYWxMTSUyQyUyMFN0YXRpY0NhY2hlJTBBaW1wb3J0JTIwdG9yY2glMEFpbXBvcnQlMjBvcyUwQW9zLmVudmlyb24lNUIlMjJUT0tFTklaRVJTX1BBUkFMTEVMSVNNJTIyJTVEJTIwJTNEJTIwJTIyZmFsc2UlMjIlMjAlMjAlMjMlMjBUbyUyMHByZXZlbnQlMjBsb25nJTIwd2FybmluZ3MlMjAlM0EpJTBBJTBBdG9rZW5pemVyJTIwJTNEJTIwQXV0b1Rva2VuaXplci5mcm9tX3ByZXRyYWluZWQoJTIyZ29vZ2xlJTJGZ2VtbWEtMmIlMjIpJTBBbW9kZWwlMjAlM0QlMjBBdXRvTW9kZWxGb3JDYXVzYWxMTS5mcm9tX3ByZXRyYWluZWQoJTIyZ29vZ2xlJTJGZ2VtbWEtMmIlMjIlMkMlMjBkdHlwZSUzRCUyMmF1dG8lMjIlMkMlMjBkZXZpY2VfbWFwJTNEJTIyYXV0byUyMiklMEElMEFtb2RlbC5mb3J3YXJkJTIwJTNEJTIwdG9yY2guY29tcGlsZShtb2RlbC5mb3J3YXJkJTJDJTIwbW9kZSUzRCUyMnJlZHVjZS1vdmVyaGVhZCUyMiUyQyUyMGZ1bGxncmFwaCUzRFRydWUpJTBBaW5wdXRfdGV4dCUyMCUzRCUyMCUyMlRoZSUyMHRoZW9yeSUyMG9mJTIwc3BlY2lhbCUyMHJlbGF0aXZpdHklMjBzdGF0ZXMlMjAlMjIlMEFpbnB1dF9pZHMlMjAlM0QlMjB0b2tlbml6ZXIoaW5wdXRfdGV4dCUyQyUyMHJldHVybl90ZW5zb3JzJTNEJTIycHQlMjIpLnRvKG1vZGVsLmRldmljZS50eXBlKSUwQXByb21wdF9sZW5ndGglMjAlM0QlMjBpbnB1dF9pZHMuaW5wdXRfaWRzLnNoYXBlJTVCMSU1RCUwQW1vZGVsLmdlbmVyYXRpb25fY29uZmlnLm1heF9uZXdfdG9rZW5zJTIwJTNEJTIwMTYlMEElMEFwYXN0X2tleV92YWx1ZXMlMjAlM0QlMjBTdGF0aWNDYWNoZSglMEElMjAlMjAlMjAlMjBjb25maWclM0Rtb2RlbC5jb25maWclMkMlMEElMjAlMjAlMjAlMjAlMjMlMjBJZiUyMHlvdSUyMHBsYW4lMjB0byUyMHJldXNlJTIwdGhlJTIwY2FjaGUlMkMlMjBtYWtlJTIwc3VyZSUyMHRoZSUyMGNhY2hlJTIwbGVuZ3RoJTIwaXMlMjBsYXJnZSUyMGVub3VnaCUyMGZvciUyMGFsbCUyMGNhc2VzJTBBJTIwJTIwJTIwJTIwbWF4X2NhY2hlX2xlbiUzRHByb21wdF9sZW5ndGglMkIobW9kZWwuZ2VuZXJhdGlvbl9jb25maWcubWF4X25ld190b2tlbnMqMiklMkMlMEEpJTBBb3V0cHV0cyUyMCUzRCUyMG1vZGVsLmdlbmVyYXRlKCoqaW5wdXRfaWRzJTJDJTIwcGFzdF9rZXlfdmFsdWVzJTNEcGFzdF9rZXlfdmFsdWVzKSUwQXByaW50KHRva2VuaXplci5iYXRjaF9kZWNvZGUob3V0cHV0cyUyQyUyMHNraXBfc3BlY2lhbF90b2tlbnMlM0RUcnVlKSklMEElNUInVGhlJTIwdGhlb3J5JTIwb2YlMjBzcGVjaWFsJTIwcmVsYXRpdml0eSUyMHN0YXRlcyUyMDEuJTIwVGhlJTIwc3BlZWQlMjBvZiUyMGxpZ2h0JTIwaXMlMjBjb25zdGFudCUyMGluJTIwYWxsJTIwaW5lcnRpYWwlMjByZWZlcmVuY2UlMjBmcmFtZXMuJTIwMiclNUQlMEElMEElMjMlMjBwYXNzJTIwaW4lMjB0aGUlMjBnZW5lcmF0ZWQlMjB0ZXh0JTIwYW5kJTIwdGhlJTIwc2FtZSUyMGNhY2hlJTIwb2JqZWN0JTIwdG8lMjBjb250aW51ZSUyMGdlbmVyYXRpb24lMjBmcm9tJTIwd2hlcmUlMjBpdCUyMGxlZnQlMjBvZmYuJTIwT3B0aW9uYWxseSUyQyUyMGluJTIwYSUwQSUyMyUyMG11bHRpLXR1cm4lMjBjb252ZXJzYXRpb24lMkMlMjBhcHBlbmQlMjB0aGUlMjBuZXclMjB1c2VyJTIwaW5wdXQlMjB0byUyMHRoZSUyMGdlbmVyYXRlZCUyMHRleHQuJTBBbmV3X2lucHV0X2lkcyUyMCUzRCUyMG91dHB1dHMlMEFvdXRwdXRzJTIwJTNEJTIwbW9kZWwuZ2VuZXJhdGUobmV3X2lucHV0X2lkcyUyQyUyMHBhc3Rfa2V5X3ZhbHVlcyUzRHBhc3Rfa2V5X3ZhbHVlcyklMEFwcmludCh0b2tlbml6ZXIuYmF0Y2hfZGVjb2RlKG91dHB1dHMlMkMlMjBza2lwX3NwZWNpYWxfdG9rZW5zJTNEVHJ1ZSkpJTBBJTVCJ1RoZSUyMHRoZW9yeSUyMG9mJTIwc3BlY2lhbCUyMHJlbGF0aXZpdHklMjBzdGF0ZXMlMjAxLiUyMFRoZSUyMHNwZWVkJTIwb2YlMjBsaWdodCUyMGlzJTIwY29uc3RhbnQlMjBpbiUyMGFsbCUyMGluZXJ0aWFsJTIwcmVmZXJlbmNlJTIwZnJhbWVzLiUyMDIuJTIwVGhlJTIwc3BlZWQlMjBvZiUyMGxpZ2h0JTIwaXMlMjBjb25zdGFudCUyMGluJTIwYWxsJTIwaW5lcnRpYWwlMjByZWZlcmVuY2UlMjBmcmFtZXMuJTIwMy4nJTVE",highlighted:`<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoTokenizer, AutoModelForCausalLM, StaticCache
<span class="hljs-keyword">import</span> torch
<span class="hljs-keyword">import</span> os
os.environ[<span class="hljs-string">&quot;TOKENIZERS_PARALLELISM&quot;</span>] = <span class="hljs-string">&quot;false&quot;</span>  <span class="hljs-comment"># To prevent long warnings :)</span>

tokenizer = AutoTokenizer.from_pretrained(<span class="hljs-string">&quot;google/gemma-2b&quot;</span>)
model = AutoModelForCausalLM.from_pretrained(<span class="hljs-string">&quot;google/gemma-2b&quot;</span>, dtype=<span class="hljs-string">&quot;auto&quot;</span>, device_map=<span class="hljs-string">&quot;auto&quot;</span>)

model.forward = torch.<span class="hljs-built_in">compile</span>(model.forward, mode=<span class="hljs-string">&quot;reduce-overhead&quot;</span>, fullgraph=<span class="hljs-literal">True</span>)
input_text = <span class="hljs-string">&quot;The theory of special relativity states &quot;</span>
input_ids = tokenizer(input_text, return_tensors=<span class="hljs-string">&quot;pt&quot;</span>).to(model.device.<span class="hljs-built_in">type</span>)
prompt_length = input_ids.input_ids.shape[<span class="hljs-number">1</span>]
model.generation_config.max_new_tokens = <span class="hljs-number">16</span>

past_key_values = StaticCache(
    config=model.config,
    <span class="hljs-comment"># If you plan to reuse the cache, make sure the cache length is large enough for all cases</span>
    max_cache_len=prompt_length+(model.generation_config.max_new_tokens*<span class="hljs-number">2</span>),
)
outputs = model.generate(**input_ids, past_key_values=past_key_values)
<span class="hljs-built_in">print</span>(tokenizer.batch_decode(outputs, skip_special_tokens=<span class="hljs-literal">True</span>))
[<span class="hljs-string">&#x27;The theory of special relativity states 1. The speed of light is constant in all inertial reference frames. 2&#x27;</span>]

<span class="hljs-comment"># pass in the generated text and the same cache object to continue generation from where it left off. Optionally, in a</span>
<span class="hljs-comment"># multi-turn conversation, append the new user input to the generated text.</span>
new_input_ids = outputs
outputs = model.generate(new_input_ids, past_key_values=past_key_values)
<span class="hljs-built_in">print</span>(tokenizer.batch_decode(outputs, skip_special_tokens=<span class="hljs-literal">True</span>))
[<span class="hljs-string">&#x27;The theory of special relativity states 1. The speed of light is constant in all inertial reference frames. 2. The speed of light is constant in all inertial reference frames. 3.&#x27;</span>]`,wrap:!1}}),i=new K({props:{warning:!1,$$slots:{default:[dl]},$$scope:{ctx:g}}}),_=new W({props:{code:"ZnJvbSUyMHRyYW5zZm9ybWVycyUyMGltcG9ydCUyMExsYW1hVG9rZW5pemVyJTJDJTIwTGxhbWFGb3JDYXVzYWxMTSUyQyUyMFN0YXRpY0NhY2hlJTJDJTIwbG9nZ2luZyUyQyUyMGluZmVyX2RldmljZSUwQWZyb20lMjB0cmFuc2Zvcm1lcnMudGVzdGluZ191dGlscyUyMGltcG9ydCUyMENhcHR1cmVMb2dnZXIlMEFpbXBvcnQlMjB0b3JjaCUwQSUwQXByb21wdHMlMjAlM0QlMjAlNUIlMEElMjAlMjAlMjAlMjAlMjJTaW1wbHklMjBwdXQlMkMlMjB0aGUlMjB0aGVvcnklMjBvZiUyMHJlbGF0aXZpdHklMjBzdGF0ZXMlMjB0aGF0JTIwJTIyJTJDJTBBJTIwJTIwJTIwJTIwJTIyTXklMjBmYXZvcml0ZSUyMGFsbCUyMHRpbWUlMjBmYXZvcml0ZSUyMGNvbmRpbWVudCUyMGlzJTIwa2V0Y2h1cC4lMjIlMkMlMEElNUQlMEElMEFOVU1fVE9LRU5TX1RPX0dFTkVSQVRFJTIwJTNEJTIwNDAlMEF0b3JjaF9kZXZpY2UlMjAlM0QlMjBpbmZlcl9kZXZpY2UoKSUwQSUwQXRva2VuaXplciUyMCUzRCUyMExsYW1hVG9rZW5pemVyLmZyb21fcHJldHJhaW5lZCglMjJtZXRhLWxsYW1hJTJGTGxhbWEtMi03Yi1oZiUyMiUyQyUyMHBhZF90b2tlbiUzRCUyMiUzQyUyRnMlM0UlMjIlMkMlMjBwYWRkaW5nX3NpZGUlM0QlMjJyaWdodCUyMiklMEFtb2RlbCUyMCUzRCUyMExsYW1hRm9yQ2F1c2FsTE0uZnJvbV9wcmV0cmFpbmVkKCUyMm1ldGEtbGxhbWElMkZMbGFtYS0yLTdiLWhmJTIyJTJDJTIwZGV2aWNlX21hcCUzRCUyMnNlcXVlbnRpYWwlMjIpJTBBaW5wdXRzJTIwJTNEJTIwdG9rZW5pemVyKHByb21wdHMlMkMlMjByZXR1cm5fdGVuc29ycyUzRCUyMnB0JTIyJTJDJTIwcGFkZGluZyUzRFRydWUpLnRvKG1vZGVsLmRldmljZSklMEElMEFkZWYlMjBkZWNvZGVfb25lX3Rva2Vucyhtb2RlbCUyQyUyMGN1cl90b2tlbiUyQyUyMGlucHV0X3BvcyUyQyUyMGNhY2hlX3Bvc2l0aW9uJTJDJTIwcGFzdF9rZXlfdmFsdWVzKSUzQSUwQSUyMCUyMCUyMCUyMGxvZ2l0cyUyMCUzRCUyMG1vZGVsKCUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMGN1cl90b2tlbiUyQyUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMHBvc2l0aW9uX2lkcyUzRGlucHV0X3BvcyUyQyUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMGNhY2hlX3Bvc2l0aW9uJTNEY2FjaGVfcG9zaXRpb24lMkMlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjBwYXN0X2tleV92YWx1ZXMlM0RwYXN0X2tleV92YWx1ZXMlMkMlMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjByZXR1cm5fZGljdCUzREZhbHNlJTJDJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwdXNlX2NhY2hlJTNEVHJ1ZSUwQSUyMCUyMCUyMCUyMCklNUIwJTVEJTBBJTIwJTIwJTIwJTIwbmV3X3Rva2VuJTIwJTNEJTIwdG9yY2guYXJnbWF4KGxvZ2l0cyU1QiUzQSUyQyUyMC0xJTVEJTJDJTIwZGltJTNELTEpJTVCJTNBJTJDJTIwTm9uZSU1RCUwQSUyMCUyMCUyMCUyMHJldHVybiUyMG5ld190b2tlbg==",highlighted:`<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> LlamaTokenizer, LlamaForCausalLM, StaticCache, logging, infer_device
<span class="hljs-keyword">from</span> transformers.testing_utils <span class="hljs-keyword">import</span> CaptureLogger
<span class="hljs-keyword">import</span> torch

prompts = [
    <span class="hljs-string">&quot;Simply put, the theory of relativity states that &quot;</span>,
    <span class="hljs-string">&quot;My favorite all time favorite condiment is ketchup.&quot;</span>,
]

NUM_TOKENS_TO_GENERATE = <span class="hljs-number">40</span>
torch_device = infer_device()

tokenizer = LlamaTokenizer.from_pretrained(<span class="hljs-string">&quot;meta-llama/Llama-2-7b-hf&quot;</span>, pad_token=<span class="hljs-string">&quot;&lt;/s&gt;&quot;</span>, padding_side=<span class="hljs-string">&quot;right&quot;</span>)
model = LlamaForCausalLM.from_pretrained(<span class="hljs-string">&quot;meta-llama/Llama-2-7b-hf&quot;</span>, device_map=<span class="hljs-string">&quot;sequential&quot;</span>)
inputs = tokenizer(prompts, return_tensors=<span class="hljs-string">&quot;pt&quot;</span>, padding=<span class="hljs-literal">True</span>).to(model.device)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">decode_one_tokens</span>(<span class="hljs-params">model, cur_token, input_pos, cache_position, past_key_values</span>):
    logits = model(
        cur_token,
        position_ids=input_pos,
        cache_position=cache_position,
        past_key_values=past_key_values,
        return_dict=<span class="hljs-literal">False</span>,
        use_cache=<span class="hljs-literal">True</span>
    )[<span class="hljs-number">0</span>]
    new_token = torch.argmax(logits[:, -<span class="hljs-number">1</span>], dim=-<span class="hljs-number">1</span>)[:, <span class="hljs-literal">None</span>]
    <span class="hljs-keyword">return</span> new_token`,wrap:!1}}),I=new W({props:{code:"ZnJvbSUyMHRvcmNoLm5uLmF0dGVudGlvbiUyMGltcG9ydCUyMFNEUEJhY2tlbmQlMkMlMjBzZHBhX2tlcm5lbCUwQSUwQWJhdGNoX3NpemUlMkMlMjBzZXFfbGVuZ3RoJTIwJTNEJTIwaW5wdXRzJTVCJTIyaW5wdXRfaWRzJTIyJTVELnNoYXBlJTBBd2l0aCUyMHRvcmNoLm5vX2dyYWQoKSUzQSUwQSUyMCUyMCUyMCUyMHBhc3Rfa2V5X3ZhbHVlcyUyMCUzRCUyMFN0YXRpY0NhY2hlKCUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMGNvbmZpZyUzRG1vZGVsLmNvbmZpZyUyQyUyMG1heF9jYWNoZV9sZW4lM0Q0MDk2JTBBJTIwJTIwJTIwJTIwKSUwQSUyMCUyMCUyMCUyMGNhY2hlX3Bvc2l0aW9uJTIwJTNEJTIwdG9yY2guYXJhbmdlKHNlcV9sZW5ndGglMkMlMjBkZXZpY2UlM0R0b3JjaF9kZXZpY2UpJTBBJTIwJTIwJTIwJTIwZ2VuZXJhdGVkX2lkcyUyMCUzRCUyMHRvcmNoLnplcm9zKCUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMGJhdGNoX3NpemUlMkMlMjBzZXFfbGVuZ3RoJTIwJTJCJTIwTlVNX1RPS0VOU19UT19HRU5FUkFURSUyMCUyQiUyMDElMkMlMjBkdHlwZSUzRHRvcmNoLmludCUyQyUyMGRldmljZSUzRHRvcmNoX2RldmljZSUwQSUyMCUyMCUyMCUyMCklMEElMjAlMjAlMjAlMjBnZW5lcmF0ZWRfaWRzJTVCJTNBJTJDJTIwY2FjaGVfcG9zaXRpb24lNUQlMjAlM0QlMjBpbnB1dHMlNUIlMjJpbnB1dF9pZHMlMjIlNUQudG8odG9yY2hfZGV2aWNlKS50byh0b3JjaC5pbnQpJTBBJTBBJTIwJTIwJTIwJTIwbG9naXRzJTIwJTNEJTIwbW9kZWwoJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwKippbnB1dHMlMkMlMjBjYWNoZV9wb3NpdGlvbiUzRGNhY2hlX3Bvc2l0aW9uJTJDJTIwcGFzdF9rZXlfdmFsdWVzJTNEcGFzdF9rZXlfdmFsdWVzJTJDcmV0dXJuX2RpY3QlM0RGYWxzZSUyQyUyMHVzZV9jYWNoZSUzRFRydWUlMEElMjAlMjAlMjAlMjApJTVCMCU1RCUwQSUyMCUyMCUyMCUyMG5leHRfdG9rZW4lMjAlM0QlMjB0b3JjaC5hcmdtYXgobG9naXRzJTVCJTNBJTJDJTIwLTElNUQlMkMlMjBkaW0lM0QtMSklNUIlM0ElMkMlMjBOb25lJTVEJTBBJTIwJTIwJTIwJTIwZ2VuZXJhdGVkX2lkcyU1QiUzQSUyQyUyMHNlcV9sZW5ndGglNUQlMjAlM0QlMjBuZXh0X3Rva2VuJTVCJTNBJTJDJTIwMCU1RCUwQSUwQSUyMCUyMCUyMCUyMGRlY29kZV9vbmVfdG9rZW5zJTIwJTNEJTIwdG9yY2guY29tcGlsZShkZWNvZGVfb25lX3Rva2VucyUyQyUyMG1vZGUlM0QlMjJyZWR1Y2Utb3ZlcmhlYWQlMjIlMkMlMjBmdWxsZ3JhcGglM0RUcnVlKSUwQSUyMCUyMCUyMCUyMGNhY2hlX3Bvc2l0aW9uJTIwJTNEJTIwdG9yY2gudGVuc29yKCU1QnNlcV9sZW5ndGglMjAlMkIlMjAxJTVEJTJDJTIwZGV2aWNlJTNEdG9yY2hfZGV2aWNlKSUwQSUyMCUyMCUyMCUyMGZvciUyMF8lMjBpbiUyMHJhbmdlKDElMkMlMjBOVU1fVE9LRU5TX1RPX0dFTkVSQVRFKSUzQSUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMHdpdGglMjBzZHBhX2tlcm5lbChTRFBCYWNrZW5kLk1BVEgpJTNBJTBBJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwJTIwbmV4dF90b2tlbiUyMCUzRCUyMGRlY29kZV9vbmVfdG9rZW5zKG1vZGVsJTJDJTIwbmV4dF90b2tlbi5jbG9uZSgpJTJDJTIwTm9uZSUyQyUyMGNhY2hlX3Bvc2l0aW9uJTJDJTIwcGFzdF9rZXlfdmFsdWVzKSUwQSUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMCUyMGdlbmVyYXRlZF9pZHMlNUIlM0ElMkMlMjBjYWNoZV9wb3NpdGlvbiU1RCUyMCUzRCUyMG5leHRfdG9rZW4uaW50KCklMEElMjAlMjAlMjAlMjAlMjAlMjAlMjAlMjBjYWNoZV9wb3NpdGlvbiUyMCUyQiUzRCUyMDElMEElMEF0ZXh0JTIwJTNEJTIwdG9rZW5pemVyLmJhdGNoX2RlY29kZShnZW5lcmF0ZWRfaWRzJTJDJTIwc2tpcF9zcGVjaWFsX3Rva2VucyUzRFRydWUpJTBBdGV4dCUwQSU1QidTaW1wbHklMjBwdXQlMkMlMjB0aGUlMjB0aGVvcnklMjBvZiUyMHJlbGF0aXZpdHklMjBzdGF0ZXMlMjB0aGF0JTIwMSklMjB0aGUlMjBzcGVlZCUyMG9mJTIwbGlnaHQlMjBpcyUyMGNvbnN0YW50JTJDJTIwMiklMjB0aGUlMjBzcGVlZCUyMG9mJTIwbGlnaHQlMjBpcyUyMHRoZSUyMHNhbWUlMjBmb3IlMjBhbGwlMjBvYnNlcnZlcnMlMkMlMjBhbmQlMjAzKSUyMHRoZSUyMGxhd3MlMjBvZiUyMHBoeXNpY3MlMjBhcmUlMjB0aGUlMjBzYW1lJTIwZm9yJTIwYWxsJTIwb2JzZXJ2ZXJzLiclMkMlMEElMjAnTXklMjBmYXZvcml0ZSUyMGFsbCUyMHRpbWUlMjBmYXZvcml0ZSUyMGNvbmRpbWVudCUyMGlzJTIwa2V0Y2h1cC4lMjBJJTIwbG92ZSUyMGl0JTIwb24lMjBldmVyeXRoaW5nLiUyMEklMjBsb3ZlJTIwaXQlMjBvbiUyMG15JTIwZWdncyUyQyUyMG15JTIwZnJpZXMlMkMlMjBteSUyMGNoaWNrZW4lMkMlMjBteSUyMGJ1cmdlcnMlMkMlMjBteSUyMGhvdCUyMGRvZ3MlMkMlMjBteSUyMHNhbmR3aWNoZXMlMkMlMjBteSUyMHNhbGFkcyUyQyUyMG15JTIwcCclNUQ=",highlighted:`<span class="hljs-keyword">from</span> torch.nn.attention <span class="hljs-keyword">import</span> SDPBackend, sdpa_kernel

batch_size, seq_length = inputs[<span class="hljs-string">&quot;input_ids&quot;</span>].shape
<span class="hljs-keyword">with</span> torch.no_grad():
    past_key_values = StaticCache(
        config=model.config, max_cache_len=<span class="hljs-number">4096</span>
    )
    cache_position = torch.arange(seq_length, device=torch_device)
    generated_ids = torch.zeros(
        batch_size, seq_length + NUM_TOKENS_TO_GENERATE + <span class="hljs-number">1</span>, dtype=torch.<span class="hljs-built_in">int</span>, device=torch_device
    )
    generated_ids[:, cache_position] = inputs[<span class="hljs-string">&quot;input_ids&quot;</span>].to(torch_device).to(torch.<span class="hljs-built_in">int</span>)

    logits = model(
        **inputs, cache_position=cache_position, past_key_values=past_key_values,return_dict=<span class="hljs-literal">False</span>, use_cache=<span class="hljs-literal">True</span>
    )[<span class="hljs-number">0</span>]
    next_token = torch.argmax(logits[:, -<span class="hljs-number">1</span>], dim=-<span class="hljs-number">1</span>)[:, <span class="hljs-literal">None</span>]
    generated_ids[:, seq_length] = next_token[:, <span class="hljs-number">0</span>]

    decode_one_tokens = torch.<span class="hljs-built_in">compile</span>(decode_one_tokens, mode=<span class="hljs-string">&quot;reduce-overhead&quot;</span>, fullgraph=<span class="hljs-literal">True</span>)
    cache_position = torch.tensor([seq_length + <span class="hljs-number">1</span>], device=torch_device)
    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, NUM_TOKENS_TO_GENERATE):
        <span class="hljs-keyword">with</span> sdpa_kernel(SDPBackend.MATH):
            next_token = decode_one_tokens(model, next_token.clone(), <span class="hljs-literal">None</span>, cache_position, past_key_values)
            generated_ids[:, cache_position] = next_token.<span class="hljs-built_in">int</span>()
        cache_position += <span class="hljs-number">1</span>

text = tokenizer.batch_decode(generated_ids, skip_special_tokens=<span class="hljs-literal">True</span>)
text
[<span class="hljs-string">&#x27;Simply put, the theory of relativity states that 1) the speed of light is constant, 2) the speed of light is the same for all observers, and 3) the laws of physics are the same for all observers.&#x27;</span>,
 <span class="hljs-string">&#x27;My favorite all time favorite condiment is ketchup. I love it on everything. I love it on my eggs, my fries, my chicken, my burgers, my hot dogs, my sandwiches, my salads, my p&#x27;</span>]`,wrap:!1}}),{c(){t=h("p"),t.innerHTML=m,s=p(),T(r.$$.fragment),o=p(),T(i.$$.fragment),M=p(),Z=h("p"),Z.innerHTML=G,k=p(),T(_.$$.fragment),d=p(),v=h("p"),v.innerHTML=$e,F=p(),$=h("ol"),$.innerHTML=D,R=p(),T(I.$$.fragment)},l(u){t=y(u,"P",{"data-svelte-h":!0}),f(t)!=="svelte-1ep2if6"&&(t.innerHTML=m),s=c(u),J(r.$$.fragment,u),o=c(u),J(i.$$.fragment,u),M=c(u),Z=y(u,"P",{"data-svelte-h":!0}),f(Z)!=="svelte-t63m1j"&&(Z.innerHTML=G),k=c(u),J(_.$$.fragment,u),d=c(u),v=y(u,"P",{"data-svelte-h":!0}),f(v)!=="svelte-94ddcu"&&(v.innerHTML=$e),F=c(u),$=y(u,"OL",{"data-svelte-h":!0}),f($)!=="svelte-5voou4"&&($.innerHTML=D),R=c(u),J(I.$$.fragment,u)},m(u,C){n(u,t,C),n(u,s,C),w(r,u,C),n(u,o,C),w(i,u,C),n(u,M,C),n(u,Z,C),n(u,k,C),w(_,u,C),n(u,d,C),n(u,v,C),n(u,F,C),n(u,$,C),n(u,R,C),w(I,u,C),V=!0},p(u,C){const X={};C&2&&(X.$$scope={dirty:C,ctx:u}),i.$set(X)},i(u){V||(b(r.$$.fragment,u),b(i.$$.fragment,u),b(_.$$.fragment,u),b(I.$$.fragment,u),V=!0)},o(u){U(r.$$.fragment,u),U(i.$$.fragment,u),U(_.$$.fragment,u),U(I.$$.fragment,u),V=!1},d(u){u&&(a(t),a(s),a(o),a(M),a(Z),a(k),a(d),a(v),a(F),a($),a(R)),j(r,u),j(i,u),j(_,u),j(I,u)}}}function hl(g){let t,m='Compiling the entire <a href="/docs/transformers/v4.56.2/en/main_classes/text_generation#transformers.GenerationMixin.generate">generate()</a> function also compiles the input preparation logit processor operations, and more, in addition to the forward pass. With this approach, you don‚Äôt need to initialize <a href="/docs/transformers/v4.56.2/en/internal/generation_utils#transformers.StaticCache">StaticCache</a> or set the <a href="https://hf.co/docs/transformers/main_classes/text_generation#transformers.GenerationConfig.cache_implementation" rel="nofollow">cache_implementation</a> parameter.',s,r,o,i,M="This usage pattern is more appropriate for unique hardware or use cases, but there are several drawbacks to consider.",Z,G,k='<li>Compilation is much slower.</li> <li>Parameters must be configured through <a href="/docs/transformers/v4.56.2/en/main_classes/text_generation#transformers.GenerationConfig">GenerationConfig</a>.</li> <li>Many warnings and exceptions are suppressed. We recommend testing the uncompiled model first.</li> <li>Many features are unavailable at the moment. For example, generation does not stop if an <code>EOS</code> token is selected.</li>',_;return r=new W({props:{code:"ZnJvbSUyMHRyYW5zZm9ybWVycyUyMGltcG9ydCUyMEF1dG9Ub2tlbml6ZXIlMkMlMjBBdXRvTW9kZWxGb3JDYXVzYWxMTSUwQWltcG9ydCUyMHRvcmNoJTBBaW1wb3J0JTIwb3MlMEFvcy5lbnZpcm9uJTVCJTIyVE9LRU5JWkVSU19QQVJBTExFTElTTSUyMiU1RCUyMCUzRCUyMCUyMmZhbHNlJTIyJTIwJTIwJTIzJTIwVG8lMjBwcmV2ZW50JTIwbG9uZyUyMHdhcm5pbmdzJTIwJTNBKSUwQSUwQXRva2VuaXplciUyMCUzRCUyMEF1dG9Ub2tlbml6ZXIuZnJvbV9wcmV0cmFpbmVkKCUyMmdvb2dsZSUyRmdlbW1hLTJiJTIyKSUwQW1vZGVsJTIwJTNEJTIwQXV0b01vZGVsRm9yQ2F1c2FsTE0uZnJvbV9wcmV0cmFpbmVkKCUyMmdvb2dsZSUyRmdlbW1hLTJiJTIyJTJDJTIwZHR5cGUlM0QlMjJhdXRvJTIyJTJDJTIwZGV2aWNlX21hcCUzRCUyMmF1dG8lMjIpJTBBJTBBbW9kZWwuZ2VuZXJhdGUlMjAlM0QlMjB0b3JjaC5jb21waWxlKG1vZGVsLmdlbmVyYXRlJTJDJTIwbW9kZSUzRCUyMnJlZHVjZS1vdmVyaGVhZCUyMiUyQyUyMGZ1bGxncmFwaCUzRFRydWUpJTBBaW5wdXRfdGV4dCUyMCUzRCUyMCUyMlRoZSUyMHRoZW9yeSUyMG9mJTIwc3BlY2lhbCUyMHJlbGF0aXZpdHklMjBzdGF0ZXMlMjAlMjIlMEFpbnB1dF9pZHMlMjAlM0QlMjB0b2tlbml6ZXIoaW5wdXRfdGV4dCUyQyUyMHJldHVybl90ZW5zb3JzJTNEJTIycHQlMjIpLnRvKG1vZGVsLmRldmljZS50eXBlKSUwQSUwQW91dHB1dHMlMjAlM0QlMjBtb2RlbC5nZW5lcmF0ZSgqKmlucHV0X2lkcyklMEFwcmludCh0b2tlbml6ZXIuYmF0Y2hfZGVjb2RlKG91dHB1dHMlMkMlMjBza2lwX3NwZWNpYWxfdG9rZW5zJTNEVHJ1ZSkpJTBBJTVCJ1RoZSUyMHRoZW9yeSUyMG9mJTIwc3BlY2lhbCUyMHJlbGF0aXZpdHklMjBzdGF0ZXMlMjAxLiUyMFRoZSUyMHNwZWVkJTIwb2YlMjBsaWdodCUyMGlzJTIwY29uc3RhbnQlMjBpbiUyMGFsbCUyMGluZXJ0aWFsJTIwcmVmZXJlbmNlJyU1RA==",highlighted:`<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoTokenizer, AutoModelForCausalLM
<span class="hljs-keyword">import</span> torch
<span class="hljs-keyword">import</span> os
os.environ[<span class="hljs-string">&quot;TOKENIZERS_PARALLELISM&quot;</span>] = <span class="hljs-string">&quot;false&quot;</span>  <span class="hljs-comment"># To prevent long warnings :)</span>

tokenizer = AutoTokenizer.from_pretrained(<span class="hljs-string">&quot;google/gemma-2b&quot;</span>)
model = AutoModelForCausalLM.from_pretrained(<span class="hljs-string">&quot;google/gemma-2b&quot;</span>, dtype=<span class="hljs-string">&quot;auto&quot;</span>, device_map=<span class="hljs-string">&quot;auto&quot;</span>)

model.generate = torch.<span class="hljs-built_in">compile</span>(model.generate, mode=<span class="hljs-string">&quot;reduce-overhead&quot;</span>, fullgraph=<span class="hljs-literal">True</span>)
input_text = <span class="hljs-string">&quot;The theory of special relativity states &quot;</span>
input_ids = tokenizer(input_text, return_tensors=<span class="hljs-string">&quot;pt&quot;</span>).to(model.device.<span class="hljs-built_in">type</span>)

outputs = model.generate(**input_ids)
<span class="hljs-built_in">print</span>(tokenizer.batch_decode(outputs, skip_special_tokens=<span class="hljs-literal">True</span>))
[<span class="hljs-string">&#x27;The theory of special relativity states 1. The speed of light is constant in all inertial reference&#x27;</span>]`,wrap:!1}}),{c(){t=h("p"),t.innerHTML=m,s=p(),T(r.$$.fragment),o=p(),i=h("p"),i.textContent=M,Z=p(),G=h("ol"),G.innerHTML=k},l(d){t=y(d,"P",{"data-svelte-h":!0}),f(t)!=="svelte-g9on7z"&&(t.innerHTML=m),s=c(d),J(r.$$.fragment,d),o=c(d),i=y(d,"P",{"data-svelte-h":!0}),f(i)!=="svelte-3z6n1l"&&(i.textContent=M),Z=c(d),G=y(d,"OL",{"data-svelte-h":!0}),f(G)!=="svelte-o6xzg8"&&(G.innerHTML=k)},m(d,v){n(d,t,v),n(d,s,v),w(r,d,v),n(d,o,v),n(d,i,v),n(d,Z,v),n(d,G,v),_=!0},p:B,i(d){_||(b(r.$$.fragment,d),_=!0)},o(d){U(r.$$.fragment,d),_=!1},d(d){d&&(a(t),a(s),a(o),a(i),a(Z),a(G)),j(r,d)}}}function yl(g){let t,m,s,r,o,i;return t=new Ce({props:{id:"static-kv",option:"1. cache_implementation",$$slots:{default:[Ml]},$$scope:{ctx:g}}}),s=new Ce({props:{id:"static-kv",option:"2. StaticCache",$$slots:{default:[ul]},$$scope:{ctx:g}}}),o=new Ce({props:{id:"static-kv",option:"3. compile entire generate function",$$slots:{default:[hl]},$$scope:{ctx:g}}}),{c(){T(t.$$.fragment),m=p(),T(s.$$.fragment),r=p(),T(o.$$.fragment)},l(M){J(t.$$.fragment,M),m=c(M),J(s.$$.fragment,M),r=c(M),J(o.$$.fragment,M)},m(M,Z){w(t,M,Z),n(M,m,Z),w(s,M,Z),n(M,r,Z),w(o,M,Z),i=!0},p(M,Z){const G={};Z&2&&(G.$$scope={dirty:Z,ctx:M}),t.$set(G);const k={};Z&2&&(k.$$scope={dirty:Z,ctx:M}),s.$set(k);const _={};Z&2&&(_.$$scope={dirty:Z,ctx:M}),o.$set(_)},i(M){i||(b(t.$$.fragment,M),b(s.$$.fragment,M),b(o.$$.fragment,M),i=!0)},o(M){U(t.$$.fragment,M),U(s.$$.fragment,M),U(o.$$.fragment,M),i=!1},d(M){M&&(a(m),a(r)),j(t,M),j(s,M),j(o,M)}}}function fl(g){let t,m='For a more in-depth explanation, take a look at the <a href="https://hf.co/blog/assisted-generation" rel="nofollow">Assisted Generation: a new direction toward low-latency text generation</a> blog post!';return{c(){t=h("p"),t.innerHTML=m},l(s){t=y(s,"P",{"data-svelte-h":!0}),f(t)!=="svelte-112w74b"&&(t.innerHTML=m)},m(s,r){n(s,t,r)},p:B,d(s){s&&a(t)}}}function Tl(g){let t,m="Speculative decoding is only supported for the greedy search and sampling decoding strategies, and it doesn‚Äôt support batched inputs.";return{c(){t=h("p"),t.textContent=m},l(s){t=y(s,"P",{"data-svelte-h":!0}),f(t)!=="svelte-1wfld0h"&&(t.textContent=m)},m(s,r){n(s,t,r)},p:B,d(s){s&&a(t)}}}function Jl(g){let t,m;return t=new W({props:{code:"ZnJvbSUyMHRyYW5zZm9ybWVycyUyMGltcG9ydCUyMEF1dG9Nb2RlbEZvckNhdXNhbExNJTJDJTIwQXV0b1Rva2VuaXplciUyQyUyMGluZmVyX2RldmljZSUwQWltcG9ydCUyMHRvcmNoJTBBJTBBZGV2aWNlJTIwJTNEJTIwaW5mZXJfZGV2aWNlKCklMEElMEF0b2tlbml6ZXIlMjAlM0QlMjBBdXRvVG9rZW5pemVyLmZyb21fcHJldHJhaW5lZCglMjJmYWNlYm9vayUyRm9wdC0xLjNiJTIyKSUwQWlucHV0cyUyMCUzRCUyMHRva2VuaXplciglMjJFaW5zdGVpbidzJTIwdGhlb3J5JTIwb2YlMjByZWxhdGl2aXR5JTIwc3RhdGVzJTIyJTJDJTIwcmV0dXJuX3RlbnNvcnMlM0QlMjJwdCUyMikudG8oZGV2aWNlKSUwQSUwQW1vZGVsJTIwJTNEJTIwQXV0b01vZGVsRm9yQ2F1c2FsTE0uZnJvbV9wcmV0cmFpbmVkKCUyMmZhY2Vib29rJTJGb3B0LTEuM2IlMjIlMkMlMjBkdHlwZSUzRCUyMmF1dG8lMjIpLnRvKGRldmljZSklMEFhc3Npc3RhbnRfbW9kZWwlMjAlM0QlMjBBdXRvTW9kZWxGb3JDYXVzYWxMTS5mcm9tX3ByZXRyYWluZWQoJTIyZmFjZWJvb2slMkZvcHQtMTI1bSUyMikudG8oZGV2aWNlKSUwQW91dHB1dHMlMjAlM0QlMjBtb2RlbC5nZW5lcmF0ZSgqKmlucHV0cyUyQyUyMGFzc2lzdGFudF9tb2RlbCUzRGFzc2lzdGFudF9tb2RlbCklMEF0b2tlbml6ZXIuYmF0Y2hfZGVjb2RlKG91dHB1dHMlMkMlMjBza2lwX3NwZWNpYWxfdG9rZW5zJTNEVHJ1ZSklMEElNUIlMjJFaW5zdGVpbidzJTIwdGhlb3J5JTIwb2YlMjByZWxhdGl2aXR5JTIwc3RhdGVzJTIwdGhhdCUyMHRoZSUyMHNwZWVkJTIwb2YlMjBsaWdodCUyMGlzJTIwY29uc3RhbnQuJTIwJTIwJTIwJTIwJTIyJTVE",highlighted:`<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoModelForCausalLM, AutoTokenizer, infer_device
<span class="hljs-keyword">import</span> torch

device = infer_device()

tokenizer = AutoTokenizer.from_pretrained(<span class="hljs-string">&quot;facebook/opt-1.3b&quot;</span>)
inputs = tokenizer(<span class="hljs-string">&quot;Einstein&#x27;s theory of relativity states&quot;</span>, return_tensors=<span class="hljs-string">&quot;pt&quot;</span>).to(device)

model = AutoModelForCausalLM.from_pretrained(<span class="hljs-string">&quot;facebook/opt-1.3b&quot;</span>, dtype=<span class="hljs-string">&quot;auto&quot;</span>).to(device)
assistant_model = AutoModelForCausalLM.from_pretrained(<span class="hljs-string">&quot;facebook/opt-125m&quot;</span>).to(device)
outputs = model.generate(**inputs, assistant_model=assistant_model)
tokenizer.batch_decode(outputs, skip_special_tokens=<span class="hljs-literal">True</span>)
[<span class="hljs-string">&quot;Einstein&#x27;s theory of relativity states that the speed of light is constant.    &quot;</span>]`,wrap:!1}}),{c(){T(t.$$.fragment)},l(s){J(t.$$.fragment,s)},m(s,r){w(t,s,r),m=!0},p:B,i(s){m||(b(t.$$.fragment,s),m=!0)},o(s){U(t.$$.fragment,s),m=!1},d(s){j(t,s)}}}function wl(g){let t,m='For speculative sampling decoding, add the <a href="https://hf.co/docs/transformers/main/en/main_classes/text_generation#transformers.GenerationConfig.do_sample" rel="nofollow">do_sample</a> and <a href="https://hf.co/docs/transformers/main/en/main_classes/text_generation#transformers.GenerationConfig.temperature" rel="nofollow">temperature</a> parameters to <a href="/docs/transformers/v4.56.2/en/main_classes/text_generation#transformers.GenerationMixin.generate">generate()</a>.',s,r,o;return r=new W({props:{code:"ZnJvbSUyMHRyYW5zZm9ybWVycyUyMGltcG9ydCUyMEF1dG9Nb2RlbEZvckNhdXNhbExNJTJDJTIwQXV0b1Rva2VuaXplciUyQyUyMGluZmVyX2RldmljZSUwQWltcG9ydCUyMHRvcmNoJTBBJTBBZGV2aWNlJTIwJTNEJTIwaW5mZXJfZGV2aWNlKCklMEElMEF0b2tlbml6ZXIlMjAlM0QlMjBBdXRvVG9rZW5pemVyLmZyb21fcHJldHJhaW5lZCglMjJmYWNlYm9vayUyRm9wdC0xLjNiJTIyKSUwQWlucHV0cyUyMCUzRCUyMHRva2VuaXplciglMjJFaW5zdGVpbidzJTIwdGhlb3J5JTIwb2YlMjByZWxhdGl2aXR5JTIwc3RhdGVzJTIyJTJDJTIwcmV0dXJuX3RlbnNvcnMlM0QlMjJwdCUyMikudG8oZGV2aWNlKSUwQSUwQW1vZGVsJTIwJTNEJTIwQXV0b01vZGVsRm9yQ2F1c2FsTE0uZnJvbV9wcmV0cmFpbmVkKCUyMmZhY2Vib29rJTJGb3B0LTEuM2IlMjIlMkMlMjBkdHlwZSUzRCUyMmF1dG8lMjIpLnRvKGRldmljZSklMEFhc3Npc3RhbnRfbW9kZWwlMjAlM0QlMjBBdXRvTW9kZWxGb3JDYXVzYWxMTS5mcm9tX3ByZXRyYWluZWQoJTIyZmFjZWJvb2slMkZvcHQtMTI1bSUyMikudG8oZGV2aWNlKSUwQW91dHB1dHMlMjAlM0QlMjBtb2RlbC5nZW5lcmF0ZSgqKmlucHV0cyUyQyUyMGFzc2lzdGFudF9tb2RlbCUzRGFzc2lzdGFudF9tb2RlbCUyQyUyMGRvX3NhbXBsZSUzRFRydWUlMkMlMjB0ZW1wZXJhdHVyZSUzRDAuNyklMEFwcmludCh0b2tlbml6ZXIuYmF0Y2hfZGVjb2RlKG91dHB1dHMlMkMlMjBza2lwX3NwZWNpYWxfdG9rZW5zJTNEVHJ1ZSkpJTBBJTVCJTIyRWluc3RlaW4ncyUyMHRoZW9yeSUyMG9mJTIwcmVsYXRpdml0eSUyMHN0YXRlcyUyMHRoYXQlMjBtb3Rpb24lMjBpbiUyMHRoZSUyMHVuaXZlcnNlJTIwaXMlMjBub3QlMjBhJTIwc3RyYWlnaHQlMjBsaW5lLiU1Q24lMjIlNUQ=",highlighted:`<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoModelForCausalLM, AutoTokenizer, infer_device
<span class="hljs-keyword">import</span> torch

device = infer_device()

tokenizer = AutoTokenizer.from_pretrained(<span class="hljs-string">&quot;facebook/opt-1.3b&quot;</span>)
inputs = tokenizer(<span class="hljs-string">&quot;Einstein&#x27;s theory of relativity states&quot;</span>, return_tensors=<span class="hljs-string">&quot;pt&quot;</span>).to(device)

model = AutoModelForCausalLM.from_pretrained(<span class="hljs-string">&quot;facebook/opt-1.3b&quot;</span>, dtype=<span class="hljs-string">&quot;auto&quot;</span>).to(device)
assistant_model = AutoModelForCausalLM.from_pretrained(<span class="hljs-string">&quot;facebook/opt-125m&quot;</span>).to(device)
outputs = model.generate(**inputs, assistant_model=assistant_model, do_sample=<span class="hljs-literal">True</span>, temperature=<span class="hljs-number">0.7</span>)
<span class="hljs-built_in">print</span>(tokenizer.batch_decode(outputs, skip_special_tokens=<span class="hljs-literal">True</span>))
[<span class="hljs-string">&quot;Einstein&#x27;s theory of relativity states that motion in the universe is not a straight line.\\n&quot;</span>]`,wrap:!1}}),{c(){t=h("p"),t.innerHTML=m,s=p(),T(r.$$.fragment)},l(i){t=y(i,"P",{"data-svelte-h":!0}),f(t)!=="svelte-zog493"&&(t.innerHTML=m),s=c(i),J(r.$$.fragment,i)},m(i,M){n(i,t,M),n(i,s,M),w(r,i,M),o=!0},p:B,i(i){o||(b(r.$$.fragment,i),o=!0)},o(i){U(r.$$.fragment,i),o=!1},d(i){i&&(a(t),a(s)),j(r,i)}}}function bl(g){let t,m,s,r;return t=new Ce({props:{id:"spec-decoding",option:"greedy search",$$slots:{default:[Jl]},$$scope:{ctx:g}}}),s=new Ce({props:{id:"spec-decoding",option:"sampling",$$slots:{default:[wl]},$$scope:{ctx:g}}}),{c(){T(t.$$.fragment),m=p(),T(s.$$.fragment)},l(o){J(t.$$.fragment,o),m=c(o),J(s.$$.fragment,o)},m(o,i){w(t,o,i),n(o,m,i),w(s,o,i),r=!0},p(o,i){const M={};i&2&&(M.$$scope={dirty:i,ctx:o}),t.$set(M);const Z={};i&2&&(Z.$$scope={dirty:i,ctx:o}),s.$set(Z)},i(o){r||(b(t.$$.fragment,o),b(s.$$.fragment,o),r=!0)},o(o){U(t.$$.fragment,o),U(s.$$.fragment,o),r=!1},d(o){o&&a(m),j(t,o),j(s,o)}}}function Ul(g){let t,m;return t=new W({props:{code:"ZnJvbSUyMHRyYW5zZm9ybWVycyUyMGltcG9ydCUyMEF1dG9Nb2RlbEZvckNhdXNhbExNJTJDJTIwQXV0b1Rva2VuaXplciUyQyUyMGluZmVyX2RldmljZSUwQWltcG9ydCUyMHRvcmNoJTBBJTBBZGV2aWNlJTIwJTNEJTIwaW5mZXJfZGV2aWNlKCklMEElMEF0b2tlbml6ZXIlMjAlM0QlMjBBdXRvVG9rZW5pemVyLmZyb21fcHJldHJhaW5lZCglMjJmYWNlYm9vayUyRm9wdC0xLjNiJTIyKSUwQWlucHV0cyUyMCUzRCUyMHRva2VuaXplciglMjJUaGUlMjBzZWNvbmQlMjBsYXclMjBvZiUyMHRoZXJtb2R5bmFtaWNzJTIwc3RhdGVzJTIyJTJDJTIwcmV0dXJuX3RlbnNvcnMlM0QlMjJwdCUyMikudG8oZGV2aWNlKSUwQSUwQW1vZGVsJTIwJTNEJTIwQXV0b01vZGVsRm9yQ2F1c2FsTE0uZnJvbV9wcmV0cmFpbmVkKCUyMmZhY2Vib29rJTJGb3B0LTEuM2IlMjIlMkMlMjBkdHlwZSUzRCUyMmF1dG8lMjIpLnRvKGRldmljZSklMEFhc3Npc3RhbnRfbW9kZWwlMjAlM0QlMjBBdXRvTW9kZWxGb3JDYXVzYWxMTS5mcm9tX3ByZXRyYWluZWQoJTIyZmFjZWJvb2slMkZvcHQtMTI1bSUyMikudG8oZGV2aWNlKSUwQW91dHB1dHMlMjAlM0QlMjBtb2RlbC5nZW5lcmF0ZSgqKmlucHV0cyUyQyUyMHByb21wdF9sb29rdXBfbnVtX3Rva2VucyUzRDMpJTBBcHJpbnQodG9rZW5pemVyLmJhdGNoX2RlY29kZShvdXRwdXRzJTJDJTIwc2tpcF9zcGVjaWFsX3Rva2VucyUzRFRydWUpKSUwQSU1QidUaGUlMjBzZWNvbmQlMjBsYXclMjBvZiUyMHRoZXJtb2R5bmFtaWNzJTIwc3RhdGVzJTIwdGhhdCUyMGVudHJvcHklMjBpbmNyZWFzZXMlMjB3aXRoJTIwdGVtcGVyYXR1cmUuJTIwJTIwJTIwJTIwJTIwJTIwJyU1RA==",highlighted:`<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoModelForCausalLM, AutoTokenizer, infer_device
<span class="hljs-keyword">import</span> torch

device = infer_device()

tokenizer = AutoTokenizer.from_pretrained(<span class="hljs-string">&quot;facebook/opt-1.3b&quot;</span>)
inputs = tokenizer(<span class="hljs-string">&quot;The second law of thermodynamics states&quot;</span>, return_tensors=<span class="hljs-string">&quot;pt&quot;</span>).to(device)

model = AutoModelForCausalLM.from_pretrained(<span class="hljs-string">&quot;facebook/opt-1.3b&quot;</span>, dtype=<span class="hljs-string">&quot;auto&quot;</span>).to(device)
assistant_model = AutoModelForCausalLM.from_pretrained(<span class="hljs-string">&quot;facebook/opt-125m&quot;</span>).to(device)
outputs = model.generate(**inputs, prompt_lookup_num_tokens=<span class="hljs-number">3</span>)
<span class="hljs-built_in">print</span>(tokenizer.batch_decode(outputs, skip_special_tokens=<span class="hljs-literal">True</span>))
[<span class="hljs-string">&#x27;The second law of thermodynamics states that entropy increases with temperature.      &#x27;</span>]`,wrap:!1}}),{c(){T(t.$$.fragment)},l(s){J(t.$$.fragment,s)},m(s,r){w(t,s,r),m=!0},p:B,i(s){m||(b(t.$$.fragment,s),m=!0)},o(s){U(t.$$.fragment,s),m=!1},d(s){j(t,s)}}}function jl(g){let t,m='For prompt lookup decoding with sampling, add the <a href="https://hf.co/docs/transformers/main/en/main_classes/text_generation#transformers.GenerationConfig.do_sample" rel="nofollow">do_sample</a> and <a href="https://hf.co/docs/transformers/main/en/main_classes/text_generation#transformers.GenerationConfig.temperature" rel="nofollow">temperature</a> parameters to <a href="/docs/transformers/v4.56.2/en/main_classes/text_generation#transformers.GenerationMixin.generate">generate()</a>.',s,r,o;return r=new W({props:{code:"ZnJvbSUyMHRyYW5zZm9ybWVycyUyMGltcG9ydCUyMEF1dG9Nb2RlbEZvckNhdXNhbExNJTJDJTIwQXV0b1Rva2VuaXplciUyQyUyMGluZmVyX2RldmljZSUwQWltcG9ydCUyMHRvcmNoJTBBJTBBZGV2aWNlJTIwJTNEJTIwaW5mZXJfZGV2aWNlKCklMEElMEF0b2tlbml6ZXIlMjAlM0QlMjBBdXRvVG9rZW5pemVyLmZyb21fcHJldHJhaW5lZCglMjJmYWNlYm9vayUyRm9wdC0xLjNiJTIyKSUwQWlucHV0cyUyMCUzRCUyMHRva2VuaXplciglMjJUaGUlMjBzZWNvbmQlMjBsYXclMjBvZiUyMHRoZXJtb2R5bmFtaWNzJTIwc3RhdGVzJTIyJTJDJTIwcmV0dXJuX3RlbnNvcnMlM0QlMjJwdCUyMikudG8oZGV2aWNlKSUwQSUwQW1vZGVsJTIwJTNEJTIwQXV0b01vZGVsRm9yQ2F1c2FsTE0uZnJvbV9wcmV0cmFpbmVkKCUyMmZhY2Vib29rJTJGb3B0LTEuM2IlMjIlMkMlMjBkdHlwZSUzRCUyMmF1dG8lMjIpLnRvKGRldmljZSklMEFvdXRwdXRzJTIwJTNEJTIwbW9kZWwuZ2VuZXJhdGUoKippbnB1dHMlMkMlMjBwcm9tcHRfbG9va3VwX251bV90b2tlbnMlM0QzJTJDJTIwZG9fc2FtcGxlJTNEVHJ1ZSUyQyUyMHRlbXBlcmF0dXJlJTNEMC43KSUwQXByaW50KHRva2VuaXplci5iYXRjaF9kZWNvZGUob3V0cHV0cyUyQyUyMHNraXBfc3BlY2lhbF90b2tlbnMlM0RUcnVlKSklMEElNUIlMjJUaGUlMjBzZWNvbmQlMjBsYXclMjBvZiUyMHRoZXJtb2R5bmFtaWNzJTIwc3RhdGVzJTIwdGhhdCUyMGVuZXJneSUyMGNhbm5vdCUyMGJlJTIwY3JlYXRlZCUyMG5vciUyMGRlc3Ryb3llZC4lMjBJdCdzJTIwbm90JTIwYSUyMiU1RA==",highlighted:`<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoModelForCausalLM, AutoTokenizer, infer_device
<span class="hljs-keyword">import</span> torch

device = infer_device()

tokenizer = AutoTokenizer.from_pretrained(<span class="hljs-string">&quot;facebook/opt-1.3b&quot;</span>)
inputs = tokenizer(<span class="hljs-string">&quot;The second law of thermodynamics states&quot;</span>, return_tensors=<span class="hljs-string">&quot;pt&quot;</span>).to(device)

model = AutoModelForCausalLM.from_pretrained(<span class="hljs-string">&quot;facebook/opt-1.3b&quot;</span>, dtype=<span class="hljs-string">&quot;auto&quot;</span>).to(device)
outputs = model.generate(**inputs, prompt_lookup_num_tokens=<span class="hljs-number">3</span>, do_sample=<span class="hljs-literal">True</span>, temperature=<span class="hljs-number">0.7</span>)
<span class="hljs-built_in">print</span>(tokenizer.batch_decode(outputs, skip_special_tokens=<span class="hljs-literal">True</span>))
[<span class="hljs-string">&quot;The second law of thermodynamics states that energy cannot be created nor destroyed. It&#x27;s not a&quot;</span>]`,wrap:!1}}),{c(){t=h("p"),t.innerHTML=m,s=p(),T(r.$$.fragment)},l(i){t=y(i,"P",{"data-svelte-h":!0}),f(t)!=="svelte-1u2ty8w"&&(t.innerHTML=m),s=c(i),J(r.$$.fragment,i)},m(i,M){n(i,t,M),n(i,s,M),w(r,i,M),o=!0},p:B,i(i){o||(b(r.$$.fragment,i),o=!0)},o(i){U(r.$$.fragment,i),o=!1},d(i){i&&(a(t),a(s)),j(r,i)}}}function Zl(g){let t,m,s,r;return t=new Ce({props:{id:"pld",option:"greedy decoding",$$slots:{default:[Ul]},$$scope:{ctx:g}}}),s=new Ce({props:{id:"pld",option:"sampling",$$slots:{default:[jl]},$$scope:{ctx:g}}}),{c(){T(t.$$.fragment),m=p(),T(s.$$.fragment)},l(o){J(t.$$.fragment,o),m=c(o),J(s.$$.fragment,o)},m(o,i){w(t,o,i),n(o,m,i),w(s,o,i),r=!0},p(o,i){const M={};i&2&&(M.$$scope={dirty:i,ctx:o}),t.$set(M);const Z={};i&2&&(Z.$$scope={dirty:i,ctx:o}),s.$set(Z)},i(o){r||(b(t.$$.fragment,o),b(s.$$.fragment,o),r=!0)},o(o){U(t.$$.fragment,o),U(s.$$.fragment,o),r=!1},d(o){o&&a(m),j(t,o),j(s,o)}}}function gl(g){let t,m="SDPA automatically supports FlashAttention-2 as long as you have the latest PyTorch version installed.";return{c(){t=h("p"),t.textContent=m},l(s){t=y(s,"P",{"data-svelte-h":!0}),f(t)!=="svelte-1dprjxm"&&(t.textContent=m)},m(s,r){n(s,t,r)},p:B,d(s){s&&a(t)}}}function vl(g){let t,m='There are many quantization libraries (see the <a href="./quantization">Quantization</a> guide for more details) available, such as Quanto, AQLM, VPTQ, AWQ, and AutoGPTQ. Feel free to try them out and see which one works best for your use case. We also recommend reading the <a href="https://hf.co/blog/overview-quantization-transformers" rel="nofollow">Overview of natively supported quantization schemes in ü§ó Transformers</a> blog post which compares AutoGPTQ and bitsandbytes.';return{c(){t=h("p"),t.innerHTML=m},l(s){t=y(s,"P",{"data-svelte-h":!0}),f(t)!=="svelte-p1oqjt"&&(t.innerHTML=m)},m(s,r){n(s,t,r)},p:B,d(s){s&&a(t)}}}function Gl(g){let t,m,s,r,o,i,M,Z='Inference with large language models (LLMs) can be challenging because they have to store and handle billions of parameters. To load a 70B parameter <a href="https://hf.co/meta-llama/Llama-2-70b-hf" rel="nofollow">Llama 2</a> model, it requires 256GB of memory for full precision weights and 128GB of memory for half-precision weights. The most powerful GPUs today - the A100 and H100 - only have 80GB of memory.',G,k,_="On top of the memory requirements, inference is slow because LLMs are called repeatedly to generate the next token. The input sequence increases as generation progresses, which takes longer and longer to process.",d,v,$e="This guide will show you how to optimize LLM inference to accelerate generation and reduce memory usage.",F,$,D,R,I,V,u="LLMs compute key-value (kv) values for each input token, and it performs the same kv computation each time because the generated output becomes part of the input. However, performing the same kv computation every time is not very efficient.",C,X,Zt='A <em>kv-cache</em> stores the past keys and values instead of recomputing them each time. As a result, the kv-cache is dynamic and it grows with each generation step which prevents you from taking advantage of <a href="./perf_torch_compile">torch.compile</a>, a powerful optimization method that fuses PyTorch code into optimized kernels.',We,P,gt='The <em>static kv-cache</em> solves this issue by pre-allocating the kv-cache size to a maximum value, so you can combine it with <a href="./perf_torch_compile">torch.compile</a> for up to a 4x speed up. Your speed up may vary depending on the model size (larger models have a smaller speed up) and hardware.',Re,N,Ie,O,vt="Depending on your task, there are several ways you can use the static kv-cache.",Ve,ee,Gt='<li>For basic use cases, set <a href="https://hf.co/docs/transformers/main_classes/text_generation#transformers.GenerationConfig.cache_implementation" rel="nofollow">cache_implementation</a> to <code>&quot;static&quot;</code> (recommended).</li> <li>For multi-turn generation or a custom generation loop, initialize and handle <a href="/docs/transformers/v4.56.2/en/internal/generation_utils#transformers.StaticCache">StaticCache</a> directly.</li> <li>For more unique hardware or use cases, it may be better to compile the entire <a href="/docs/transformers/v4.56.2/en/main_classes/text_generation#transformers.GenerationMixin.generate">generate()</a> function into a single graph.</li>',Xe,Q,ze,S,Fe,te,He,le,_t="Decoding can also be optimized to accelerate generation. You can use a lightweight assistant model to generate candidate tokens faster than the LLM itself or you can use a variant of this decoding strategy that works especially well for input-grounded tasks.",Ne,se,Qe,E,Se,ae,Ct="For each input token, the model weights are loaded each time during the forward pass, which is slow and cumbersome when a model has billions of parameters. Speculative decoding alleviates this slowdown by using a second smaller and faster assistant model to generate candidate tokens that are verified by the larger model in a single forward pass. If the verified tokens are correct, the LLM essentially gets them for ‚Äúfree‚Äù without having to generate them itself. There is no degradation in accuracy because the verification forward pass ensures the same outputs are generated as if the LLM had generated them on its own.",Ee,ne,kt="To get the largest speed up, the assistant model should be a lot smaller than the LLM so that it can generate tokens quickly. The assistant and LLM model must also share the same tokenizer to avoid re-encoding and decoding tokens.",xe,x,Ye,oe,$t='Enable speculative decoding by loading an assistant model and passing it to <a href="/docs/transformers/v4.56.2/en/main_classes/text_generation#transformers.GenerationMixin.generate">generate()</a>.',qe,Y,Le,ie,Ae,re,Bt="Prompt lookup decoding is a variant of speculative decoding that is also compatible with greedy search and sampling. Prompt lookup works especially well for input-grounded tasks - such as summarization - where there is often overlapping words between the prompt and output. These overlapping n-grams are used as the LLM candidate tokens.",Ke,pe,Wt='To enable prompt lookup decoding, specify the number of tokens that should be overlapping in the <a href="https://hf.co/docs/transformers/main/en/main_classes/text_generation#transformers.GenerationConfig.prompt_lookup_num_tokens" rel="nofollow">prompt_lookup_num_tokens</a> parameter. Then pass this parameter to <a href="/docs/transformers/v4.56.2/en/main_classes/text_generation#transformers.GenerationMixin.generate">generate()</a>.',De,q,Pe,ce,Oe,me,Rt="A known issue with transformer models is that the self-attention mechanism grows quadratically in compute and memory with the number of input tokens. This limitation is only magnified in LLMs which handles much longer sequences. To address this, try FlashAttention2 or PyTorch‚Äôs scaled dot product attention (SDPA), which are more memory efficient attention implementations.",et,Me,tt,de,It='FlashAttention and <a href="./perf_infer_gpu_one#flashattention-2">FlashAttention-2</a> break up the attention computation into smaller chunks and reduces the number of intermediate read/write operations to the GPU memory to speed up inference. FlashAttention-2 improves on the original FlashAttention algorithm by also parallelizing over sequence length dimension and better partitioning work on the hardware to reduce synchronization and communication overhead.',lt,ue,Vt='To use FlashAttention-2, set <a href="https://hf.co/docs/transformers/main/en/main_classes/text_generation#transformers.PreTrainedModel.from_pretrained.attn_implementation" rel="nofollow">attn_implementation</a> to <code>&quot;flash_attention_2&quot;</code> in <a href="/docs/transformers/v4.56.2/en/main_classes/model#transformers.PreTrainedModel.from_pretrained">from_pretrained()</a> or set with <code>model.set_attention_implementation(&quot;flash_attention_2&quot;)</code> to dynamically update the <a href="./attention_interface">attention interface</a> after the model is loaded.',st,he,at,ye,nt,fe,Xt="Scaled dot product attention (SDPA) is automatically enabled in PyTorch 2.0 and it supports FlashAttention, xFormers, and PyTorch‚Äôs C++ implementation. SDPA chooses the most performant attention algorithm if you‚Äôre using a CUDA backend. For other backends, SDPA defaults to the PyTorch C++ implementation.",ot,L,it,Te,zt='Use the <a href="https://pytorch.org/docs/stable/generated/torch.nn.attention.sdpa_kernel.html" rel="nofollow">torch.nn.attention.sdpa_kernel</a> context manager to explicitly enable or disable any of the four attention algorithms. For example, use <code>SDPBackend.FLASH_ATTENTION</code> to enable FlashAttention.',rt,Je,pt,we,ct,be,Ft="Quantization reduces the size of model weights by storing them in a lower precision. This translates to lower memory usage and makes loading LLMs for inference more accessible if you‚Äôre constrained by GPU memory.",mt,Ue,Ht="If you aren‚Äôt limited by your GPU, you don‚Äôt necessarily need to quantize your model because it can increase latency slightly (except for AWQ and fused AWQ modules) due to the extra step required to quantize and dequantize the weights.",Mt,A,dt,je,Nt='Use the Model Memory Calculator below to estimate and compare how much memory is required to load a model. For example, try estimating the memory required to load <a href="https://hf.co/mistralai/Mistral-7B-v0.1" rel="nofollow">Mistral-7B-v0.1</a>.',ut,z,Qt,ht,Ze,St='To load a model in half-precision, set the <a href="https://hf.co/docs/transformers/main/en/main_classes/text_generation#transformers.PreTrainedModel.from_pretrained.dtype" rel="nofollow">dtype</a> parameter in <a href="/docs/transformers/v4.56.2/en/model_doc/auto#transformers.AutoModel.from_pretrained">from_pretrained()</a> to <code>torch.bfloat16</code>. This requires 13.74GB of memory.',yt,ge,ft,ve,Et='To load a quantized model (8-bit or 4-bit), try <a href="https://hf.co/docs/bitsandbytes" rel="nofollow">bitsandbytes</a> and set the <a href="https://hf.co/docs/transformers/main/en/main_classes/text_generation#transformers.BitsAndBytesConfig.load_in_4bit" rel="nofollow">load_in_4bit</a> or <a href="https://hf.co/docs/transformers/main/en/main_classes/text_generation#transformers.BitsAndBytesConfig.load_in_8bit" rel="nofollow">load_in_8bit</a> parameters to <code>True</code>. Loading the model in 8-bits only requires 6.87 GB of memory.',Tt,Ge,Jt,_e,wt,Be,bt;return o=new H({props:{title:"Optimizing inference",local:"optimizing-inference",headingTag:"h1"}}),$=new K({props:{warning:!1,$$slots:{default:[pl]},$$scope:{ctx:g}}}),R=new H({props:{title:"Static kv-cache and torch.compile",local:"static-kv-cache-and-torchcompile",headingTag:"h2"}}),N=new K({props:{warning:!0,$$slots:{default:[cl]},$$scope:{ctx:g}}}),Q=new K({props:{warning:!1,$$slots:{default:[ml]},$$scope:{ctx:g}}}),S=new jt({props:{id:"static-kv",options:["1. cache_implementation","2. StaticCache","3. compile entire generate function"],$$slots:{default:[yl]},$$scope:{ctx:g}}}),te=new H({props:{title:"Decoding strategies",local:"decoding-strategies",headingTag:"h2"}}),se=new H({props:{title:"Speculative decoding",local:"speculative-decoding",headingTag:"h3"}}),E=new K({props:{warning:!1,$$slots:{default:[fl]},$$scope:{ctx:g}}}),x=new K({props:{warning:!0,$$slots:{default:[Tl]},$$scope:{ctx:g}}}),Y=new jt({props:{id:"spec-decoding",options:["greedy search","sampling"],$$slots:{default:[bl]},$$scope:{ctx:g}}}),ie=new H({props:{title:"Prompt lookup decoding",local:"prompt-lookup-decoding",headingTag:"h3"}}),q=new jt({props:{id:"pld",options:["greedy decoding","sampling"],$$slots:{default:[Zl]},$$scope:{ctx:g}}}),ce=new H({props:{title:"Attention",local:"attention",headingTag:"h2"}}),Me=new H({props:{title:"FlashAttention-2",local:"flashattention-2",headingTag:"h3"}}),he=new W({props:{code:"ZnJvbSUyMHRyYW5zZm9ybWVycyUyMGltcG9ydCUyMEF1dG9Nb2RlbEZvckNhdXNhbExNJTJDJTIwQml0c0FuZEJ5dGVzQ29uZmlnJTBBJTBBcXVhbnRfY29uZmlnJTIwJTNEJTIwQml0c0FuZEJ5dGVzQ29uZmlnKGxvYWRfaW5fOGJpdCUzRFRydWUpJTBBbW9kZWwlMjAlM0QlMjBBdXRvTW9kZWxGb3JDYXVzYWxMTS5mcm9tX3ByZXRyYWluZWQoJTBBJTIwJTIwJTIwJTIwJTIyZ29vZ2xlJTJGZ2VtbWEtMmIlMjIlMkMlMEElMjAlMjAlMjAlMjBxdWFudGl6YXRpb25fY29uZmlnJTNEcXVhbnRfY29uZmlnJTJDJTBBJTIwJTIwJTIwJTIwZHR5cGUlM0R0b3JjaC5iZmxvYXQxNiUyQyUwQSUyMCUyMCUyMCUyMGF0dG5faW1wbGVtZW50YXRpb24lM0QlMjJmbGFzaF9hdHRlbnRpb25fMiUyMiUyQyUwQSklMEElMEElMjMlMjBDaGFuZ2UlMjB0aGUlMjBtb2RlbCdzJTIwYXR0ZW50aW9uJTIwZHluYW1pY2FsbHklMjBhZnRlciUyMGxvYWRpbmclMEFtb2RlbCUyMCUzRCUyMEF1dG9Nb2RlbEZvckNhdXNhbExNLmZyb21fcHJldHJhaW5lZCglMEElMjAlMjAlMjAlMjAlMjJnb29nbGUlMkZnZW1tYS0yYiUyMiUyQyUwQSUyMCUyMCUyMCUyMHF1YW50aXphdGlvbl9jb25maWclM0RxdWFudF9jb25maWclMkMlMEElMjAlMjAlMjAlMjBkdHlwZSUzRHRvcmNoLmJmbG9hdDE2JTBBKSUwQW1vZGVsLnNldF9hdHRlbnRpb25faW1wbGVtZW50YXRpb24oJTIyZmxhc2hfYXR0ZW50aW9uXzIlMjIp",highlighted:`<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoModelForCausalLM, BitsAndBytesConfig

quant_config = BitsAndBytesConfig(load_in_8bit=<span class="hljs-literal">True</span>)
model = AutoModelForCausalLM.from_pretrained(
    <span class="hljs-string">&quot;google/gemma-2b&quot;</span>,
    quantization_config=quant_config,
    dtype=torch.bfloat16,
    attn_implementation=<span class="hljs-string">&quot;flash_attention_2&quot;</span>,
)

<span class="hljs-comment"># Change the model&#x27;s attention dynamically after loading</span>
model = AutoModelForCausalLM.from_pretrained(
    <span class="hljs-string">&quot;google/gemma-2b&quot;</span>,
    quantization_config=quant_config,
    dtype=torch.bfloat16
)
model.set_attention_implementation(<span class="hljs-string">&quot;flash_attention_2&quot;</span>)`,wrap:!1}}),ye=new H({props:{title:"PyTorch scaled dot product attention",local:"pytorch-scaled-dot-product-attention",headingTag:"h3"}}),L=new K({props:{warning:!1,$$slots:{default:[gl]},$$scope:{ctx:g}}}),Je=new W({props:{code:"aW1wb3J0JTIwdG9yY2glMEFmcm9tJTIwdG9yY2gubm4uYXR0ZW50aW9uJTIwaW1wb3J0JTIwU0RQQmFja2VuZCUyQyUyMHNkcGFfa2VybmVsJTBBZnJvbSUyMHRyYW5zZm9ybWVycyUyMGltcG9ydCUyMEF1dG9Nb2RlbEZvckNhdXNhbExNJTBBJTBBbW9kZWwlMjAlM0QlMjBBdXRvTW9kZWxGb3JDYXVzYWxMTS5mcm9tX3ByZXRyYWluZWQoJTBBJTIwJTIwJTIwJTIwJTIyZ29vZ2xlJTJGZ2VtbWEtMmIlMjIlMkMlMEElMjAlMjAlMjAlMjBkdHlwZSUzRHRvcmNoLmJmbG9hdDE2JTJDJTBBKSUwQSUwQXdpdGglMjBzZHBhX2tlcm5lbChTRFBCYWNrZW5kLkZMQVNIX0FUVEVOVElPTiklM0ElMEElMjAlMjAlMjAlMjBvdXRwdXRzJTIwJTNEJTIwbW9kZWwuZ2VuZXJhdGUoKippbnB1dHMp",highlighted:`<span class="hljs-keyword">import</span> torch
<span class="hljs-keyword">from</span> torch.nn.attention <span class="hljs-keyword">import</span> SDPBackend, sdpa_kernel
<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoModelForCausalLM

model = AutoModelForCausalLM.from_pretrained(
    <span class="hljs-string">&quot;google/gemma-2b&quot;</span>,
    dtype=torch.bfloat16,
)

<span class="hljs-keyword">with</span> sdpa_kernel(SDPBackend.FLASH_ATTENTION):
    outputs = model.generate(**inputs)`,wrap:!1}}),we=new H({props:{title:"Quantization",local:"quantization",headingTag:"h2"}}),A=new K({props:{warning:!1,$$slots:{default:[vl]},$$scope:{ctx:g}}}),ge=new W({props:{code:"ZnJvbSUyMHRyYW5zZm9ybWVycyUyMGltcG9ydCUyMEF1dG9Ub2tlbml6ZXIlMkMlMjBBdXRvTW9kZWxGb3JDYXVzYWxMTSUwQWltcG9ydCUyMHRvcmNoJTBBJTBBbW9kZWwlMjAlM0QlMjBBdXRvTW9kZWxGb3JDYXVzYWxMTS5mcm9tX3ByZXRyYWluZWQoJTBBJTIwJTIwJTIwJTIwJTIybWlzdHJhbGFpJTJGTWlzdHJhbC03Qi12MC4xJTIyJTJDJTIwZHR5cGUlM0R0b3JjaC5iZmxvYXQxNiUyQyUyMGRldmljZV9tYXAlM0QlMjJhdXRvJTIyJTJDJTBBKQ==",highlighted:`<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoTokenizer, AutoModelForCausalLM
<span class="hljs-keyword">import</span> torch

model = AutoModelForCausalLM.from_pretrained(
    <span class="hljs-string">&quot;mistralai/Mistral-7B-v0.1&quot;</span>, dtype=torch.bfloat16, device_map=<span class="hljs-string">&quot;auto&quot;</span>,
)`,wrap:!1}}),Ge=new W({props:{code:"ZnJvbSUyMHRyYW5zZm9ybWVycyUyMGltcG9ydCUyMEF1dG9Ub2tlbml6ZXIlMkMlMjBBdXRvTW9kZWxGb3JDYXVzYWxMTSUyQyUyMEJpdHNBbmRCeXRlc0NvbmZpZyUwQWltcG9ydCUyMHRvcmNoJTBBJTBBcXVhbnRfY29uZmlnJTIwJTNEJTIwQml0c0FuZEJ5dGVzQ29uZmlnKGxvYWRfaW5fOGJpdCUzRFRydWUpJTBBbW9kZWwlMjAlM0QlMjBBdXRvTW9kZWxGb3JDYXVzYWxMTS5mcm9tX3ByZXRyYWluZWQoJTBBJTIwJTIwJTIwJTIwJTIybWlzdHJhbGFpJTJGTWlzdHJhbC03Qi12MC4xJTIyJTJDJTIwcXVhbnRpemF0aW9uX2NvbmZpZyUzRHF1YW50X2NvbmZpZyUyQyUyMGRldmljZV9tYXAlM0QlMjJhdXRvJTIyJTBBKQ==",highlighted:`<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoTokenizer, AutoModelForCausalLM, BitsAndBytesConfig
<span class="hljs-keyword">import</span> torch

quant_config = BitsAndBytesConfig(load_in_8bit=<span class="hljs-literal">True</span>)
model = AutoModelForCausalLM.from_pretrained(
    <span class="hljs-string">&quot;mistralai/Mistral-7B-v0.1&quot;</span>, quantization_config=quant_config, device_map=<span class="hljs-string">&quot;auto&quot;</span>
)`,wrap:!1}}),_e=new rl({props:{source:"https://github.com/huggingface/transformers/blob/main/docs/source/en/llm_optims.md"}}),{c(){t=h("meta"),m=p(),s=h("p"),r=p(),T(o.$$.fragment),i=p(),M=h("p"),M.innerHTML=Z,G=p(),k=h("p"),k.textContent=_,d=p(),v=h("p"),v.textContent=$e,F=p(),T($.$$.fragment),D=p(),T(R.$$.fragment),I=p(),V=h("p"),V.textContent=u,C=p(),X=h("p"),X.innerHTML=Zt,We=p(),P=h("p"),P.innerHTML=gt,Re=p(),T(N.$$.fragment),Ie=p(),O=h("p"),O.textContent=vt,Ve=p(),ee=h("ol"),ee.innerHTML=Gt,Xe=p(),T(Q.$$.fragment),ze=p(),T(S.$$.fragment),Fe=p(),T(te.$$.fragment),He=p(),le=h("p"),le.textContent=_t,Ne=p(),T(se.$$.fragment),Qe=p(),T(E.$$.fragment),Se=p(),ae=h("p"),ae.textContent=Ct,Ee=p(),ne=h("p"),ne.textContent=kt,xe=p(),T(x.$$.fragment),Ye=p(),oe=h("p"),oe.innerHTML=$t,qe=p(),T(Y.$$.fragment),Le=p(),T(ie.$$.fragment),Ae=p(),re=h("p"),re.textContent=Bt,Ke=p(),pe=h("p"),pe.innerHTML=Wt,De=p(),T(q.$$.fragment),Pe=p(),T(ce.$$.fragment),Oe=p(),me=h("p"),me.textContent=Rt,et=p(),T(Me.$$.fragment),tt=p(),de=h("p"),de.innerHTML=It,lt=p(),ue=h("p"),ue.innerHTML=Vt,st=p(),T(he.$$.fragment),at=p(),T(ye.$$.fragment),nt=p(),fe=h("p"),fe.textContent=Xt,ot=p(),T(L.$$.fragment),it=p(),Te=h("p"),Te.innerHTML=zt,rt=p(),T(Je.$$.fragment),pt=p(),T(we.$$.fragment),ct=p(),be=h("p"),be.textContent=Ft,mt=p(),Ue=h("p"),Ue.textContent=Ht,Mt=p(),T(A.$$.fragment),dt=p(),je=h("p"),je.innerHTML=Nt,ut=p(),z=h("iframe"),ht=p(),Ze=h("p"),Ze.innerHTML=St,yt=p(),T(ge.$$.fragment),ft=p(),ve=h("p"),ve.innerHTML=Et,Tt=p(),T(Ge.$$.fragment),Jt=p(),T(_e.$$.fragment),wt=p(),Be=h("p"),this.h()},l(e){const l=ol("svelte-u9bgzb",document.head);t=y(l,"META",{name:!0,content:!0}),l.forEach(a),m=c(e),s=y(e,"P",{}),Ut(s).forEach(a),r=c(e),J(o.$$.fragment,e),i=c(e),M=y(e,"P",{"data-svelte-h":!0}),f(M)!=="svelte-1f9oh7n"&&(M.innerHTML=Z),G=c(e),k=y(e,"P",{"data-svelte-h":!0}),f(k)!=="svelte-1olgvni"&&(k.textContent=_),d=c(e),v=y(e,"P",{"data-svelte-h":!0}),f(v)!=="svelte-16ypsvh"&&(v.textContent=$e),F=c(e),J($.$$.fragment,e),D=c(e),J(R.$$.fragment,e),I=c(e),V=y(e,"P",{"data-svelte-h":!0}),f(V)!=="svelte-1a9ib4g"&&(V.textContent=u),C=c(e),X=y(e,"P",{"data-svelte-h":!0}),f(X)!=="svelte-7nmn0g"&&(X.innerHTML=Zt),We=c(e),P=y(e,"P",{"data-svelte-h":!0}),f(P)!=="svelte-1abkxhz"&&(P.innerHTML=gt),Re=c(e),J(N.$$.fragment,e),Ie=c(e),O=y(e,"P",{"data-svelte-h":!0}),f(O)!=="svelte-13l87jg"&&(O.textContent=vt),Ve=c(e),ee=y(e,"OL",{"data-svelte-h":!0}),f(ee)!=="svelte-1ibc9bv"&&(ee.innerHTML=Gt),Xe=c(e),J(Q.$$.fragment,e),ze=c(e),J(S.$$.fragment,e),Fe=c(e),J(te.$$.fragment,e),He=c(e),le=y(e,"P",{"data-svelte-h":!0}),f(le)!=="svelte-a4gxio"&&(le.textContent=_t),Ne=c(e),J(se.$$.fragment,e),Qe=c(e),J(E.$$.fragment,e),Se=c(e),ae=y(e,"P",{"data-svelte-h":!0}),f(ae)!=="svelte-nv0ghv"&&(ae.textContent=Ct),Ee=c(e),ne=y(e,"P",{"data-svelte-h":!0}),f(ne)!=="svelte-1nm1j4o"&&(ne.textContent=kt),xe=c(e),J(x.$$.fragment,e),Ye=c(e),oe=y(e,"P",{"data-svelte-h":!0}),f(oe)!=="svelte-17u7cbh"&&(oe.innerHTML=$t),qe=c(e),J(Y.$$.fragment,e),Le=c(e),J(ie.$$.fragment,e),Ae=c(e),re=y(e,"P",{"data-svelte-h":!0}),f(re)!=="svelte-123yl06"&&(re.textContent=Bt),Ke=c(e),pe=y(e,"P",{"data-svelte-h":!0}),f(pe)!=="svelte-j59ibn"&&(pe.innerHTML=Wt),De=c(e),J(q.$$.fragment,e),Pe=c(e),J(ce.$$.fragment,e),Oe=c(e),me=y(e,"P",{"data-svelte-h":!0}),f(me)!=="svelte-119vxvi"&&(me.textContent=Rt),et=c(e),J(Me.$$.fragment,e),tt=c(e),de=y(e,"P",{"data-svelte-h":!0}),f(de)!=="svelte-1noxdna"&&(de.innerHTML=It),lt=c(e),ue=y(e,"P",{"data-svelte-h":!0}),f(ue)!=="svelte-4qqqu0"&&(ue.innerHTML=Vt),st=c(e),J(he.$$.fragment,e),at=c(e),J(ye.$$.fragment,e),nt=c(e),fe=y(e,"P",{"data-svelte-h":!0}),f(fe)!=="svelte-16n93px"&&(fe.textContent=Xt),ot=c(e),J(L.$$.fragment,e),it=c(e),Te=y(e,"P",{"data-svelte-h":!0}),f(Te)!=="svelte-xcpcjc"&&(Te.innerHTML=zt),rt=c(e),J(Je.$$.fragment,e),pt=c(e),J(we.$$.fragment,e),ct=c(e),be=y(e,"P",{"data-svelte-h":!0}),f(be)!=="svelte-1h1vcbj"&&(be.textContent=Ft),mt=c(e),Ue=y(e,"P",{"data-svelte-h":!0}),f(Ue)!=="svelte-bsjn3b"&&(Ue.textContent=Ht),Mt=c(e),J(A.$$.fragment,e),dt=c(e),je=y(e,"P",{"data-svelte-h":!0}),f(je)!=="svelte-14tgx8l"&&(je.innerHTML=Nt),ut=c(e),z=y(e,"IFRAME",{src:!0,frameborder:!0,width:!0,height:!0}),Ut(z).forEach(a),ht=c(e),Ze=y(e,"P",{"data-svelte-h":!0}),f(Ze)!=="svelte-1vhjdi1"&&(Ze.innerHTML=St),yt=c(e),J(ge.$$.fragment,e),ft=c(e),ve=y(e,"P",{"data-svelte-h":!0}),f(ve)!=="svelte-1f44nt3"&&(ve.innerHTML=Et),Tt=c(e),J(Ge.$$.fragment,e),Jt=c(e),J(_e.$$.fragment,e),wt=c(e),Be=y(e,"P",{}),Ut(Be).forEach(a),this.h()},h(){ke(t,"name","hf:doc:metadata"),ke(t,"content",_l),ll(z.src,Qt="https://hf-accelerate-model-memory-usage.hf.space")||ke(z,"src",Qt),ke(z,"frameborder","0"),ke(z,"width","850"),ke(z,"height","450")},m(e,l){il(document.head,t),n(e,m,l),n(e,s,l),n(e,r,l),w(o,e,l),n(e,i,l),n(e,M,l),n(e,G,l),n(e,k,l),n(e,d,l),n(e,v,l),n(e,F,l),w($,e,l),n(e,D,l),w(R,e,l),n(e,I,l),n(e,V,l),n(e,C,l),n(e,X,l),n(e,We,l),n(e,P,l),n(e,Re,l),w(N,e,l),n(e,Ie,l),n(e,O,l),n(e,Ve,l),n(e,ee,l),n(e,Xe,l),w(Q,e,l),n(e,ze,l),w(S,e,l),n(e,Fe,l),w(te,e,l),n(e,He,l),n(e,le,l),n(e,Ne,l),w(se,e,l),n(e,Qe,l),w(E,e,l),n(e,Se,l),n(e,ae,l),n(e,Ee,l),n(e,ne,l),n(e,xe,l),w(x,e,l),n(e,Ye,l),n(e,oe,l),n(e,qe,l),w(Y,e,l),n(e,Le,l),w(ie,e,l),n(e,Ae,l),n(e,re,l),n(e,Ke,l),n(e,pe,l),n(e,De,l),w(q,e,l),n(e,Pe,l),w(ce,e,l),n(e,Oe,l),n(e,me,l),n(e,et,l),w(Me,e,l),n(e,tt,l),n(e,de,l),n(e,lt,l),n(e,ue,l),n(e,st,l),w(he,e,l),n(e,at,l),w(ye,e,l),n(e,nt,l),n(e,fe,l),n(e,ot,l),w(L,e,l),n(e,it,l),n(e,Te,l),n(e,rt,l),w(Je,e,l),n(e,pt,l),w(we,e,l),n(e,ct,l),n(e,be,l),n(e,mt,l),n(e,Ue,l),n(e,Mt,l),w(A,e,l),n(e,dt,l),n(e,je,l),n(e,ut,l),n(e,z,l),n(e,ht,l),n(e,Ze,l),n(e,yt,l),w(ge,e,l),n(e,ft,l),n(e,ve,l),n(e,Tt,l),w(Ge,e,l),n(e,Jt,l),w(_e,e,l),n(e,wt,l),n(e,Be,l),bt=!0},p(e,[l]){const xt={};l&2&&(xt.$$scope={dirty:l,ctx:e}),$.$set(xt);const Yt={};l&2&&(Yt.$$scope={dirty:l,ctx:e}),N.$set(Yt);const qt={};l&2&&(qt.$$scope={dirty:l,ctx:e}),Q.$set(qt);const Lt={};l&2&&(Lt.$$scope={dirty:l,ctx:e}),S.$set(Lt);const At={};l&2&&(At.$$scope={dirty:l,ctx:e}),E.$set(At);const Kt={};l&2&&(Kt.$$scope={dirty:l,ctx:e}),x.$set(Kt);const Dt={};l&2&&(Dt.$$scope={dirty:l,ctx:e}),Y.$set(Dt);const Pt={};l&2&&(Pt.$$scope={dirty:l,ctx:e}),q.$set(Pt);const Ot={};l&2&&(Ot.$$scope={dirty:l,ctx:e}),L.$set(Ot);const el={};l&2&&(el.$$scope={dirty:l,ctx:e}),A.$set(el)},i(e){bt||(b(o.$$.fragment,e),b($.$$.fragment,e),b(R.$$.fragment,e),b(N.$$.fragment,e),b(Q.$$.fragment,e),b(S.$$.fragment,e),b(te.$$.fragment,e),b(se.$$.fragment,e),b(E.$$.fragment,e),b(x.$$.fragment,e),b(Y.$$.fragment,e),b(ie.$$.fragment,e),b(q.$$.fragment,e),b(ce.$$.fragment,e),b(Me.$$.fragment,e),b(he.$$.fragment,e),b(ye.$$.fragment,e),b(L.$$.fragment,e),b(Je.$$.fragment,e),b(we.$$.fragment,e),b(A.$$.fragment,e),b(ge.$$.fragment,e),b(Ge.$$.fragment,e),b(_e.$$.fragment,e),bt=!0)},o(e){U(o.$$.fragment,e),U($.$$.fragment,e),U(R.$$.fragment,e),U(N.$$.fragment,e),U(Q.$$.fragment,e),U(S.$$.fragment,e),U(te.$$.fragment,e),U(se.$$.fragment,e),U(E.$$.fragment,e),U(x.$$.fragment,e),U(Y.$$.fragment,e),U(ie.$$.fragment,e),U(q.$$.fragment,e),U(ce.$$.fragment,e),U(Me.$$.fragment,e),U(he.$$.fragment,e),U(ye.$$.fragment,e),U(L.$$.fragment,e),U(Je.$$.fragment,e),U(we.$$.fragment,e),U(A.$$.fragment,e),U(ge.$$.fragment,e),U(Ge.$$.fragment,e),U(_e.$$.fragment,e),bt=!1},d(e){e&&(a(m),a(s),a(r),a(i),a(M),a(G),a(k),a(d),a(v),a(F),a(D),a(I),a(V),a(C),a(X),a(We),a(P),a(Re),a(Ie),a(O),a(Ve),a(ee),a(Xe),a(ze),a(Fe),a(He),a(le),a(Ne),a(Qe),a(Se),a(ae),a(Ee),a(ne),a(xe),a(Ye),a(oe),a(qe),a(Le),a(Ae),a(re),a(Ke),a(pe),a(De),a(Pe),a(Oe),a(me),a(et),a(tt),a(de),a(lt),a(ue),a(st),a(at),a(nt),a(fe),a(ot),a(it),a(Te),a(rt),a(pt),a(ct),a(be),a(mt),a(Ue),a(Mt),a(dt),a(je),a(ut),a(z),a(ht),a(Ze),a(yt),a(ft),a(ve),a(Tt),a(Jt),a(wt),a(Be)),a(t),j(o,e),j($,e),j(R,e),j(N,e),j(Q,e),j(S,e),j(te,e),j(se,e),j(E,e),j(x,e),j(Y,e),j(ie,e),j(q,e),j(ce,e),j(Me,e),j(he,e),j(ye,e),j(L,e),j(Je,e),j(we,e),j(A,e),j(ge,e),j(Ge,e),j(_e,e)}}}const _l='{"title":"Optimizing inference","local":"optimizing-inference","sections":[{"title":"Static kv-cache and torch.compile","local":"static-kv-cache-and-torchcompile","sections":[],"depth":2},{"title":"Decoding strategies","local":"decoding-strategies","sections":[{"title":"Speculative decoding","local":"speculative-decoding","sections":[],"depth":3},{"title":"Prompt lookup decoding","local":"prompt-lookup-decoding","sections":[],"depth":3}],"depth":2},{"title":"Attention","local":"attention","sections":[{"title":"FlashAttention-2","local":"flashattention-2","sections":[],"depth":3},{"title":"PyTorch scaled dot product attention","local":"pytorch-scaled-dot-product-attention","sections":[],"depth":3}],"depth":2},{"title":"Quantization","local":"quantization","sections":[],"depth":2}],"depth":1}';function Cl(g){return sl(()=>{new URLSearchParams(window.location.search).get("fw")}),[]}class Vl extends al{constructor(t){super(),nl(this,t,Cl,Gl,tl,{})}}export{Vl as component};
