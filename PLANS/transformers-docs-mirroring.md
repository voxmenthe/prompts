# Plan: Mirror Transformers Docs (2025-12-07)

## Key findings
- Transformers docs are built with Hugging Face’s `doc-builder`; the project README prescribes `pip install -e ".[docs]"` and `doc-builder build transformers docs/source/en/ --build_dir <tmp>` to generate the MDX used on the site. citeturn3search0
- `doc-builder` supports per-language builds via `--language {lang}` and can emit HTML with `--html`, so we can iterate languages without changing code. citeturn4search1
- The repository ships multiple language trees (`docs/source/en`, `de`, `zh`, `ja`, `ko`, `hi`, `ar`, …) each with its own `_toctree.yml`, so any mirror should handle language selection explicitly. citeturn5search3turn5search5turn5search6
- Hugging Face publishes the rendered docs to the public dataset `hf-doc-build/doc-build`, which mirrors everything served at https://huggingface.co/docs and is regenerated by `doc-builder`. citeturn4search0turn4search6
- HF staff point to that dataset as the bulk download path for all docs (including Transformers), making it a ready-made fallback to avoid heavy local builds. citeturn4search3

## Approach options
1) **Build from source (doc-builder)** — Clone transformers, install `[docs]` extras, run `doc-builder build` per language, capture MDX/HTML plus manifest. Pros: guarantees parity with a specific commit; supports non-main branches. Cons: heavyweight deps (torch/jax/etc.) and long build times.  
2) **Download from `hf-doc-build` dataset** — Pull the latest published docs artifacts (likely already versioned by branch/tag) and reorganize locally. Pros: fast, no GPU deps, already rendered; ideal for “latest main”. Cons: dataset mirrors public site only; no PR/branch preview; dataset is large.  
3) **Scrape live site** — Sitemap/URL crawl like `mirror_ai_sdk_v6.py`, HTML→Markdown. Pros: minimal Python deps. Cons: loses doc-builder MDX features, brittle to layout changes; duplicates what the dataset already exposes.

## Recommendation
Default to **dataset download** for the mainline mirror (lowest friction, full coverage), with an optional `--build-from-source` path that uses doc-builder when a specific commit/branch or offline-only generation is required. Scraping is a last resort and likely unnecessary given the dataset.

## Implementation steps
1) **CLI + config**: New script `src/DATA_SCRIPTS/create_transformers_docs_mirror.py` with flags `--output`, `--languages`, `--source [dataset|build]`, `--build-repo`, `--build-ref`, `--html`, `--clean`, `--limit` (debug). Mirror the ergonomics of `create_uv_docs_mirror.py`/`mirror_ai_sdk_v6_docs.py` for consistency.
2) **Dataset mode (default)**  
   - Resolve target revision (default: `main`); use `huggingface_hub` to download only the `docs/transformers/*` subtree from `hf-doc-build/doc-build`.  
   - Preserve dataset revision hash in `manifest.json`; store files under `rendered_site/mdx` or `rendered_site/html` depending on what the dataset provides.  
   - Optionally prune languages not requested via `--languages`.
3) **Build mode (opt-in)**  
   - Clone/pull the transformers repo (path overrideable).  
   - Install deps via `pip install -e ".[docs]"` and `pip install hf-doc-builder`.  
   - For each language: run `doc-builder build transformers docs/source/<lang>/ --build_dir <tmp> [--html] [--language <lang>]`; copy outputs to `build_output/<lang>/`.  
   - Capture metadata: git SHA, doc-builder version, languages built, build timestamps, command line used.
4) **Source copy (optional)**: If `--include-source`, copy `docs/source/<lang>/` tree into `source_docs/<lang>/` for raw MD/MDX reference (similar to `create_fastapi_mirror.py`).
5) **Manifest & README**: Emit `manifest.json` summarizing mode, revision, languages, counts, hashes (sha256), and failures; write a short `README.md` with usage and run summary. Reuse manifest schema from `create_uv_docs_mirror.py`.
6) **Validation**:  
   - Dataset mode: ensure expected anchors exist (e.g., `en/index.mdx`); tally pages per language.  
   - Build mode: fail fast if `_toctree.yml` missing entries or doc-builder exits non-zero; surface stderr in summary.  
   - Add a `--dry-run` to list planned actions without downloading/building.

## Risks & mitigations
- **Dependency weight**: `[docs]` extras pull deep ML stacks; keep build mode optional and document disk/RAM expectations.  
- **Dataset size**: `hf-doc-build` is large; default to language filters and partial download (hub `hf_hub_download` with `repo_files` selection).  
- **Path collisions**: enforce output root guard rails (no writes outside `SPECIALIZED_CONTEXT_AND_DOCS/TRANSFORMERS_DOCS_MIRROR`).  
- **Staleness**: record dataset revision or git SHA in manifest to detect outdated mirrors; add `--force-refresh` to bypass caches.

## Open questions
- Do we need non-English mirrors by default, or only `en` unless requested?  
- Should we store both MDX and HTML, or normalize to Markdown using our existing HTML→MD converter for searchability?  
- What retention policy should we use for previous snapshots (keep N, prune, or overwrite)?

